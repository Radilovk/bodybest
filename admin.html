<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Администраторски панел</title>
  <link rel="stylesheet" href="css/base_styles.css">
  <link rel="stylesheet" href="css/layout_styles.css">
  <link rel="stylesheet" href="css/components_styles.css">
  <link rel="stylesheet" href="css/admin.css">
  <link rel="stylesheet" href="css/clientProfile.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>
  <!-- ======================================================================= -->
  <!-- ========================= SVG ICONS DEFINITION ======================== -->
  <!-- ======================================================================= -->
  <svg style="position: absolute; width: 0; height: 0" aria-hidden="true">
    <symbol
      id="icon-info"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z"
        fill="currentColor"
      ></path>
    </symbol>
    <symbol
      id="icon-check"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"
        fill="currentColor"
      ></path>
    </symbol>
    <symbol
      id="icon-warning-triangle"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M12 2L1 21h22M12 6l7.55 13H4.45M11 10v4h2v-4m-2 6v2h2v-2"
        fill="currentColor"
      ></path>
    </symbol>
    <symbol
      id="icon-menu-burger"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      stroke="currentColor"
      stroke-width="1.5"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"
      ></path>
    </symbol>
    <symbol
      id="icon-close"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      stroke="currentColor"
      stroke-width="1.5"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M6 18L18 6M6 6l12 12"
      ></path>
    </symbol>
    <symbol
      id="icon-send"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
      fill="currentColor"
    >
      <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
    </symbol>
    <symbol
      id="icon-upload"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      stroke="currentColor"
      stroke-width="1.5"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M12 3v13m0 0l-5-5m5 5l5-5M3 16v5h18v-5"
      />
    </symbol>
    <symbol
      id="icon-spinner"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      stroke="currentColor"
      stroke-width="1.5"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"
      ></path>
    </symbol>
    <symbol
      id="icon-chevron-right"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      stroke="currentColor"
      stroke-width="1.5"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M8.25 4.5l7.5 7.5-7.5 7.5"
      ></path>
    </symbol>
    <symbol
      id="icon-feedback"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
      fill="currentColor"
    >
      <path
        d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 12H5.17L4 15.17V4h16v10zm-6-5.41L14.59 8 12 10.59 9.41 8 8 9.41 10.59 12 8 14.59 9.41 16 12 13.41 14.59 16 16 14.59 13.41 12 16 9.41z"
      />
    </symbol>
    <symbol
      id="icon-chart-line"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
      fill="currentColor"
    >
      <path
        d="M16,11.78L20.24,4.45L21.97,5.45L16.74,14.5L10.23,10.75L5.46,19H22V21H2V3H4V17.54L9.5,8L16,11.78Z"
      />
    </symbol>
    <symbol
      id="icon-lightbulb"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
      fill="currentColor"
    >
      <path
        d="M12,2A7,7 0 0,0 5,9C5,11.38 6.19,13.47 8,14.74V17A1,1 0 0,0 9,18H15A1,1 0 0,0 16,17V14.74C17.81,13.47 19,11.38 19,9A7,7 0 0,0 12,2M9,21A1,1 0 0,0 10,22H14A1,1 0 0,0 15,21V20H9V21Z"
      />
    </symbol>
    <symbol id="icon-email" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5">
      <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
      <polyline points="22,6 12,13 2,6"/>
    </symbol>
    <symbol id="icon-settings" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5">
      <circle cx="12" cy="12" r="3"/>
      <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
    </symbol>
    <symbol id="icon-edit" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5">
      <path d="M16.8617 4.48667L18.5492 2.79917C19.2814 2.06694 20.4686 2.06694 21.2008 2.79917C21.9331 3.53141 21.9331 4.71859 21.2008 5.45083L10.5822 16.0695C10.0535 16.5981 9.40144 16.9868 8.68489 17.2002L6 18L6.79978 15.3151C7.01323 14.5986 7.40185 13.9465 7.93052 13.4178L16.8617 4.48667ZM16.8617 4.48667L19.5 7.12499M18 14V18.75C18 19.9926 16.9926 21 15.75 21H5.25C4.00736 21 3 19.9926 3 18.75V8.24999C3 7.00735 4.00736 5.99999 5.25 5.99999H10"/>
    </symbol>
    <symbol id="icon-question" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5">
      <path d="M9.87891 7.51884C11.0505 6.49372 12.95 6.49372 14.1215 7.51884C15.2931 8.54397 15.2931 10.206 14.1215 11.2312C13.9176 11.4096 13.6917 11.5569 13.4513 11.6733C12.7056 12.0341 12.0002 12.6716 12.0002 13.5V14.25"/>
      <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z"/>
      <path d="M12 17.25H12.0075V17.2575H12V17.25Z"/>
    </symbol>
    <symbol id="icon-logout" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5">
      <path d="M15.75 9V5.25C15.75 4.00736 14.7426 3 13.5 3L7.5 3C6.25736 3 5.25 4.00736 5.25 5.25L5.25 18.75C5.25 19.9926 6.25736 21 7.5 21H13.5C14.7426 21 15.75 19.9926 15.75 18.75V15"/>
      <path d="M18.75 15L21.75 12M21.75 12L18.75 9M21.75 12L9 12"/>
    </symbol>
    <symbol id="icon-user" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5">
      <path d="M15.75 6C15.75 8.07107 14.071 9.75 12 9.75C9.9289 9.75 8.24996 8.07107 8.24996 6C8.24996 3.92893 9.9289 2.25 12 2.25C14.071 2.25 15.75 3.92893 15.75 6Z"/>
      <path d="M4.5011 20.1182C4.5714 16.0369 7.90184 12.75 12 12.75C16.0982 12.75 19.4287 16.0371 19.4988 20.1185C17.216 21.166 14.6764 21.75 12.0003 21.75C9.32396 21.75 6.78406 21.1659 4.5011 20.1182Z"/>
    </symbol>
    <symbol id="icon-calendar" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5">
      <path d="M6.75 3V5.25M17.25 3V5.25M3 18.75V7.5C3 6.25736 4.00736 5.25 5.25 5.25H18.75C19.9926 5.25 21 6.25736 21 7.5V18.75M3 18.75C3 19.9926 4.00736 21 5.25 21H18.75C19.9926 21 21 19.9926 21 18.75M3 18.75V11.25C3 10.0074 4.00736 9 5.25 9H18.75C19.9926 9 21 10.0074 21 11.25V18.75M12 12.75H12.0075V12.7575H12V12.75ZM12 15H12.0075V15.0075H12V15ZM12 17.25H12.0075V17.2575H12V17.25ZM9.75 15H9.7575V15.0075H9.75V15ZM9.75 17.25H9.7575V17.2575H9.75V17.25ZM7.5 15H7.5075V15.0075H7.5V15ZM7.5 17.25H7.5075V17.2575H7.5V17.25ZM14.25 12.75H14.2575V12.7575H14.25V12.75ZM14.25 15H14.2575V15.0075H14.25V15ZM14.25 17.25H14.2575V17.2575H14.25V17.25ZM16.5 12.75H16.5075V12.7575H16.5V12.75ZM16.5 15H16.5075V15.0075H16.5V15Z"/>
    </symbol>
    <symbol id="icon-moon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5">
      <path d="M21.7519 15.0019C20.597 15.4839 19.3296 15.75 18 15.75C12.6152 15.75 8.25 11.3848 8.25 6C8.25 4.67039 8.51614 3.40296 8.99806 2.24805C5.47566 3.71785 3 7.19481 3 11.25C3 16.6348 7.36522 21 12.75 21C16.8052 21 20.2821 18.5243 21.7519 15.0019Z"/>
    </symbol>
    <symbol id="icon-scale" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5">
      <path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z" />
      <path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z" />
      <path d="M7 21h10" />
      <path d="M12 3v18" />
      <path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2" />
    </symbol>
    <symbol id="icon-utensils" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5">
      <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2" />
      <path d="M7 2v20" />
      <path d="M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7" />
    </symbol>
    <symbol id="icon-droplet" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5">
      <path d="M12 2.25c-2.35 2.8-7.5 8.11-7.5 11.25a7.5 7.5 0 0 0 15 0c0-3.14-5.15-8.45-7.5-11.25z" />
    </symbol>
    <symbol id="icon-palette" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
      <path d="M8 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3m4 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3M5.5 7a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m.5 6a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3"/>
      <path d="M16 8c0 3.15-1.866 2.585-3.567 2.07C11.42 9.763 10.465 9.473 10 10c-.603.683-.475 1.819-.351 2.92C9.826 14.495 9.996 16 8 16a8 8 0 1 1 8-8m-8 7c.611 0 .654-.171.655-.176.078-.146.124-.464.07-1.119-.014-.168-.037-.37-.061-.591-.052-.464-.112-1.005-.118-1.462-.01-.707.083-1.61.704-2.314.369-.417.845-.578 1.272-.618.404-.038.812.026 1.16.104.343.077.702.186 1.025.284l.028.008c.346.105.658.199.953.266.653.148.904.083.991.024C14.717 9.38 15 9.161 15 8a7 7 0 1 0-7 7"/>
    </symbol>
    <symbol id="icon-assistant" viewBox="0 0 24 24" fill="currentColor">
      <path d="M12 2a7 7 0 0 1 7 7c0 5-7 11-7 11S5 14 5 9a7 7 0 0 1 7-7z" />
      <circle cx="10" cy="9" r="1" />
      <circle cx="14" cy="9" r="1" />
      <path d="M9 12c1 1 5 1 6 0" />
    </symbol>
  </svg>
  <!-- ======================= END SVG ICONS DEFINITION ====================== -->

  <h1>Администраторски панел <span id="notificationIndicator" class="notification-dot hidden"></span></h1>
  <p><a href="logout.html">Изход</a></p>
  <p><button id="toggleMaintenance" class="button button-secondary button-small">Режим на поддръжка: <span id="maintenanceStatus">...</span></button></p>
  <section id="notificationsSection" class="card">
    <h2>Известия</h2>
    <ul id="notificationsList"></ul>
  </section>
  <div class="layout">
  <details class="sidebar card" id="clientsSection">
    <summary class="clients-summary">Клиенти</summary>
    <div id="clientsControls" class="clients-controls clients-row">
      <input id="clientSearch" list="clientSuggestions" placeholder="Търсене по име или имейл">
      <datalist id="clientSuggestions"></datalist>
      <select id="statusFilter">
        <option value="all">Всички</option>
        <option value="pending">pending</option>
        <option value="processing">processing</option>
        <option value="ready">ready</option>
      </select>
      <select id="tagFilter" multiple>
        <option value="all">Всички етикети</option>
      </select>
      <select id="sortOrder">
        <option value="name">Сортирай по име</option>
        <option value="date">Сортирай по дата</option>
      </select>
      <button id="showStats">Покажи статистика</button>
    </div>
    <p id="clientsCount"></p>
    <ul id="clientsList" class="clients-row"></ul>
  </details>

  <main id="clientDetails" class="main-content card hidden">
    <h2 id="clientName">Клиент</h2>
    <button id="closeProfile" class="close-button" aria-label="Затвори профила">&times;</button>
    <nav id="clientTabs" class="tabs styled-tabs" role="tablist">
      <button class="tab-btn" role="tab" aria-selected="true" data-target="profileTab">Профил</button>
      <button class="tab-btn" role="tab" aria-selected="false" data-target="notesTab">Бележки</button>
      <button class="tab-btn" role="tab" aria-selected="false" data-target="qaTab">Въпросник</button>
      <button class="tab-btn" role="tab" aria-selected="false" data-target="menuTab">Меню</button>
      <button class="tab-btn" role="tab" aria-selected="false" data-target="logsTab">Дневници</button>
      <button class="tab-btn" role="tab" aria-selected="false" data-target="dashboardTab">Данни</button>
    </nav>
    <section id="profileTab" class="client-tab active-tab-content" role="tabpanel">
    <details id="profileSection">
      <summary>Лични данни</summary>
      <form id="profileForm">
        <label>Име: <input id="profileName" type="text"></label><br>
        <label>Имейл: <input id="profileEmail" type="email"></label><br>
        <label>Телефон: <input id="profilePhone" type="tel"></label><br>
        <label>Праг за превишение <input id="profileMacroThreshold" type="number" step="0.01" min="1"></label><br>
        <button type="submit">Запази профила</button>
      </form>
    </details>
    <button id="regeneratePlan">Генерирай нов план</button>
    <div id="regenProgress" class="hidden" aria-live="polite"></div>
    <button id="aiSummary">AI резюме</button>
    <div class="profile-nav-container">
      <button id="profileCardNavToggle" class="profile-nav-toggle" aria-label="Показване на навигацията">
        <i class="fas fa-bars"></i>
      </button>
      <nav id="profileCardNav" class="profile-card-nav">
        <a href="#profileSummary" data-target="profileSummary">Резюме</a>
        <a href="#caloriesMacros" data-target="caloriesMacros">Калории</a>
        <a href="#allowedForbiddenFoods" data-target="allowedForbiddenFoods">Храни</a>
        <a href="#week1Menu" data-target="week1Menu">Седмица 1</a>
        <a href="#principlesWeek2_4" data-target="principlesWeek2_4">Принципи</a>
        <a href="#hydrationCookingSupplements" data-target="hydrationCookingSupplements">Хидратация</a>
        <a href="#psychologicalGuidance" data-target="psychologicalGuidance">Психология</a>
        <a href="#generationMetadata" data-target="generationMetadata">Метаданни</a>
        <a href="#detailedTargets" data-target="detailedTargets">Цели</a>
      </nav>
    </div>
    <div id="adminProfileContainer"></div>
    <a id="openFullProfile" class="button button-small" href="#" target="_blank" title="Отвори пълния профил в нов таб">
      <i class="fas fa-external-link-alt me-1"></i>Пълен профил
    </a>
    <a id="openUserData" class="button button-small" href="#" target="_blank" title="Преглед на данните в JSON">
      JSON изглед
    </a>
    </section>
    <section id="notesTab" class="client-tab" role="tabpanel" aria-hidden="true">
    <details id="notesSection">
      <summary>Бележки</summary>
      <textarea id="adminNotes" rows="3" cols="40"></textarea><br>
      <label>Етикети: <input id="adminTags"></label>
      <p class="help-text">Разделяйте етикетите със запетая.</p>
      <button id="saveNotes">Запази бележките</button>
    </details>
    </section>
    <section id="qaTab" class="client-tab" role="tabpanel" aria-hidden="true">
    <details id="qaSection">
      <summary>Данни от въпросника</summary>
      <div id="initialAnswers"></div>
    </details>
    </section>
    <section id="menuTab" class="client-tab" role="tabpanel" aria-hidden="true">
    <details id="menuSection">
      <summary>Текущо меню</summary>
      <div id="planMenu"></div>
    </details>
    </section>
    <section id="logsTab" class="client-tab" role="tabpanel" aria-hidden="true">
    <details id="logsSection">
      <summary>Дневници</summary>
      <div id="dailyLogs"></div>
      <button id="toggleWeightChart">Покажи графика</button>
      <canvas id="weightChart" width="300" height="200" class="hidden"></canvas>
    </details>
    </section>
    <section id="dashboardTab" class="client-tab" role="tabpanel" aria-hidden="true">
      <div id="dashboardSummary">
        <details id="profileSection" class="accordion-container">
          <summary class="accordion-header">Профил</summary>
          <div id="profileSummary"></div>
        </details>
        <details id="statusSection" class="accordion-container">
          <summary class="accordion-header">Текущ статус</summary>
          <div id="statusSummary"></div>
        </details>
        <details id="analyticsSection" class="accordion-container">
          <summary class="accordion-header">Анализ</summary>
          <div id="analyticsSummary"></div>
        </details>
        <details id="planSummarySection" class="accordion-container">
          <summary class="accordion-header">План</summary>
          <div id="planSummary"></div>
        </details>
      </div>
      <details id="dashboardJsonSection">
        <summary>JSON</summary>
        <button id="copyDashboardJson" class="button button-small hidden" type="button">Копирай JSON</button>
        <pre id="dashboardData" class="json"></pre>
      </details>
      <button id="exportData">Експортирай всички данни</button>
      <button id="exportPlan">Експортирай плана като JSON</button>
      <button id="exportCsv">Експортирай дневниците CSV</button>
      <button id="generatePraise">Генерирай похвала</button>
      <p class="help-text">Експортираните файлове се запазват локално.</p>
    </section>

    <details id="queriesSection">
      <summary>Запитвания <span id="queriesDot" class="notification-dot hidden"></span></summary>
      <ul id="queriesList"></ul>
      <textarea id="newQueryText" rows="3" cols="40"></textarea><br>
      <button id="sendQuery">Изпрати запитване</button>
    </details>
    <details id="clientRepliesSection">
      <summary>Отговори от клиента <span id="repliesDot" class="notification-dot hidden"></span></summary>
      <ul id="clientRepliesList"></ul>
    </details>
    <details id="feedbackSection">
      <summary>Обратна връзка <span id="feedbackDot" class="notification-dot hidden"></span></summary>
      <ul id="feedbackList"></ul>
    </details>
    <details id="kvSection">
      <summary>KV данни</summary>
      <div id="kvData"></div>
    </details>
  </main>
  </div>

  <section id="statsSection" class="hidden">
    <h2>Статистика</h2>
    <pre id="statsOutput"></pre>
    <canvas id="statusChart" width="300" height="200"></canvas>
  </section>

  <details id="aiConfigSection" class="card">
    <summary>AI конфигурация</summary>
    <form id="aiConfigForm">
      <p class="note">Токените за моделите се задават като Worker secrets и не се
        редактират от този панел. Полето „Admin Token" се използва за
        удостоверяване на заявките към API.</p>
      <label>Admin Token: <input id="adminToken" type="text"></label>
      <datalist id="modelOptions"></datalist>
      <fieldset>
        <legend>Генериране на план</legend>
        <label>Модел: <input id="planModel" type="text" list="modelOptions"> <button type="button" id="testPlanModel">Тествай</button></label>
        <label>Промпт:<br><textarea id="planPrompt" rows="3"></textarea></label>
        <label>Token limit: <input id="planTokens" type="number" min="1"></label>
        <label>Temperature: <input id="planTemperature" type="number" min="0" max="1" step="0.1"></label>
        <small id="planHints" class="text-muted"></small>
      </fieldset>
      <fieldset>
        <legend>Чат</legend>
        <label>Модел: <input id="chatModel" type="text" list="modelOptions"> <button type="button" id="testChatModel">Тествай</button></label>
        <label>Промпт:<br><textarea id="chatPrompt" rows="2"></textarea></label>
        <label>Token limit: <input id="chatTokens" type="number" min="1"></label>
        <label>Temperature: <input id="chatTemperature" type="number" min="0" max="1" step="0.1"></label>
        <small id="chatHints" class="text-muted"></small>
      </fieldset>
      <fieldset>
        <legend>Модификация на плана</legend>
        <label>Модел: <input id="modModel" type="text" list="modelOptions"> <button type="button" id="testModModel">Тествай</button></label>
        <label>Промпт:<br><textarea id="modPrompt" rows="2"></textarea></label>
        <label>Token limit: <input id="modTokens" type="number" min="1"></label>
        <label>Temperature: <input id="modTemperature" type="number" min="0" max="1" step="0.1"></label>
        <small id="modHints" class="text-muted"></small>
      </fieldset>
      <fieldset>
        <legend>Анализ на изображение</legend>
        <label>Модел: <input id="imageModel" type="text" list="modelOptions"> <button type="button" id="testImageModel">Тествай</button></label>
        <label>Промпт:<br><textarea id="imagePrompt" rows="2" required></textarea></label>
        <label>Token limit: <input id="imageTokens" type="number" min="1"></label>
        <label>Temperature: <input id="imageTemperature" type="number" min="0" max="1" step="0.1"></label>
        <small id="imageHints" class="text-muted"></small>
      </fieldset>
      <fieldset>
        <legend>Анализ на въпросник</legend>
        <label>Модел: <input id="analysisModel" type="text" list="modelOptions"> <button type="button" id="testAnalysisModel">Тествай</button></label>
        <label>Промпт:<br><textarea id="analysisPrompt" rows="2"></textarea></label>
      </fieldset>
      <div class="preset-controls">
        <label>Запазени настройки:
          <select id="aiPresetSelect"></select>
        </label>
        <button type="button" id="applyPreset">Зареди</button>
        <label>Ново име: <input id="presetName" type="text"></label>
        <button type="button" id="savePreset">Запази пресет</button>
      </div>
      <button type="submit">Запази</button>
    </form>
  </details>

  <details id="emailSettingsSection" class="card">
    <summary>Настройки за имейли</summary>
    <form id="emailSettingsForm">
      <label>Име на подател:<br><input id="fromEmailName" type="text" placeholder="MyBody"></label>
      <div id="emailTypesContainer"></div>
      <template id="emailFieldsetTemplate">
        <fieldset>
          <legend></legend>
          <div data-extra></div>
          <label>Тема:<br><input type="text" data-subject></label>
          <div class="email-preview-subject" data-subject-preview></div>
          <label>Съдържание:<br><textarea rows="5" data-body></textarea></label>
          <div class="email-preview" data-preview></div>
          <label><input type="checkbox" data-send> <span data-send-label></span></label>
        </fieldset>
      </template>
      <button type="submit">Запази</button>
    </form>
  </details>


  <details id="colorSettings" class="card">
    <summary>Настройки на цветове</summary>
    <div id="colorInputs"></div>
    <button id="saveColorConfig">Запази</button>
    <div class="theme-controls">
      <label>Име на тема
        <input type="text" id="themeNameInput">
      </label>
      <button type="button" id="previewTheme">Прегледай</button>
      <button type="button" id="saveThemeLocal">Запиши тема</button>
      <select id="savedThemes"></select>
      <button type="button" id="applyThemeLocal">Зареди</button>
      <button type="button" id="deleteThemeLocal">Изтрий</button>
      <button type="button" id="renameThemeLocal">Преименувай</button>
      <button type="button" id="exportTheme">Изтегли тема</button>
      <input type="file" id="importTheme" accept="application/json" style="display:none">
      <button type="button" id="importThemeBtn">Качи тема</button>
    </div>
  </details>

  <details id="testEmailSection" class="card">
    <summary>Тестов имейл</summary>
    <form id="testEmailForm">
      <label>До:<br><input id="testEmailTo" type="email" required></label>
      <label>Тема:<br><input id="testEmailSubject" type="text" required></label>
      <label>Съдържание:<br><textarea id="testEmailBody" rows="5" required></textarea></label>
      <div id="testEmailPreview" class="email-preview"></div>
      <button type="submit">Изпрати</button>
    </form>
  </details>

  <details id="testImageSection" class="card">
    <summary>Тест на анализ на изображение</summary>
    <form id="testImageForm">
      <label>Файл:<br><input id="testImageFile" type="file" accept="image/*"></label>
      <label>Пояснение:<br><input id="testImagePrompt" type="text"></label>
      <button type="submit">Изпрати</button>
    </form>
    <pre id="testImageResult" class="json"></pre>
  </details>

  <details id="testQuestionnaireSection" class="card">
    <summary>Тест на анализ на въпросник</summary>
    <form id="testQuestionnaireForm">
      <label>Имейл:<br><input id="testQEmail" type="email"></label>
      <label>Клиент:<br><select id="testQClient"></select></label>
      <label>User ID:<br><input id="testQUserId" type="text"></label>
      <label>Файл с отговори:<br><input id="testQFile" type="file" accept="application/json"></label>
      <label>JSON отговори:<br><textarea id="testQText" rows="5"></textarea></label>
      <button type="submit">Изпрати</button>
    </form>
    <pre id="testQResult" class="json"></pre>
    <a id="openTestQAnalysis" class="button button-small hidden" target="_blank">Отвори анализа</a>
  </details>


  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="js/admin.js"></script>
  <script type="module" src="js/adminColors.js"></script>
</body>
</html>
