<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <title>–í–∏–∑—É–∞–ª–µ–Ω –¢–µ—Å—Ç | BodyBest</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="stylesheet" href="../css/base_styles.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" />
  <style>
    *{box-sizing:border-box;margin:0;padding:0; -webkit-tap-highlight-color: transparent;}
    
    body{
      min-height:100vh;
      font-family: var(--font-primary);
      background: var(--bg-gradient);
      color: var(--text-color-primary);
      padding-bottom: 40px;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
    .fade-in { animation: fadeIn 0.4s ease-out forwards; }
    @keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }

    .screen{display:none; min-height:100vh; padding:24px 20px; max-width: 600px; margin: 0 auto;}
    .screen.active{display:flex; flex-direction:column;}

    /* Back button */
    .back-btn {
      position: fixed;
      top: var(--space-md);
      left: var(--space-md);
      width: 44px;
      height: 44px;
      border-radius: var(--radius-round);
      background: var(--card-bg);
      border: 2px solid var(--border-color);
      color: var(--text-color-primary);
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-md);
      transition: all 0.3s ease;
      z-index: 1000;
      text-decoration: none;
    }
    .back-btn:hover {
      transform: scale(1.05);
      box-shadow: var(--shadow-lg);
      border-color: var(--primary-color);
      background: var(--primary-color);
      color: white;
    }
    .back-btn:active {
      transform: scale(0.95);
    }

    /* --------- Screen 1: Intro --------- */
    .intro{justify-content:center; text-align:center; gap:20px;}
    .logo-icon { 
      font-size: 40px; margin-bottom: 10px; display: block; 
    }
    .title{
      font-size: 26px; 
      font-weight: 800; 
      line-height: 1.2; 
      color: var(--text-color-primary);
    }
    .title span{ color: var(--primary-color); }
    .p{
      font-size: 16px; 
      line-height: 1.6; 
      color: var(--text-color-secondary);
    }
    .rules-card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 20px;
      box-shadow: var(--shadow-md);
      text-align: left;
      margin: 10px 0 20px;
      border: 1px solid var(--border-color-soft);
    }
    .rules-card h3 { font-size: 14px; text-transform: uppercase; color: var(--primary-color); letter-spacing: 1px; margin-bottom: 10px; }
    .rules{ padding-left: 20px; color: var(--text-color-primary); font-size: 15px; line-height: 1.6; }
    .rules li { margin-bottom: 8px; }

    .btn{
      width:100%;
      border:none;
      border-radius: 99px;
      padding: 18px;
      background: var(--primary-color);
      color: #fff;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(var(--primary-rgb), 0.3);
      transition: all 0.2s ease;
    }
    .btn:hover {
      background: color-mix(in srgb, var(--primary-color) 85%, black);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(var(--primary-rgb), 0.4);
    }
    .btn:active { transform: scale(0.98); }
    
    .btnGhost{
      display: block;
      text-align: center;
      margin-top: 15px;
      color: var(--text-color-secondary);
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      transition: color 0.2s;
    }
    .btnGhost:hover {
      color: var(--primary-color);
    }

    /* --------- Screen 2: Grid --------- */
    .gridHead{
      font-size: 18px; 
      font-weight: 600; 
      text-align: center; 
      margin-bottom: 20px;
      color: var(--text-color-primary);
    }
    .grid{
      flex:1;
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      padding-bottom: 20px;
    }
    .thumb{
      position: relative;
      border-radius: var(--radius-lg);
      overflow: hidden;
      background: var(--card-bg);
      border: 2px solid var(--border-color-soft);
      box-shadow: var(--shadow-md);
      cursor: pointer;
      transition: all 0.2s ease;
      aspect-ratio: 1/1;
    }
    .thumb:hover {
      border-color: var(--secondary-color);
      transform: scale(1.02);
      box-shadow: var(--shadow-lg);
    }
    .thumb:active { transform: scale(0.98); }
    .thumb img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    
    /* --------- Fullscreen Overlay --------- */
    .overlay{
      position: fixed; inset: 0; z-index: 100;
      background: rgba(var(--surface-background-rgb), 0.98);
      backdrop-filter: blur(8px);
      display: none;
      flex-direction: column;
      animation: fadeIn 0.2s ease-out;
    }
    .overlay.active{ display: flex; }
    
    .ovTop{ padding: 20px; display: flex; justify-content: flex-end; }
    .ovClose{
      background: var(--card-bg);
      border: 2px solid var(--border-color);
      color: var(--text-color-primary);
      width: 44px; height: 44px; border-radius: 50%;
      font-size: 20px; cursor: pointer; display: grid; place-items: center;
      transition: all 0.2s ease;
    }
    .ovClose:hover {
      background: var(--color-danger);
      border-color: var(--color-danger);
      color: white;
      transform: scale(1.05);
    }

    .ovBody{
      flex: 1; display: flex; align-items: center; justify-content: center; padding: 0 20px;
    }
    .ovImgWrap{
      width: 100%; max-height: 70vh;
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0,0,0,0.15);
      background: #fff;
    }
    .ovImgWrap img{ width: 100%; height: 100%; object-fit: contain; display: block; }
    
    .ovBottom{ padding: 30px 20px; display: flex; gap: 15px; }
    .btnSelect{
      flex: 2; border: none; border-radius: 99px; padding: 16px;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: #fff; font-weight: 700; font-size: 16px;
      box-shadow: 0 4px 15px color-mix(in srgb, var(--primary-color) 40%, transparent);
      cursor: pointer;
      transition: all 0.3s ease;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .btnSelect:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px color-mix(in srgb, var(--primary-color) 50%, transparent);
    }
    .btnSelect:active {
      transform: translateY(0);
    }
    .btnBack{
      flex: 1; border: 2px solid var(--border-color); border-radius: 99px; padding: 16px;
      background: var(--card-bg); color: var(--text-color-secondary); font-weight: 700; font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .btnBack:hover {
      background: var(--surface-background);
      border-color: var(--primary-color);
      color: var(--primary-color);
      transform: translateY(-2px);
    }
    .btnBack:active {
      transform: translateY(0);
    }

    /* --------- Screen 3: Result --------- */
    .resultImg{
      border-radius: var(--radius);
      overflow: hidden;
      height: 220px;
      width: 100%;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
    }
    .resultImg img{ width: 100%; height: 100%; object-fit: cover; }
    
    .h2{ font-size: 24px; font-weight: 800; color: var(--text-color-primary); margin-bottom: 5px; }
    .sub{ font-size: 15px; color: var(--text-color-secondary); font-weight: 500; margin-bottom: 25px; line-height: 1.5; }
    
    .section-title {
      font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.2px;
      color: var(--accent-color); margin: 25px 0 10px; display: block;
    }
    
    .card{
      background: var(--card-bg);
      border-radius: 16px;
      padding: 20px;
      border: 1px solid var(--border-color);
      box-shadow: 0 2px 10px rgba(0,0,0,0.03);
    }
    ul.clean{ list-style: none; }
    ul.clean li{ 
      display: flex; gap: 12px; margin-bottom: 12px; 
      font-size: 15px; line-height: 1.5; color: var(--text-color-primary); align-items: flex-start;
    }
    ul.clean li:last-child { margin-bottom: 0; }
    
    .icon { font-size: 16px; color: var(--accent-color); margin-top: 2px; flex-shrink: 0; }
    .icon-warn { color: var(--color-warning); } /* –ñ—ä–ª—Ç–æ-–æ—Ä–∞–Ω–∂–µ–≤–æ –∑–∞ —Ä–∏—Å–∫–æ–≤–µ */

    .actions{ margin-top: 40px; display: flex; gap: 15px; flex-direction: column; }
    .btnSmall{
      width: 100%; border: 1px solid var(--border-color); border-radius: 99px;
      padding: 15px; background: var(--card-bg); color: var(--text-color-secondary); font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .btnSmall:hover {
      background: var(--surface-background);
      border-color: var(--primary-color);
      color: var(--primary-color);
    }
  </style>
  <script type="module">
    // Theme initialization
    import { initializeTheme } from '../js/uiHandlers.js';
    
    document.addEventListener('DOMContentLoaded', () => {
      initializeTheme();
    });
  </script>
</head>
<body>
  <!-- Back to Profile Button -->
  <a href="../code.html#profile-tab" class="back-btn" title="–ù–∞–∑–∞–¥ –∫—ä–º –ø—Ä–æ—Ñ–∏–ª–∞">
    <i class="bi bi-arrow-left"></i>
  </a>

  <!-- Screen 1: Intro -->
  <section class="screen intro active" id="s1">
    <div class="fade-in">
      <span class="logo-icon">üåø</span>
      <div class="title">–û—Ç–∫—Ä–∏–π —Å–∫—Ä–∏—Ç–∏—è —Å–∏<br><span>—Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–Ω –ø—Ä–æ—Ñ–∏–ª</span></div>
      <p class="p" style="margin-top:10px">
        –¢–æ–∑–∏ –≤–∏–∑—É–∞–ª–µ–Ω —Ç–µ—Å—Ç –ø–æ–º–∞–≥–∞ –¥–∞ –Ω–∞–¥–Ω–∏–∫–Ω–µ—à –≤ –ø–æ–¥—Å—ä–∑–Ω–∞—Ç–µ–ª–Ω–∏—Ç–µ —Å–∏ –Ω–∞–≤–∏—Ü–∏ –∏ –≤—Ä—ä–∑–∫–∞—Ç–∞ —Ç–∏ —Å —Ö—Ä–∞–Ω–∞—Ç–∞.
      </p>
      
      <div class="rules-card">
        <h3>–ö–∞–∫ —Ä–∞–±–æ—Ç–∏:</h3>
        <ol class="rules">
          <li>–†–∞–∑–≥–ª–µ–¥–∞–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ç–∞.</li>
          <li>–ù–µ –º–∏—Å–ª–∏ –ª–æ–≥–∏—á–Ω–æ.</li>
          <li>–ò–∑–±–µ—Ä–∏ —Ç–æ–≤–∞, –∫–æ–µ—Ç–æ <strong>–Ω–∞–π-—Å–∏–ª–Ω–æ –ø—Ä–∏–≤–ª–∏—á–∞</strong> –≤–Ω–∏–º–∞–Ω–∏–µ—Ç–æ —Ç–∏ –≤ –º–æ–º–µ–Ω—Ç–∞.</li>
        </ol>
      </div>

      <button class="btn" id="start">–ó–∞–ø–æ—á–Ω–∏ —Ç–µ—Å—Ç–∞</button>
      <a class="btnGhost" href="about.html">–ù–∞—É—á–∏ –ø–æ–≤–µ—á–µ –∑–∞ –º–µ—Ç–æ–¥–∞</a>
    </div>
  </section>

  <!-- Screen 2: Grid -->
  <section class="screen" id="s2">
    <div class="gridHead fade-in">–ö–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑–æ–Ω–∏—Ä–∞ —Å —Ç–µ–± —Ç–æ—á–Ω–æ —Å–µ–≥–∞?</div>
    <div class="grid fade-in" id="grid"></div>
    <div style="text-align: center; margin-top: 10px;">
      <button class="btnGhost" id="backToIntro">‚Üê –û–±—Ä–∞—Ç–Ω–æ</button>
    </div>
  </section>

  <!-- Fullscreen Preview Overlay -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="ovTop">
      <button class="ovClose" id="ovClose">‚úï</button>
    </div>
    <div class="ovBody">
      <div class="ovImgWrap">
        <img id="ovImg" alt="–ü—Ä–µ–≥–ª–µ–¥" />
      </div>
    </div>
    <div class="ovBottom">
      <button class="btnBack" id="ovBack">–û—Ç–∫–∞–∑</button>
      <button class="btnSelect" id="ovSelect">–¢–æ–≤–∞ –µ –º–æ—è—Ç –∏–∑–±–æ—Ä</button>
    </div>
  </div>

  <!-- Screen 3: Result -->
  <section class="screen" id="s3">
    <div id="result" class="fade-in"></div>
    <div class="actions">
      <button class="btn" id="saveResultBtn" style="display: none;">–ó–∞–ø–∞–∑–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞</button>
      <button class="btn" id="again">–ù–∞–ø—Ä–∞–≤–∏ —Ç–µ—Å—Ç–∞ –æ—Ç–Ω–æ–≤–æ</button>
      <button class="btnSmall" id="toGrid">–í–∏–∂ –≤—Å–∏—á–∫–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏</button>
    </div>
  </section>

<script>
  // ---------------- CONFIG ----------------
  const IMG_EXT = "jpg"; 

  // –ü—Ä–µ—Ä–∞–±–æ—Ç–µ–Ω–∏ –∏ —Ö—É–º–∞–Ω–∏–∑–∏—Ä–∞–Ω–∏ —Ç–µ–∫—Å—Ç–æ–≤–µ
  const profiles = {
    "01": {
      name: "–ü–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏—Å—Ç—ä—Ç",
      short: "–°—Ç—Ä–µ–º–µ–∂ –∫—ä–º —Ä–µ–¥, –∫–æ–Ω—Ç—Ä–æ–ª –∏ –ø—Ä–∞–≤–∏–ª–∞.",
      psycho: [
        "–¢—ä—Ä—Å–∏—à —Å–∏–≥—É—Ä–Ω–æ—Å—Ç —á—Ä–µ–∑ —è—Å–Ω–∏ –ø—Ä–∞–≤–∏–ª–∞. –û–±–∏—á–∞—à –¥–∞ –∑–Ω–∞–µ—à —Ç–æ—á–Ω–æ –∫–∞–∫–≤–æ –∏ –∫–æ–ª–∫–æ –∫–æ–Ω—Å—É–º–∏—Ä–∞—à.",
        "–•—Ä–∞–Ω–∞—Ç–∞ —á–µ—Å—Ç–æ –µ –º–µ—Ä–∏–ª–æ –∑–∞ —Ç–≤–æ—è—Ç–∞ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –∏ –≤–æ–ª—è.",
        "–í—ä—Ç—Ä–µ—à–Ω–∏—è—Ç —Ç–∏ –∫—Ä–∏—Ç–∏–∫ –µ —Å–∏–ª–µ–Ω ‚Äì —á—É–≤—Å—Ç–≤–∞—à –≤–∏–Ω–∞, –∞–∫–æ –Ω–∞—Ä—É—à–∏—à —Å–æ–±—Å—Ç–≤–µ–Ω–∏—Ç–µ —Å–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏."
      ],
      habits: [
        "–°—Ç—Ä–æ–≥–∏ —á–∞—Å–æ–≤–µ –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–µ –∏ –∑–∞–±—Ä–∞–Ω–µ–Ω–∏ –≥—Ä—É–ø–∏ —Ö—Ä–∞–Ω–∏.",
        "–ë—Ä–æ–µ–Ω–µ –Ω–∞ –∫–∞–ª–æ—Ä–∏–∏ –∏–ª–∏ –≥—Ä–∞–º–æ–≤–µ, –∑–∞ –¥–∞ —Å–µ –Ω–∞–º–∞–ª–∏ —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—Ç–∞.",
        "–°–∫–ª–æ–Ω–Ω–æ—Å—Ç –∫—ä–º –ø—Ä–µ—è–∂–¥–∞–Ω–µ, –∫–æ–≥–∞—Ç–æ —Å–∏ —Å–∞–º–∞, —Å–ª–µ–¥ –¥—ä–ª—ä–≥ –ø–µ—Ä–∏–æ–¥ –Ω–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è."
      ],
      risks: [
        "–ò–∑—Ç–æ—â–∞–≤–∞–Ω–µ –Ω–∞ —Ç—è–ª–æ—Ç–æ –ø–æ—Ä–∞–¥–∏ —Ö—Ä–æ–Ω–∏—á–Ω–æ –Ω–µ–¥–æ—Ö—Ä–∞–Ω–≤–∞–Ω–µ.",
        "–°–æ—Ü–∏–∞–ª–Ω–∞ –∏–∑–æ–ª–∞—Ü–∏—è (–∏–∑–±—è–≥–≤–∞–Ω–µ –Ω–∞ –≤–µ—á–µ—Ä–∏ –Ω–∞–≤—ä–Ω, –∑–∞—â–æ—Ç–æ –Ω–µ –º–æ–∂–µ—à –¥–∞ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–∞—à —Ö—Ä–∞–Ω–∞—Ç–∞).",
        "–ó–∞–≥—É–±–∞ –Ω–∞ —É–¥–æ–≤–æ–ª—Å—Ç–≤–∏–µ—Ç–æ –æ—Ç —Ö—Ä–∞–Ω–µ–Ω–µ—Ç–æ."
      ]
    },
    "02": {
      name: "–ï–º–æ—Ü–∏–æ–Ω–∞–ª–Ω–∏—è—Ç",
      short: "–•—Ä–∞–Ω–∞—Ç–∞ –∫–∞—Ç–æ —É—Ç–µ—Ö–∞ –∏ –ø—Ä–µ–≥—Ä—ä–¥–∫–∞.",
      psycho: [
        "–°–∏–ª–Ω–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª–Ω–æ—Å—Ç –∏ –µ–º–ø–∞—Ç–∏—è. –•—Ä–∞–Ω–∞—Ç–∞ –µ –±—ä—Ä–∑ –Ω–∞—á–∏–Ω –¥–∞ —Å–µ —Å–ø—Ä–∞–≤–∏—à —Å –Ω–∞–ø—Ä–µ–∂–µ–Ω–∏–µ—Ç–æ.",
        "–ß–µ—Å—Ç–æ —É—Å–µ—â–∞—à –ø—Ä–∞–∑–Ω–æ—Ç–∞ –∏–ª–∏ —Å–∞–º–æ—Ç–∞, –∫–æ—è—Ç–æ –æ–ø–∏—Ç–≤–∞—à –¥–∞ –∑–∞–ø—ä–ª–Ω–∏—à —Å—ä—Å —Å–µ—Ç–∏–≤–µ–Ω —É—é—Ç.",
        "–¢—Ä—É–¥–Ω–æ —Ç–∏ –µ –¥–∞ —Ä–∞–∑–¥–µ–ª–∏—à —Ñ–∏–∑–∏—á–µ—Å–∫–∏—è –≥–ª–∞–¥ –æ—Ç –µ–º–æ—Ü–∏–æ–Ω–∞–ª–Ω–∞—Ç–∞ –Ω—É–∂–¥–∞."
      ],
      habits: [
        "–ü–æ—Å—è–≥–∞—à –∫—ä–º —Ö—Ä–∞–Ω–∞ –ø—Ä–∏ —Å—Ç—Ä–µ—Å, —Ç—ä–≥–∞ –∏–ª–∏ –¥–æ—Ä–∏ —Å–∫—É–∫–∞.",
        "–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞—à ‚Äû–∫–æ–º—Ñ–æ—Ä—Ç–Ω–∏‚Äú —Ö—Ä–∞–Ω–∏ ‚Äì –º–µ–∫–∏, —Å–ª–∞–¥–∫–∏ –∏–ª–∏ —Ç–µ—Å—Ç–µ–Ω–∏.",
        "–¶–∏–∫—ä–ª—ä—Ç: –≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±–ª–µ–∫—á–µ–Ω–∏–µ ‚Üí –ø–æ—Å–ª–µ–¥–≤–∞—â–∞ –≤–∏–Ω–∞."
      ],
      risks: [
        "–ü–æ–∫–∞—á–≤–∞–Ω–µ –Ω–∞ —Ç–µ–≥–ª–æ, –∫–æ–µ—Ç–æ –≤–æ–¥–∏ –¥–æ –Ω–∏—Å–∫–∞ —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞.",
        "–ü–æ—Ç–∏—Å–∫–∞–Ω–µ –Ω–∞ –µ–º–æ—Ü–∏–∏—Ç–µ, –≤–º–µ—Å—Ç–æ –¥–∞ –±—ä–¥–∞—Ç –ø—Ä–µ–∂–∏–≤–µ–Ω–∏ –∏ —Ä–∞–∑–±—Ä–∞–Ω–∏.",
        "–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç –æ—Ç —Ö—Ä–∞–Ω–∞—Ç–∞ –∫–∞—Ç–æ –æ—Å–Ω–æ–≤–µ–Ω –º–µ—Ö–∞–Ω–∏–∑—ä–º –∑–∞ —É—Å–ø–æ–∫–æ–µ–Ω–∏–µ."
      ]
    },
    "03": {
      name: "–¢—ä—Ä—Å–∞—á—ä—Ç –Ω–∞ —É–¥–æ–≤–æ–ª—Å—Ç–≤–∏–µ",
      short: "–ò–º–ø—É–ª—Å–∏–≤–Ω–æ—Å—Ç –∏ –∂–∞–∂–¥–∞ –∑–∞ —Å—Ç–∏–º—É–ª–∏.",
      psycho: [
        "–û–±–∏—á–∞—à —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ—Ç–æ –∏ –Ω–æ–≤–∏—Ç–µ —É—Å–µ—â–∞–Ω–∏—è. –°–∫—É–∫–∞—Ç–∞ –µ –Ω–∞–π-–≥–æ–ª–µ–º–∏—è—Ç —Ç–∏ –≤—Ä–∞–≥.",
        "–î–µ–π—Å—Ç–≤–∞—à ‚Äû—Ç—É–∫ –∏ —Å–µ–≥–∞‚Äú ‚Äì –∂–µ–ª–∞–Ω–∏–µ—Ç–æ –∑–∞ –Ω–∞–≥—Ä–∞–¥–∞ –∏–∑–ø—Ä–µ–≤–∞—Ä–≤–∞ –º–∏—Å—ä–ª—Ç–∞ –∑–∞ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è—Ç–∞.",
        "–¢—Ä—É–¥–Ω–æ —Ç–∏ –µ –¥–∞ –æ—Ç–ª–∞–≥–∞—à —É–¥–æ–≤–æ–ª—Å—Ç–≤–∏–µ—Ç–æ."
      ],
      habits: [
        "–ß–µ—Å—Ç–æ –ø–æ—Ö–∞–ø–≤–∞–Ω–µ ‚Äû–Ω–∞ –∫—Ä–∞–∫‚Äú –∏ —Ç—Ä—É–¥–Ω–æ —Å–ø–∏—Ä–∞–Ω–µ —Å–ª–µ–¥ ‚Äû—Å–∞–º–æ –µ–¥–Ω–æ –ø–∞—Ä—á–µ‚Äú.",
        "–í–ª–µ—á–µ–Ω–∏–µ –∫—ä–º —Å–∏–ª–Ω–∏ –≤–∫—É—Å–æ–≤–µ ‚Äì –º–Ω–æ–≥–æ —Å–ª–∞–¥–∫–æ, –º–Ω–æ–≥–æ —Å–æ–ª–µ–Ω–æ, —Ö—Ä—É–ø–∫–∞–≤–æ.",
        "–Ø–¥–µ—à, –∫–æ–≥–∞—Ç–æ –≤–∏–¥–∏—à –∏–ª–∏ –ø–æ–¥—É—à–∏—à —Ö—Ä–∞–Ω–∞, –∞ –Ω–µ –∫–æ–≥–∞—Ç–æ —Å–∏ –≥–ª–∞–¥–Ω–∞."
      ],
      risks: [
        "–ü—Ä–∏–µ–º–∞–Ω–µ –Ω–∞ –º–Ω–æ–≥–æ –µ–Ω–µ—Ä–≥–∏—è –±–µ–∑ —Ä–µ–∞–ª–Ω–æ —É—Å–µ—â–∞–Ω–µ –∑–∞ —Å–∏—Ç–æ—Å—Ç.",
        "–ù—É–∂–¥–∞ –æ—Ç –≤—Å–µ –ø–æ-—Å–∏–ª–Ω–∏ —Å—Ç–∏–º—É–ª–∏ (–≤–∫—É—Å–æ–≤–µ), –∑–∞ –¥–∞ –∏–∑–ø–∏—Ç–∞—à —É–¥–æ–≤–æ–ª—Å—Ç–≤–∏–µ.",
        "–¢—Ä—É–¥–Ω–æ—Å—Ç –ø—Ä–∏ —Å–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ –¥—ä–ª–≥–æ—Å—Ä–æ—á–Ω–∏ —Ü–µ–ª–∏."
      ]
    },
    "04": {
      name: "–†–∞–∑—Å–µ—è–Ω–∏—è—Ç / –î–∏—Å–æ—Ü–∏–∏—Ä–∞–Ω",
      short: "–õ–∏–ø—Å–∞ –Ω–∞ –≤—Ä—ä–∑–∫–∞ —Å —Ç—è–ª–æ—Ç–æ –∏ —Ä–∏—Ç—ä–º–∞.",
      psycho: [
        "–ñ–∏–≤–µ–µ—à ‚Äû–≤ –≥–ª–∞–≤–∞—Ç–∞ —Å–∏‚Äú (–º–∏—Å–ª–∏, –∏–¥–µ–∏, —Ä–∞–±–æ—Ç–∞) –∏ –∑–∞–±—Ä–∞–≤—è—à –∑–∞ —Ç—è–ª–æ—Ç–æ —Å–∏.",
        "–ù–µ —Ä–∞–∑–ø–æ–∑–Ω–∞–≤–∞—à –Ω–∞–≤—Ä–µ–º–µ —Å–∏–≥–Ω–∞–ª–∏—Ç–µ –∑–∞ –ª–µ–∫ –≥–ª–∞–¥, —É—Å–µ—â–∞—à –≥–æ —á–∞–∫ –∫–æ–≥–∞—Ç–æ —Å—Ç–∞–Ω–µ ‚Äû–≤—ä–ª—á–∏‚Äú.",
        "–•—Ä–∞–Ω–µ–Ω–µ—Ç–æ —á–µ—Å—Ç–æ —Å–µ –≤—ä–∑–ø—Ä–∏–µ–º–∞ –∫–∞—Ç–æ –¥–æ—Å–∞–¥–Ω–æ –∑–∞–¥—ä–ª–∂–µ–Ω–∏–µ."
      ],
      habits: [
        "–ü—Ä–æ–ø—É—Å–∫–∞—à —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–µ–∑ –¥–µ–Ω—è, –∞ –≤–µ—á–µ—Ä –ø—Ä–µ—è–∂–¥–∞—à —Ä—è–∑–∫–æ.",
        "–Ø–¥–µ—à –ø—Ä–µ–¥ –µ–∫—Ä–∞–Ω–∏, –±–µ–∑ –∏–∑–æ–±—â–æ –¥–∞ —É—Å–µ—â–∞—à –≤–∫—É—Å–∞ –Ω–∞ —Ö—Ä–∞–Ω–∞—Ç–∞.",
        "–•–∞–æ—Ç–∏—á–µ–Ω —Ä–µ–∂–∏–º ‚Äì —è–¥–µ—à ‚Äû–∫–∞–∫–≤–æ—Ç–æ –∏–º–∞‚Äú, –∫–æ–≥–∞—Ç–æ —Å–µ —Å–µ—Ç–∏—à."
      ],
      risks: [
        "–°—Ç–æ–º–∞—à–Ω–∏ –ø—Ä–æ–±–ª–µ–º–∏ –∏ –ø–æ–¥—É–≤–∞–Ω–µ –∑–∞—Ä–∞–¥–∏ –±—ä—Ä–∑–æ —Ö—Ä–∞–Ω–µ–Ω–µ –∏ –≥–æ–ª–µ–º–∏ –ø–æ—Ä—Ü–∏–∏.",
        "–•—Ä–æ–Ω–∏—á–Ω–∞ —É–º–æ—Ä–∞ –∏ ‚Äû–º–æ–∑—ä—á–Ω–∞ –º—ä–≥–ª–∞‚Äú –ø–æ—Ä–∞–¥–∏ –Ω–µ—Å—Ç–∞–±–∏–ª–Ω–∞ –∫—Ä—ä–≤–Ω–∞ –∑–∞—Ö–∞—Ä.",
        "–õ–∏–ø—Å–∞ –Ω–∞ –µ–Ω–µ—Ä–≥–∏—è –ø—Ä–µ–∑ –¥–µ–Ω—è."
      ]
    },
    "05": {
      name: "–í—Å–∏—á–∫–æ –∏–ª–∏ –Ω–∏—â–æ",
      short: "–¶–∏–∫—ä–ª—ä—Ç –Ω–∞ –¥–∏–µ—Ç–∏—Ç–µ –∏ —Å—Ä–∏–≤–æ–≤–µ—Ç–µ.",
      psycho: [
        "–ú–∏—Å–ª–∏—à –≤ –∫—Ä–∞–π–Ω–æ—Å—Ç–∏ ‚Äì –∏–ª–∏ —Å–∏ ‚Äû–ø–µ—Ä—Ñ–µ–∫—Ç–Ω–∞‚Äú, –∏–ª–∏ —Å–∏ —Å–µ ‚Äû–ø—Ä–æ–≤–∞–ª–∏–ª–∞‚Äú.",
        "–ï–¥–Ω–æ –º–∞–ª–∫–æ –ø–∞—Ä—á–µ —à–æ–∫–æ–ª–∞–¥ –º–æ–∂–µ –¥–∞ —Ç–µ –Ω–∞–∫–∞—Ä–∞ –¥–∞ —Å–∏ –∫–∞–∂–µ—à ‚Äû—â–æ–º —Å–≥—Ä–µ—à–∏—Ö, —â–µ –∏–∑—è–º –≤—Å–∏—á–∫–æ‚Äú.",
        "–°–∏–ª–Ω–æ —á—É–≤—Å—Ç–≤–æ –∑–∞ —Å—Ä–∞–º, —Å–≤—ä—Ä–∑–∞–Ω–æ —Å —Ç—è–ª–æ—Ç–æ."
      ],
      habits: [
        "–ü–µ—Ä–∏–æ–¥–∏ –Ω–∞ —Å—Ç—Ä–æ–≥–∏ –ª–∏—à–µ–Ω–∏—è, –ø–æ—Å–ª–µ–¥–≤–∞–Ω–∏ –æ—Ç –Ω–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ —Ö—Ä–∞–Ω–µ–Ω–µ.",
        "–û–ø–∏—Ç–∏ –∑–∞ ‚Äû–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è‚Äú —á—Ä–µ–∑ –≥–ª–∞–¥ –∏–ª–∏ —Å–ø–æ—Ä—Ç –Ω–∞ —Å–ª–µ–¥–≤–∞—â–∏—è –¥–µ–Ω.",
        "–ß–µ—Å—Ç–æ –∫—Ä–∏–µ—à –∫–∞–∫–≤–æ —è–¥–µ—à –æ—Ç –æ–∫–æ–ª–Ω–∏—Ç–µ."
      ],
      risks: [
        "–ô–æ-–π–æ –µ—Ñ–µ–∫—Ç, –∫–æ–π—Ç–æ –æ–±—ä—Ä–∫–≤–∞ –º–µ—Ç–∞–±–æ–ª–∏–∑–º–∞.",
        "–£—Å–µ—â–∞–Ω–µ –∑–∞ –±–µ–∑–ø–æ–º–æ—â–Ω–æ—Å—Ç –∏ –∑–∞–≥—É–±–∞ –Ω–∞ –≤—è—Ä–∞ –≤ —Å–µ–±–µ —Å–∏.",
        "–ü–æ–≤–∏—à–µ–Ω —Ä–∏—Å–∫ –æ—Ç —Ö—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏ —Ä–∞–∑—Å—Ç—Ä–æ–π—Å—Ç–≤–∞."
      ]
    },
    "06": {
      name: "–°–æ—Ü–∏–∞–ª–Ω–∏—è—Ç —Ö–∞–º–µ–ª–µ–æ–Ω",
      short: "–•—Ä–∞–Ω–µ–Ω–µ –∑–∞ –∫–æ–º–ø–∞–Ω–∏—è –∏ –æ–¥–æ–±—Ä–µ–Ω–∏–µ.",
      psycho: [
        "–ó–∞ —Ç–µ–± –µ –≤–∞–∂–Ω–æ –¥–∞ —Å–∏ —á–∞—Å—Ç –æ—Ç –≥—Ä—É–ø–∞—Ç–∞ –∏ –¥–∞ –Ω–µ —Å—ä–∑–¥–∞–≤–∞—à –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∏.",
        "–¢—Ä—É–¥–Ω–æ —Ç–∏ –µ –¥–∞ –∫–∞–∑–≤–∞—à ‚Äû–Ω–µ‚Äú, –∫–æ–≥–∞—Ç–æ —Ç–µ —á–µ—Ä–ø—è—Ç, –∑–∞ –¥–∞ –Ω–µ –æ–±–∏–¥–∏—à –Ω—è–∫–æ–≥–æ.",
        "–ì—Ä–∞–Ω–∏—Ü–∏—Ç–µ —Ç–∏ —Å–µ —Ä–∞–∑–º–∏–≤–∞—Ç, –∫–æ–≥–∞—Ç–æ —Å–∏ —Å—Ä–µ–¥ —Ö–æ—Ä–∞."
      ],
      habits: [
        "–°–∞–º/–∞ —Å–µ —Ö—Ä–∞–Ω–∏—à –±–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω–æ, –Ω–æ ‚Äû–∏–∑–ø—É—Å–∫–∞—à –∫—Ä–∞—è‚Äú –Ω–∞ —Å—ä–±–∏—Ç–∏—è –∏ –≥–æ—Å—Ç–∏.",
        "–Ø–¥–µ—à –∏ –ø–∏–µ—à –∑–∞—Ä–∞–¥–∏ –∫–æ–º–ø–∞–Ω–∏—è—Ç–∞, –¥–æ—Ä–∏ –¥–∞ –Ω–µ —Ç–∏ —Å–µ –∏—Å–∫–∞.",
        "–ü–æ—Ä—Ü–∏–∏—Ç–µ —Ç–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ç–æ–≤–∞ –∫–æ–ª–∫–æ —è–¥–∞—Ç –¥—Ä—É–≥–∏—Ç–µ, –Ω–µ –æ—Ç —Ç–≤–æ—è –≥–ª–∞–¥."
      ],
      risks: [
        "–ù–∞—Ç—Ä—É–ø–≤–∞–Ω–µ –Ω–∞ –∫–∏–ª–æ–≥—Ä–∞–º–∏, —Å–≤—ä—Ä–∑–∞–Ω–æ –æ—Å–Ω–æ–≤–Ω–æ —Å—ä—Å —Å–æ—Ü–∏–∞–ª–Ω–∏—è –∂–∏–≤–æ—Ç.",
        "–ó–∞–≥—É–±–∞ –Ω–∞ –ª–∏—á–Ω–∞ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç –ø—Ä–∏ –∏–∑–±–æ—Ä–∞ –Ω–∞ —Ö—Ä–∞–Ω–∞.",
        "–ß—É–≤—Å—Ç–≤–æ –Ω–∞ —è–¥ –∫—ä–º —Å–µ–±–µ —Å–∏ —Å–ª–µ–¥ –≤—Å—è–∫–æ —Å—ä–±–∏—Ä–∞–Ω–µ."
      ]
    },
    "07": {
      name: "–¢—Ä–µ–≤–æ–∂–Ω–∏—è—Ç / –û—Ä—Ç–æ—Ä–µ–∫—Å–∏—á–µ–Ω",
      short: "–ú–∞–Ω–∏—è –∑–∞ —á–∏—Å—Ç–æ—Ç–∞ –∏ –∑–¥—Ä–∞–≤–µ.",
      psycho: [
        "–°–≤–µ—Ç—ä—Ç —Ç–∏ –∏–∑–≥–ª–µ–∂–¥–∞ –æ–ø–∞—Å–Ω–æ –º—è—Å—Ç–æ, –∞ ‚Äû—á–∏—Å—Ç–∞—Ç–∞‚Äú —Ö—Ä–∞–Ω–∞ —Ç–∏ –¥–∞–≤–∞ –∏–ª—é–∑–∏—è –∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç.",
        "–ü–æ—Å—Ç–æ—è–Ω–Ω–æ –º–∏—Å–ª–∏—à –∑–∞ —Å—ä—Å—Ç–∞–≤–∫–∏, —Ç–æ–∫—Å–∏–Ω–∏ –∏ –≤—Ä–µ–¥–∏.",
        "–°–∞–º–æ–æ—Ü–µ–Ω–∫–∞—Ç–∞ —Ç–∏ –∑–∞–≤–∏—Å–∏ –æ—Ç —Ç–æ–≤–∞ –∫–æ–ª–∫–æ ‚Äû–ø—Ä–∞–≤–∏–ª–Ω–æ‚Äú —Å–∏ —è–ª –¥–Ω–µ—Å."
      ],
      habits: [
        "–ò–∑–∫–ª—é—á–≤–∞–Ω–µ –Ω–∞ —Ü–µ–ª–∏ –≥—Ä—É–ø–∏ —Ö—Ä–∞–Ω–∏ –±–µ–∑ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞ –ø—Ä–∏—á–∏–Ω–∞.",
        "–ú–∞–Ω–∏–∞–∫–∞–ª–Ω–æ —á–µ—Ç–µ–Ω–µ –Ω–∞ –µ—Ç–∏–∫–µ—Ç–∏ –∏ —Å—Ç—Ä–∞—Ö –æ—Ç —Ö—Ä–∞–Ω–∞, —Å–≥–æ—Ç–≤–µ–Ω–∞ –æ—Ç –¥—Ä—É–≥–∏.",
        "–ù–æ—Å–∏—à —Å–∏ –∫—É—Ç–∏–∏ —Å —Ö—Ä–∞–Ω–∞ –Ω–∞–≤—Å—è–∫—ä–¥–µ, –∑–∞ –¥–∞ –∏–∑–±–µ–≥–Ω–µ—à ‚Äû–∑–∞–º—ä—Ä—Å—è–≤–∞–Ω–µ‚Äú."
      ],
      risks: [
        "–î–µ—Ñ–∏—Ü–∏—Ç –Ω–∞ –≤–∞–∂–Ω–∏ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏ –≤–µ—â–µ—Å—Ç–≤–∞ –≤—ä–ø—Ä–µ–∫–∏ —Å—Ç—Ä–µ–º–µ–∂–∞ –∫—ä–º –∑–¥—Ä–∞–≤–µ.",
        "–°–∏–ª–Ω–∞ —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç, –∫–æ—è—Ç–æ –≤—Å—ä—â–Ω–æ—Å—Ç –≤—Ä–µ–¥–∏ –Ω–∞ –∑–¥—Ä–∞–≤–µ—Ç–æ –ø–æ–≤–µ—á–µ –æ—Ç —Ö—Ä–∞–Ω–∞—Ç–∞.",
        "–û–≥—Ä–∞–Ω–∏—á–µ–Ω —Å–æ—Ü–∏–∞–ª–µ–Ω –∂–∏–≤–æ—Ç."
      ]
    },
    "08": {
      name: "–ù–æ—â–Ω–∞—Ç–∞ –ø—Ç–∏—Ü–∞",
      short: "–î–µ–Ω–µ–º –≥–ª–∞–¥, –Ω–æ—â–µ–º –ø–∏—Ä.",
      psycho: [
        "–û—Ç–ª–∞–≥–∞—à –Ω—É–∂–¥–∏—Ç–µ —Å–∏ –ø—Ä–µ–∑ –¥–µ–Ω—è –∑–∞—Ä–∞–¥–∏ —Ä–∞–±–æ—Ç–∞ –∏–ª–∏ –¥—Ä—É–≥–∏ ‚Äû–ø–æ-–≤–∞–∂–Ω–∏‚Äú –Ω–µ—â–∞.",
        "–í–µ—á–µ—Ä—Ç–∞ –µ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–æ—Ç–æ —Ç–∏ –≤—Ä–µ–º–µ –∑–∞ —Å–µ–±–µ —Å–∏ –∏ —Ö—Ä–∞–Ω–∞—Ç–∞ —Å—Ç–∞–≤–∞ —Ä–∏—Ç—É–∞–ª –∑–∞ —Ä–µ–ª–∞–∫—Å.",
        "–í—è—Ä–≤–∞—à, —á–µ —â–µ —è–¥–µ—à ‚Äû–ø–æ-–∫—ä—Å–Ω–æ‚Äú, –Ω–æ —Ç–æ–≤–∞ –≤–æ–¥–∏ –¥–æ –ø—Ä–µ—Ç–æ–≤–∞—Ä–≤–∞–Ω–µ –≤–µ—á–µ—Ä."
      ],
      habits: [
        "–ö–∞—Ñ–µ—Ç–∞ –∏ –º–∞–ª–∫–∏ –∑–∞–∫—É—Å–∫–∏ –ø—Ä–µ–∑ –¥–µ–Ω—è, –æ–±–∏–ª–Ω–∞ –≤–µ—á–µ—Ä—è –∫—ä—Å–Ω–æ –≤–µ—á–µ—Ä.",
        "–•—Ä–∞–Ω–µ–Ω–µ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–æ –ø—Ä–µ–¥–∏ —Å—ä–Ω, —á–µ—Å—Ç–æ –ø—Ä–µ–¥ —Ç–µ–ª–µ–≤–∏–∑–æ—Ä–∞.",
        "–¢—Ä—É–¥–Ω–æ —Å—Ç–∞–≤–∞–Ω–µ —Å—É—Ç—Ä–∏–Ω –∏ –ª–∏–ø—Å–∞ –Ω–∞ –∞–ø–µ—Ç–∏—Ç –∑–∞ –∑–∞–∫—É—Å–∫–∞."
      ],
      risks: [
        "–ù–∞—Ä—É—à–µ–Ω —Å—ä–Ω –∏ —Ö—Ä–æ–Ω–∏—á–Ω–∞ —É–º–æ—Ä–∞.",
        "–ú–µ—Ç–∞–±–æ–ª–∏—Ç–Ω–∏ –ø—Ä–æ–±–ª–µ–º–∏ (—Ç—è–ª–æ—Ç–æ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–≤–∞ –¥–æ–±—Ä–µ —Ö—Ä–∞–Ω–∞—Ç–∞ –ø—Ä–µ–∑ –Ω–æ—â—Ç–∞).",
        "–¢—Ä—É–¥–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª –Ω–∞ —Ç–µ–≥–ª–æ—Ç–æ –≤—ä–ø—Ä–µ–∫–∏ ‚Äû–º–∞–ª–∫–æ—Ç–æ‚Äú —Ö—Ä–∞–Ω–∞ –ø—Ä–µ–∑ –¥–µ–Ω—è."
      ]
    }
  };

  // ---------------- UI LOGIC ----------------
  const s1 = document.getElementById("s1");
  const s2 = document.getElementById("s2");
  const s3 = document.getElementById("s3");
  const grid = document.getElementById("grid");
  const overlay = document.getElementById("overlay");
  const ovImg = document.getElementById("ovImg");
  const ovClose = document.getElementById("ovClose");
  const ovBack = document.getElementById("ovBack");
  const ovSelect = document.getElementById("ovSelect");
  const result = document.getElementById("result");

  let pendingId = null;
  let pendingSrc = null;

  // Scroll to top helper
  const scrollToTop = () => window.scrollTo({top: 0, behavior: 'smooth'});

  function show(screen){
    [s1,s2,s3].forEach(x=>x.classList.remove("active"));
    screen.classList.add("active");
    scrollToTop();
  }

  document.getElementById("start").addEventListener("click", ()=>show(s2));
  document.getElementById("backToIntro").addEventListener("click", ()=>show(s1));
  document.getElementById("again").addEventListener("click", ()=>{
    // –°–∫—Ä–∏–≤–∞–º–µ –±—É—Ç–æ–Ω–∞ "–ó–∞–ø–∞–∑–∏" –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω –æ–ø–∏—Ç
    const saveBtn = document.getElementById('saveResultBtn');
    if (saveBtn) {
      saveBtn.style.display = 'none';
    }
    show(s2);
  });
  document.getElementById("toGrid").addEventListener("click", ()=>show(s2));
  
  // –°—ä–±–∏—Ç–∏–µ –∑–∞ –±—É—Ç–æ–Ω–∞ "–ó–∞–ø–∞–∑–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞"
  document.getElementById("saveResultBtn").addEventListener("click", async ()=>{
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ pendingId
    if(!pendingId || !profiles[pendingId]) {
      console.error('Invalid profile ID:', pendingId);
      showSaveStatus('error', '–ì—Ä–µ—à–∫–∞: –ù–µ–≤–∞–ª–∏–¥–µ–Ω –ø—Ä–æ—Ñ–∏–ª. –ú–æ–ª—è –æ–ø–∏—Ç–∞–π—Ç–µ –æ—Ç–Ω–æ–≤–æ —Ç–µ—Å—Ç–∞.');
      return;
    }
    
    const saveBtn = document.getElementById('saveResultBtn');
    const originalText = saveBtn.textContent;
    
    // –ü–æ–∫–∞–∑–≤–∞–º–µ –∏–Ω–¥–∏–∫–∞—Ü–∏—è –∑–∞ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ
    saveBtn.textContent = '–ó–∞–ø–∞–∑–≤–∞–Ω–µ...';
    saveBtn.disabled = true;
    
    try {
      await saveVisualTestResult(pendingId);
    } finally {
      saveBtn.textContent = originalText;
      saveBtn.disabled = false;
    }
  });

  // Build grid
  const ids = ["01","02","03","04","05","06","07","08"];
  
  // –†–∞–∑–±—ä—Ä–∫–≤–∞–Ω–µ –Ω–∞ –º–∞—Å–∏–≤–∞, –∑–∞ –¥–∞ –Ω–µ —Å–∞ –≤–∏–Ω–∞–≥–∏ –≤ –µ–¥–∏–Ω —Ä–µ–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ, —Ç—É–∫ –µ –∏–∑–∫–ª—é—á–µ–Ω–æ –∑–∞ —Å–µ–≥–∞)
  // ids.sort(() => Math.random() - 0.5);

  ids.forEach(id=>{
    const btn = document.createElement("button");
    btn.className = "thumb";
    btn.type = "button";
    
    const img = document.createElement("img");
    img.src = `${id}.${IMG_EXT}`;
    img.alt = `–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${id}`;
    
    btn.appendChild(img);

    btn.addEventListener("click", ()=>{
      pendingId = id;
      pendingSrc = img.src;
      ovImg.src = img.src;
      openOverlay();
    });

    grid.appendChild(btn);
  });

  function openOverlay(){
    overlay.classList.add("active");
    overlay.setAttribute("aria-hidden","false");
    document.body.style.overflow = "hidden"; // Stop background scrolling
  }
  
  function closeOverlay(){
    overlay.classList.remove("active");
    overlay.setAttribute("aria-hidden","true");
    document.body.style.overflow = "";
  }

  ovClose.addEventListener("click", closeOverlay);
  ovBack.addEventListener("click", closeOverlay);
  
  // Close on background click
  overlay.addEventListener("click", (e)=>{
    if(e.target === overlay || e.target.classList.contains('ovTop')) closeOverlay();
  });

  // –ò–∑–±–æ—Ä –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ - –ø–æ–∫–∞–∑–≤–∞–º–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ –±–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø–∞–∑–≤–∞–Ω–µ
  // –ó–∞–ø–∞–∑–≤–∞–Ω–µ—Ç–æ —Å–µ —Å–ª—É—á–≤–∞ —Å–∞–º–æ –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–µ –Ω–∞ –±—É—Ç–æ–Ω–∞ "–ó–∞–ø–∞–∑–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞"
  ovSelect.addEventListener("click", ()=>{
    if(!pendingId) return;
    closeOverlay();
    renderResult(pendingId, pendingSrc);
    show(s3);
  });

  function renderResult(id, src){
    const p = profiles[id];
    if(!p) return;

    // –ü–æ–∫–∞–∑–≤–∞–º–µ –±—É—Ç–æ–Ω–∞ "–ó–∞–ø–∞–∑–∏"
    const saveBtn = document.getElementById('saveResultBtn');
    if (saveBtn) {
      saveBtn.style.display = 'block';
    }

    // Helper for lists
    const makeList = (items, isRisk) => `
      <ul class="clean">
        ${items.map(text => `
          <li>
            <span class="icon ${isRisk?'icon-warn':''}">‚óè</span>
            <span>${text}</span>
          </li>
        `).join("")}
      </ul>
    `;

    result.innerHTML = `
      <div class="resultImg">
        <img src="${src}" alt="–ò–∑–±–æ—Ä">
      </div>

      <div class="h2">${p.name}</div>
      <div class="sub">${p.short}</div>

      <span class="section-title">–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ –ø—Ä–æ—Ñ–∏–ª</span>
      <div class="card">
        ${makeList(p.psycho, false)}
      </div>

      <span class="section-title">–•–∞—Ä–∞–∫—Ç–µ—Ä–Ω–∏ –Ω–∞–≤–∏—Ü–∏</span>
      <div class="card">
        ${makeList(p.habits, false)}
      </div>

      <span class="section-title" style="color:#c77dff; color: #e09f3e;">–ó–∞ –∫–∞–∫–≤–æ –¥–∞ –≤–Ω–∏–º–∞–≤–∞—à</span>
      <div class="card" style="border-color: #fbd38d;">
        ${makeList(p.risks, true)}
      </div>
      
      <div id="saveStatusMessage" style="margin-top: 20px;"></div>
    `;
  }
  
  // –ó–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞ –æ—Ç –≤–∏–∑—É–∞–ª–Ω–∏—è —Ç–µ—Å—Ç
  async function saveVisualTestResult(profileId) {
    try {
      const profile = profiles[profileId];
      if (!profile) {
        showSaveStatus('error', '–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª–∞');
        return;
      }
      
      const timestamp = new Date().toISOString();
      
      // –û–±–æ–≥–∞—Ç–µ–Ω–∞ –≤–µ—Ä—Å–∏—è —Å—ä—Å —Å—ä–¥—ä—Ä–∂–∞—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ AI –∞–Ω–∞–ª–∏–∑
      const visualTest = {
        id: profileId,
        name: profile.name,
        short: profile.short,
        // –ó–∞–ø–∞–∑–≤–∞–º–µ –ø—ä–ª–Ω–∏—Ç–µ –º–∞—Å–∏–≤–∏ –∑–∞ –ø–æ-–∑–∞–¥—ä–ª–±–æ—á–µ–Ω –∞–Ω–∞–ª–∏–∑
        mainPsycho: profile.psycho || [], // –í—Å–∏—á–∫–∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
        mainHabits: profile.habits || [], // –í—Å–∏—á–∫–∏ –Ω–∞–≤–∏—Ü–∏
        mainRisks: profile.risks || [], // –í—Å–∏—á–∫–∏ —Ä–∏—Å–∫–æ–≤–µ
        // –î–æ–±–∞–≤—è–º–µ –æ–±–æ–±—â–µ–Ω–∏–µ –∑–∞ –±—ä—Ä–∑ –ø—Ä–µ–≥–ª–µ–¥
        summary: `${profile.name} - ${profile.short}`,
        timestamp: timestamp
      };
      
      // –ó–∞–ø–∞–∑–≤–∞–Ω–µ –≤ localStorage (–≤–∏–Ω–∞–≥–∏)
      const existingData = JSON.parse(localStorage.getItem('psychTests') || '{}');
      existingData.visualTest = visualTest;
      localStorage.setItem('psychTests', JSON.stringify(existingData));
      console.log('[VISUAL TEST] –†–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ —Å–∞ –∑–∞–ø–∞–∑–µ–Ω–∏ –≤ localStorage:', visualTest);
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ —Ç–µ—Å—Ç–∞ –µ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω –æ—Ç –ø—Ä–æ—Ñ–∏–ª–∞
      const urlParams = new URLSearchParams(window.location.search);
      const fromProfile = urlParams.get('from') === 'profile';
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ userId
      const userId = sessionStorage.getItem('userId') || localStorage.getItem('userId');
      
      if (!userId) {
        console.warn('[VISUAL TEST] –ù—è–º–∞ userId - –ø–æ–∫–∞–∑–≤–∞ —Å–µ —Å—ä–æ–±—â–µ–Ω–∏–µ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è');
        if (fromProfile) {
          // –ê–∫–æ —Ç–µ—Å—Ç–∞ –µ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω –æ—Ç –ø—Ä–æ—Ñ–∏–ª–∞, –Ω–æ –Ω—è–º–∞ userId - –Ω–µ—â–æ –Ω–µ –µ –Ω–∞—Ä–µ–¥
          showSaveStatus('error', '–ì—Ä–µ—à–∫–∞: –ù–µ —Å—Ç–µ –≤–ª–µ–∑–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–∞—Ç–∞. –ú–æ–ª—è —Ä–µ—Ñ—Ä–µ—à–Ω–µ—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞ –∏ –æ–ø–∏—Ç–∞–π—Ç–µ –æ—Ç–Ω–æ–≤–æ.');
        } else {
          // –ê–∫–æ —Ç–µ—Å—Ç–∞ –µ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω –¥–∏—Ä–µ–∫—Ç–Ω–æ - –ø–æ–∫–∞–∑–≤–∞–º–µ —Å—ä–æ–±—â–µ–Ω–∏–µ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
          showSaveStatus('warning', '–ó–∞ –¥–∞ –∑–∞–ø–∞–∑–∏—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ –≤ –ø—Ä–æ—Ñ–∏–ª–∞ —Å–∏, –º–æ–ª—è –ø—ä—Ä–≤–æ <a href="../login.html" style="color: inherit; text-decoration: underline;">–≤–ª–µ–∑—Ç–µ –≤ –∞–∫–∞—É–Ω—Ç–∞ —Å–∏</a> –∏–ª–∏ <a href="../index.html#register" style="color: inherit; text-decoration: underline;">—Å–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–π—Ç–µ</a>. –†–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ —Å–∞ –∑–∞–ø–∞–∑–µ–Ω–∏ –ª–æ–∫–∞–ª–Ω–æ –≤ –±—Ä–∞—É–∑—ä—Ä–∞.');
        }
        return;
      }
      
      // –û–ø–∏—Ç –∑–∞ backend –∑–∞–ø–∞–∑–≤–∞–Ω–µ
      console.log('[VISUAL TEST] –û–ø–∏—Ç –∑–∞ backend –∑–∞–ø–∞–∑–≤–∞–Ω–µ –∑–∞ userId:', userId);
      const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
        ? 'http://localhost:8787'
        : 'https://openapichatbot.radilov-k.workers.dev';
      
      const response = await fetch(`${API_BASE}/api/savePsychTests`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          userId: userId,
          visualTest: visualTest
        })
      });
      
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }
      
      const result = await response.json();
      console.log('[VISUAL TEST] Backend –æ—Ç–≥–æ–≤–æ—Ä:', result);
      
      if (result.success) {
        console.log('[VISUAL TEST] ‚úì –£—Å–ø–µ—à–Ω–æ –∑–∞–ø–∞–∑–≤–∞–Ω–µ –≤ backend');
        localStorage.setItem('psychTestsLastSync', timestamp);
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ —Å–µ –ø—Ä–µ–ø–æ—Ä—ä—á–≤–∞ —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –ø–ª–∞–Ω–∞
        if (result.data && result.data.shouldRegeneratePlan) {
          const reason = result.data.regenerationReason || '–ü—Ä–µ–ø–æ—Ä—ä—á–≤–∞–º–µ —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –ø–ª–∞–Ω–∞ –∑–∞ –ø—ä–ª–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞ –ø—Å–∏—Ö–æ–ø—Ä–æ—Ñ–∏–ª–∞.';
          showSaveStatus('success', `
            <div style="margin-bottom: 12px;">‚úì –†–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ —Å–∞ –∑–∞–ø–∞–∑–µ–Ω–∏ —É—Å–ø–µ—à–Ω–æ –≤ –ø—Ä–æ—Ñ–∏–ª–∞ –≤–∏!</div>
            <div style="background: rgba(255, 193, 7, 0.1); padding: 12px; border-radius: 8px; margin: 12px 0; border-left: 3px solid #ffc107;">
              <strong>üí° –ü—Ä–µ–ø–æ—Ä—ä–∫–∞:</strong> ${reason}
              <div style="margin-top: 8px;">
                <a href="../code.html#profile-tab" style="color: #22c55e; text-decoration: underline; font-weight: 600;">
                  –û—Ç–∏–¥–µ—Ç–µ –≤ –ø—Ä–æ—Ñ–∏–ª–∞ ‚Üí –†–µ–≥–µ–Ω–µ—Ä–∏—Ä–∞–π—Ç–µ –ø–ª–∞–Ω–∞
                </a>
              </div>
            </div>
          `);
        } else {
          showSaveStatus('success', '–†–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ —Å–∞ –∑–∞–ø–∞–∑–µ–Ω–∏ —É—Å–ø–µ—à–Ω–æ –≤ –ø—Ä–æ—Ñ–∏–ª–∞ –≤–∏! <a href="../code.html#profile-tab" style="color: inherit; text-decoration: underline;">–í–∏–∂—Ç–µ –ø—Ä–æ—Ñ–∏–ª–∞ —Å–∏ —Ç—É–∫</a>.');
        }
      } else {
        console.error('[VISUAL TEST] Backend –≥—Ä–µ—à–∫–∞:', result.message);
        showSaveStatus('warning', `–†–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ —Å–∞ –∑–∞–ø–∞–∑–µ–Ω–∏ –ª–æ–∫–∞–ª–Ω–æ. Backend –≥—Ä–µ—à–∫–∞: ${result.message || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞ –≥—Ä–µ—à–∫–∞'}`);
      }
    } catch (error) {
      console.error('[VISUAL TEST] –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∞–∑–≤–∞–Ω–µ:', error);
      showSaveStatus('error', `–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∞–∑–≤–∞–Ω–µ: ${error.message}. –†–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ —Å–∞ –∑–∞–ø–∞–∑–µ–Ω–∏ –ª–æ–∫–∞–ª–Ω–æ.`);
    }
  }
  
  function showSaveStatus(status, message) {
    const messageDiv = document.getElementById('saveStatusMessage');
    if (!messageDiv) return;
    
    // –°–∫—Ä–∏–≤–∞–º–µ –±—É—Ç–æ–Ω–∞ "–ó–∞–ø–∞–∑–∏" —Å–∞–º–æ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–∞–∑–≤–∞–Ω–µ
    const saveBtn = document.getElementById('saveResultBtn');
    if (saveBtn && status === 'success') {
      saveBtn.style.display = 'none';
    }
    
    let bgColor, borderColor, iconColor, icon, textColor;
    
    if (status === 'success') {
      bgColor = '#d4edda';
      borderColor = '#c3e6cb';
      textColor = '#155724';
      icon = '‚úì';
      iconColor = '#28a745';
    } else if (status === 'warning') {
      bgColor = '#fff3cd';
      borderColor = '#ffeaa7';
      textColor = '#856404';
      icon = '‚ö†';
      iconColor = '#ffc107';
    } else { // error
      bgColor = '#f8d7da';
      borderColor = '#f5c6cb';
      textColor = '#721c24';
      icon = '‚úï';
      iconColor = '#dc3545';
    }
    
    messageDiv.innerHTML = `
      <div style="background: ${bgColor}; border: 1px solid ${borderColor}; border-radius: 16px; padding: 20px; text-align: center;">
        <div style="font-size: 20px; margin-bottom: 10px; color: ${iconColor};">${icon}</div>
        <div style="font-weight: 700; color: ${textColor}; margin-bottom: ${message ? '10px' : '0'}; font-size: 16px;">
          ${status === 'success' ? '–£—Å–ø–µ—à–Ω–æ –∑–∞–ø–∞–∑–≤–∞–Ω–µ!' : status === 'warning' ? '–ß–∞—Å—Ç–∏—á–Ω–æ –∑–∞–ø–∞–∑–≤–∞–Ω–µ' : '–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∞–∑–≤–∞–Ω–µ'}
        </div>
        ${message ? `<div style="font-size: 14px; color: ${textColor}; line-height: 1.5;">${message}</div>` : ''}
      </div>
    `;
  }
</script>
</body>
</html>
