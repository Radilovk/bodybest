<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Личностен Психотест | BodyBest</title>
  <style>
    :root {
      --bg: #f8f9fb;
      --panel: #ffffff;
      --text: #2d3748;
      --muted: #718096;
      --border: #e2e8f0;
      --accent: #4c9adb;
      --accent-hover: #3182ce;
      --accent-light: #ebf5ff;
      --warning: #ed8936;
      --danger: #e53e3e;
      --success: #38a169;
      --radius: 12px;
      --shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      --shadow-hover: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: var(--text);
      line-height: 1.6;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    .screen {
      display: none;
      animation: fadeIn 0.3s ease-in;
    }

    .screen.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }

    .header h1 {
      font-size: 28px;
      margin-bottom: 10px;
      color: var(--accent);
      font-weight: 600;
    }

    .header p {
      color: var(--muted);
      font-size: 15px;
    }

    /* Intro Screen */
    .intro-content {
      background: var(--panel);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 30px;
      box-shadow: var(--shadow);
      transition: box-shadow 0.3s ease;
    }

    .intro-content:hover {
      box-shadow: var(--shadow-hover);
    }

    .intro-content h2 {
      font-size: 22px;
      margin-bottom: 15px;
      color: var(--accent);
    }

    .intro-content p {
      margin-bottom: 15px;
      color: var(--muted);
    }

    .intro-content ul {
      margin: 20px 0 20px 20px;
      color: var(--text);
    }

    .intro-content li {
      margin-bottom: 10px;
    }

    /* Button Styles */
    .btn {
      width: 100%;
      padding: 14px 24px;
      border: none;
      border-radius: 999px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-primary:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px -2px rgba(76, 154, 219, 0.4);
    }

    .btn-secondary {
      background: white;
      color: var(--text);
      border: 1px solid var(--border);
      margin-top: 10px;
    }

    .btn-secondary:hover {
      background: var(--bg);
      border-color: var(--accent);
      color: var(--accent);
    }

    /* Progress Bar */
    .progress-container {
      margin-bottom: 30px;
    }

    .progress-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 13px;
      color: var(--muted);
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--border);
      border-radius: 999px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent) 0%, #667eea 100%);
      transition: width 0.3s ease;
      border-radius: 999px;
    }

    /* Question Card */
    .question-card {
      background: var(--panel);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 30px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
    }

    .question-number {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--accent);
      margin-bottom: 10px;
      font-weight: 700;
    }

    .question-text {
      font-size: 20px;
      margin-bottom: 20px;
      color: var(--text);
      font-weight: 600;
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 20px;
    }

    .option {
      background: white;
      border: 2px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .option:hover {
      background: var(--accent-light);
      border-color: var(--accent);
      transform: translateX(4px);
    }

    .option.selected {
      background: var(--accent-light);
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(76, 154, 219, 0.1);
    }

    .option-radio {
      width: 20px;
      height: 20px;
      border: 2px solid var(--border);
      border-radius: 50%;
      flex-shrink: 0;
      position: relative;
      transition: all 0.2s;
    }

    .option.selected .option-radio {
      border-color: var(--accent);
    }

    .option.selected .option-radio::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 10px;
      height: 10px;
      background: var(--accent);
      border-radius: 50%;
    }

    .option-text {
      flex: 1;
      font-size: 15px;
      color: var(--text);
    }

    .legend {
      font-size: 13px;
      color: var(--muted);
      font-style: italic;
      padding: 12px;
      background: var(--accent-light);
      border-radius: 8px;
      border-left: 3px solid var(--accent);
    }

    /* Navigation */
    .navigation {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }

    .navigation .btn {
      flex: 1;
    }

    /* Results Screen */
    .results-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .results-header h2 {
      font-size: 26px;
      margin-bottom: 10px;
      color: var(--accent);
    }

    .results-header p {
      color: var(--muted);
    }

    .dimension-card {
      background: var(--panel);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: var(--shadow);
    }

    .dimension-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .dimension-name {
      font-size: 16px;
      font-weight: 700;
      color: var(--text);
    }

    .dimension-code {
      font-size: 20px;
      font-weight: 800;
      padding: 4px 12px;
      border-radius: 8px;
      background: var(--accent-light);
      color: var(--accent);
    }

    .dimension-description {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 12px;
    }

    .score-bar-container {
      position: relative;
      margin-bottom: 8px;
    }

    .score-bar-labels {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .score-bar {
      width: 100%;
      height: 24px;
      background: linear-gradient(90deg, #667eea 0%, var(--accent) 100%);
      border-radius: 999px;
      position: relative;
      overflow: hidden;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06);
    }

    .score-marker {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 4px;
      height: 32px;
      background: white;
      border-radius: 999px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
    }

    .score-value {
      text-align: center;
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }

    .type-code-card {
      background: linear-gradient(135deg, var(--accent-light) 0%, #e0f2fe 100%);
      border: 2px solid var(--accent);
      border-radius: var(--radius);
      padding: 24px;
      text-align: center;
      margin: 30px 0;
      box-shadow: var(--shadow);
    }

    .type-code-label {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .type-code-value {
      font-size: 32px;
      font-weight: 800;
      color: var(--accent);
      letter-spacing: 0.05em;
    }

    .flags-section {
      margin: 30px 0;
    }

    .flags-section h3 {
      font-size: 18px;
      margin-bottom: 16px;
      color: var(--text);
    }

    .flag-card {
      background: #fff5f5;
      border: 1px solid #feb2b2;
      border-radius: var(--radius);
      padding: 16px;
      margin-bottom: 12px;
    }

    .flag-card.warning {
      background: #fffaf0;
      border-color: #fbd38d;
    }

    .flag-title {
      font-weight: 700;
      color: var(--text);
      margin-bottom: 6px;
    }

    .flag-description {
      font-size: 14px;
      color: var(--muted);
    }

    /* AI Analysis Section */
    .ai-section {
      margin: 30px 0;
    }

    .ai-section h3 {
      font-size: 20px;
      margin-bottom: 16px;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .ai-badge {
      font-size: 11px;
      padding: 4px 10px;
      background: linear-gradient(135deg, var(--accent) 0%, #667eea 100%);
      color: white;
      border-radius: 999px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .ai-content {
      background: var(--panel);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 24px;
      box-shadow: var(--shadow);
    }

    .ai-subsection {
      margin-bottom: 24px;
    }

    .ai-subsection:last-child {
      margin-bottom: 0;
    }

    .ai-subsection h4 {
      font-size: 16px;
      color: var(--text);
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border);
    }

    .ai-list {
      list-style: none;
      padding: 0;
    }

    .ai-list li {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
      padding-left: 8px;
    }

    .ai-bullet {
      color: var(--accent);
      font-weight: 700;
      flex-shrink: 0;
    }

    .ai-text {
      flex: 1;
      font-size: 14px;
      color: var(--muted);
      line-height: 1.6;
    }

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      gap: 12px;
    }

    .loading-spinner {
      width: 24px;
      height: 24px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      color: var(--muted);
      font-size: 14px;
    }

    /* Responsive */
    @media (max-width: 640px) {
      .container {
        padding: 16px;
      }

      .header h1 {
        font-size: 24px;
      }

      .question-text {
        font-size: 18px;
      }

      .intro-content, .question-card {
        padding: 20px;
      }

      .type-code-value {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Intro Screen -->
    <div id="screenIntro" class="screen active">
      <div class="header">
        <h1>Личностен Психопрофил</h1>
        <p>Кратък тест за личностни характеристики и хранителни навици</p>
      </div>
      <div class="intro-content">
        <h2>Добре дошли!</h2>
        <p>Този тест съдържа 13 въпроса, които помагат да се оцени личностният ви профил и потенциални връзки с хранителните навици.</p>
        <ul>
          <li>Всеки въпрос има три равностойни опции</li>
          <li>Изберете опцията, която е <strong>най-близка до естествения ви избор</strong> в повечето случаи</li>
          <li>Няма правилни или грешни отговори</li>
          <li>Отговаряйте спонтанно, без да мислите прекалено дълго</li>
          <li>Тестът отнема около 4-6 минути</li>
        </ul>
        <button class="btn btn-primary" onclick="startTest()">Започни теста</button>
        <a href="../index.html" class="btn btn-secondary">Назад към главната страница</a>
      </div>
    </div>

    <!-- Questions Screen -->
    <div id="screenQuestions" class="screen">
      <div class="header">
        <h1>Личностен Психопрофил</h1>
      </div>
      
      <div class="progress-container">
        <div class="progress-info">
          <span>Въпрос <span id="currentQuestion">1</span> от <span id="totalQuestions">13</span></span>
          <span id="progressPercent">8%</span>
        </div>
        <div class="progress-bar">
          <div id="progressFill" class="progress-fill" style="width: 8%"></div>
        </div>
      </div>

      <div id="questionContainer"></div>

      <div class="navigation">
        <button class="btn btn-secondary" id="btnPrevious" onclick="previousQuestion()" style="display: none">Назад</button>
        <button class="btn btn-primary" id="btnNext" onclick="nextQuestion()" disabled>Следващ въпрос</button>
      </div>
    </div>

    <!-- Results Screen -->
    <div id="screenResults" class="screen">
      <div class="header">
        <h1>Вашите Резултати</h1>
      </div>
      
      <div class="results-header">
        <h2>Личностен профил</h2>
        <p>Вашите оценки по различните личностни измерения</p>
      </div>

      <div id="dimensionsContainer"></div>

      <div id="typeCodeContainer"></div>

      <div id="flagsContainer"></div>

      <div class="ai-section">
        <h3>
          AI Анализ на хранителни навици
          <span class="ai-badge">AI Powered</span>
        </h3>
        <div id="aiAnalysisContainer" class="ai-content">
          <div class="loading">
            <div class="loading-spinner"></div>
            <div class="loading-text">Анализиране на резултатите...</div>
          </div>
        </div>
      </div>

      <div class="navigation">
        <button class="btn btn-secondary" onclick="restartTest()">Започни отново</button>
        <a href="../index.html" class="btn btn-primary" style="text-decoration: none">Към главната страница</a>
      </div>
    </div>
  </div>

  <script>
    // Test data loaded from JSON files
    const testData = {
      "meta": {
        "id": "bb_optional_personality_v1_1",
        "title": "Кратък личностен модул (по избор)",
        "language": "bg",
        "version": "1.1.0",
        "questions_count": 13
      },
      "items": [
        {
          "id": "psy_01",
          "text": "Когато се заемам с нова цел...?",
          "type": "radio",
          "options": [
            "Правя точен план и стъпки, преди да започна",
            "Правя обща рамка и прецизирам по пътя",
            "Започвам веднага и оформям структурата в движение"
          ],
          "legend": "Изберете една опция — най-близката до естествения ви избор в повечето случаи (последните шест месеца)."
        },
        {
          "id": "psy_02",
          "text": "В свободното си време предпочитам...?",
          "type": "radio",
          "options": [
            "Позната дейност, която вече е доказано приятна",
            "Нещо ново/непознато, за да пробвам и да науча",
            "Комбинация: познато + малък елемент на новост"
          ],
          "legend": "Изберете една опция — най-близката до естествения ви избор в повечето случаи (последните шест месеца)."
        },
        {
          "id": "psy_03",
          "text": "След тежък ден имам нужда от...?",
          "type": "radio",
          "options": [
            "Време насаме и тишина",
            "Контакт с хора (приятели/екип), разговор, движение",
            "Малка социалност + после време насаме"
          ],
          "legend": "Изберете една опция — най-близката до естествения ви избор в повечето случаи (последните шест месеца)."
        },
        {
          "id": "psy_04",
          "text": "При вземане на решение в трудна ситуация...?",
          "type": "radio",
          "options": [
            "Събирам още информация и чак тогава решавам",
            "Решавам бързо и после коригирам при нужда",
            "Питам/сверявам с доверен човек и действам"
          ],
          "legend": "Изберете една опция — най-близката до естествения ви избор в повечето случаи (последните шест месеца)."
        },
        {
          "id": "psy_05",
          "text": "В напрегнат разговор...?",
          "type": "radio",
          "options": [
            "Заявявам директно и ясно мнение на момента",
            "Изчаквам да спадне напрежението и после обсъждам",
            "Търся мек подход: контекст, тон, стратегически стъпки"
          ],
          "legend": "Изберете една опция — най-близката до естествения ви избор в повечето случаи (последните шест месеца)."
        },
        {
          "id": "psy_06",
          "text": "Когато работя под напрежение...?",
          "type": "radio",
          "options": [
            "Фокусирам се и ставам по-ефективен/а",
            "Ставам по-раздразнителен/а от разсейващи фактори",
            "Търся опора: рутина, правила, ясни граници"
          ],
          "legend": "Изберете една опция — най-близката до естествения ви избор в повечето случаи (последните шест месеца)."
        },
        {
          "id": "psy_07",
          "text": "Нуждата ми от подкрепа е...?",
          "type": "radio",
          "options": [
            "Често и на малки стъпки",
            "Само по ключови етапи/на финала",
            "По поискване: аз решавам кога да я потърся"
          ],
          "legend": "Изберете една опция — най-близката до естествения ви избор в повечето случаи (последните шест месеца)."
        },
        {
          "id": "psy_08",
          "text": "В ситуации на риск и печалба...?",
          "type": "radio",
          "options": [
            "Избирам сигурното и предвидимото",
            "Избирам балансирано: среден риск за средна полза",
            "Моят принцип е \\\"Всичко или нищо\\\""
          ],
          "legend": "Изберете една опция — най-близката до естествения ви избор в повечето случаи (последните шест месеца)."
        },
        {
          "id": "psy_09",
          "text": "Когато имам срок...?",
          "type": "radio",
          "options": [
            "Започвам рано и правя по малко, но регулярно",
            "Започвам по средата и поддържам темпо до финала",
            "Работя най-добре на финален спринт"
          ],
          "legend": "Изберете една опция — най-близката до естествения ви избор в повечето случаи (последните шест месеца)."
        },
        {
          "id": "psy_10",
          "text": "При изграждане на нови умения...?",
          "type": "radio",
          "options": [
            "Следвам ясни инструкции и структуриран план",
            "Пробвам чрез експерименти и откриване",
            "Опитвам се да съчетая пример/ментор + действие"
          ],
          "legend": "Изберете една опция — най-близката до естествения ви избор в повечето случаи (последните шест месеца)."
        },
        {
          "id": "psy_12",
          "text": "При малка полза веднага и по-голяма след време...?",
          "type": "radio",
          "options": [
            "Предпочитам малката полза веднага",
            "Предпочитам по-голямата полза по-късно",
            "Трябва добре да обмисля ситуацията"
          ],
          "legend": "Изберете една опция — най-близката до естествения ви избор в повечето случаи (последните шест месеца)."
        },
        {
          "id": "psy_13",
          "text": "За да съм отдаден имам нужда от...?",
          "type": "radio",
          "options": [
            "Сигурност, постоянство, навици",
            "Честа промяна и разнообразие",
            "Рутина и нови елементи"
          ],
          "legend": "Изберете една опция — най-близката до естествения ви избор в повечето случаи (последните шест месеца)."
        },
        {
          "id": "psy_14",
          "text": "Когато възникне силна емоция...?",
          "type": "radio",
          "options": [
            "Изразявам я веднага и директно",
            "Обработвам я вътрешно и след това действам",
            "Търся диалог и информация, за да си я подредя"
          ],
          "legend": "Изберете една опция — най-близката до естествения ви избор в повечето случаи (последните шест месеца)."
        }
      ]
    };

    const scoringKey = {
      "psy_01": [
        {"C": 2, "O": -1, "E": 0, "A": 0, "N": 0, "I": -1, "R": 0},
        {"C": 1, "O": 0, "E": 0, "A": 0, "N": 0, "I": 0, "R": 0},
        {"C": -1, "O": 1, "E": 1, "A": 0, "N": 0, "I": 1, "R": 0}
      ],
      "psy_02": [
        {"C": 0, "O": -1, "E": 0, "A": 0, "N": 0, "I": 0, "R": 0},
        {"C": 0, "O": 2, "E": 0, "A": 0, "N": 0, "I": 0, "R": 0},
        {"C": 0, "O": 1, "E": 0, "A": 0, "N": 0, "I": 0, "R": 0}
      ],
      "psy_03": [
        {"C": 0, "O": 0, "E": -2, "A": 0, "N": 0, "I": 0, "R": 0},
        {"C": 0, "O": 0, "E": 2, "A": 1, "N": 0, "I": 0, "R": 0},
        {"C": 0, "O": 0, "E": 0, "A": 0, "N": 0, "I": 0, "R": 0}
      ],
      "psy_04": [
        {"C": 1, "O": 1, "E": 0, "A": 0, "N": 0, "I": -1, "R": -1},
        {"C": 0, "O": 0, "E": 1, "A": -1, "N": 0, "I": 1, "R": 1},
        {"C": 0, "O": 0, "E": 0, "A": 2, "N": 0, "I": 0, "R": 0}
      ],
      "psy_05": [
        {"C": 0, "O": 0, "E": 1, "A": -1, "N": 1, "I": 0, "R": 0},
        {"C": 1, "O": 0, "E": -1, "A": 0, "N": 1, "I": -1, "R": 0},
        {"C": 1, "O": 0, "E": 0, "A": 2, "N": 0, "I": 0, "R": 0}
      ],
      "psy_06": [
        {"C": 2, "O": 0, "E": 0, "A": 0, "N": -1, "I": 0, "R": 0},
        {"C": -1, "O": 0, "E": 0, "A": -1, "N": 2, "I": 1, "R": 0},
        {"C": 1, "O": 0, "E": 0, "A": 0, "N": 1, "I": 0, "R": 0}
      ],
      "psy_07": [
        {"C": 0, "O": 0, "E": 0, "A": 1, "N": 1, "I": 0, "R": 0},
        {"C": 1, "O": 0, "E": 0, "A": 0, "N": 0, "I": 0, "R": 0},
        {"C": 1, "O": 1, "E": 0, "A": 0, "N": 0, "I": 0, "R": 0}
      ],
      "psy_08": [
        {"C": 0, "O": 0, "E": 0, "A": 0, "N": 0, "I": -1, "R": -2},
        {"C": 0, "O": 0, "E": 0, "A": 0, "N": 0, "I": 0, "R": 0},
        {"C": -1, "O": 0, "E": 1, "A": -1, "N": 1, "I": 1, "R": 2}
      ],
      "psy_09": [
        {"C": 2, "O": 0, "E": 0, "A": 0, "N": 0, "I": -1, "R": 0},
        {"C": 1, "O": 0, "E": 0, "A": 0, "N": 0, "I": 0, "R": 0},
        {"C": -1, "O": 0, "E": 0, "A": 0, "N": 1, "I": 2, "R": 0}
      ],
      "psy_10": [
        {"C": 2, "O": 0, "E": 0, "A": 0, "N": 0, "I": 0, "R": 0},
        {"C": 0, "O": 2, "E": 0, "A": 0, "N": 0, "I": 1, "R": 0},
        {"C": 0, "O": 1, "E": 0, "A": 1, "N": 0, "I": 0, "R": 0}
      ],
      "psy_12": [
        {"C": -1, "O": 0, "E": 0, "A": 0, "N": 0, "I": 2, "R": 0},
        {"C": 2, "O": 0, "E": 0, "A": 0, "N": 0, "I": -1, "R": 0},
        {"C": 1, "O": 1, "E": 0, "A": 0, "N": 0, "I": 0, "R": 0}
      ],
      "psy_13": [
        {"C": 2, "O": -1, "E": 0, "A": 0, "N": 0, "I": 0, "R": 0},
        {"C": -1, "O": 2, "E": 0, "A": 0, "N": 0, "I": 1, "R": 0},
        {"C": 1, "O": 1, "E": 0, "A": 0, "N": 0, "I": 0, "R": 0}
      ],
      "psy_14": [
        {"C": 0, "O": 0, "E": 1, "A": -1, "N": 1, "I": 1, "R": 0},
        {"C": 1, "O": 0, "E": -1, "A": 0, "N": -1, "I": -1, "R": 0},
        {"C": 0, "O": 1, "E": 0, "A": 1, "N": 0, "I": 0, "R": 0}
      ]
    };

    const dimensionInfo = {
      "E": {
        "name": "Социална енергия",
        "description": "общителност и активация",
        "lowLabel": "X (по-затворен)",
        "highLabel": "E (по-общителен)",
        "threshold": 60
      },
      "C": {
        "name": "Структура и дисциплина",
        "description": "организираност и самоконтрол",
        "lowLabel": "P (по-гъвкав)",
        "highLabel": "J (по-структуриран)",
        "threshold": 60
      },
      "O": {
        "name": "Отвореност към новото",
        "description": "новаторство и любознателност",
        "lowLabel": "S (по-практичен)",
        "highLabel": "V (по-новаторски)",
        "threshold": 60
      },
      "A": {
        "name": "Мекота в контакт",
        "description": "съгласуваност и кооперативност",
        "lowLabel": "D (по-директен)",
        "highLabel": "M (по-мек)",
        "threshold": 60
      },
      "N": {
        "name": "Емоционална реактивност",
        "description": "чувствителност към стрес",
        "lowLabel": "Стабилен",
        "highLabel": "Реактивен",
        "threshold": 65
      },
      "I": {
        "name": "Импулсивност",
        "description": "склонност към моментни действия",
        "lowLabel": "Планиращ",
        "highLabel": "Импулсивен",
        "threshold": 65
      },
      "R": {
        "name": "Рискова ориентация",
        "description": "толерантност към несигурност",
        "lowLabel": "Предпазлив",
        "highLabel": "Рисков",
        "threshold": 65
      }
    };

    // State
    let currentQuestionIndex = 0;
    let answers = {};
    const questions = testData.items;

    // Functions
    function startTest() {
      showScreen('screenQuestions');
      renderQuestion();
    }

    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(screenId).classList.add('active');
    }

    function renderQuestion() {
      const question = questions[currentQuestionIndex];
      const container = document.getElementById('questionContainer');
      
      const html = `
        <div class="question-card">
          <div class="question-number">Въпрос ${currentQuestionIndex + 1}</div>
          <div class="question-text">${question.text}</div>
          <div class="options" id="options">
            ${question.options.map((opt, idx) => `
              <div class="option" data-index="${idx}" onclick="selectOption(${idx})">
                <div class="option-radio"></div>
                <div class="option-text">${opt}</div>
              </div>
            `).join('')}
          </div>
          <div class="legend">${question.legend}</div>
        </div>
      `;
      
      container.innerHTML = html;
      
      // Restore previous answer if exists
      if (answers[question.id] !== undefined) {
        selectOption(answers[question.id], false);
      }
      
      updateProgress();
      updateNavigation();
    }

    function selectOption(index, enableNext = true) {
      const options = document.querySelectorAll('.option');
      options.forEach(opt => opt.classList.remove('selected'));
      options[index].classList.add('selected');
      
      const question = questions[currentQuestionIndex];
      answers[question.id] = index;
      
      if (enableNext) {
        document.getElementById('btnNext').disabled = false;
      }
    }

    function nextQuestion() {
      if (currentQuestionIndex < questions.length - 1) {
        currentQuestionIndex++;
        renderQuestion();
      } else {
        calculateAndShowResults();
      }
    }

    function previousQuestion() {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        renderQuestion();
      }
    }

    function updateProgress() {
      const current = currentQuestionIndex + 1;
      const total = questions.length;
      const percent = Math.round((current / total) * 100);
      
      document.getElementById('currentQuestion').textContent = current;
      document.getElementById('totalQuestions').textContent = total;
      document.getElementById('progressPercent').textContent = percent + '%';
      document.getElementById('progressFill').style.width = percent + '%';
    }

    function updateNavigation() {
      const btnPrevious = document.getElementById('btnPrevious');
      const btnNext = document.getElementById('btnNext');
      
      btnPrevious.style.display = currentQuestionIndex > 0 ? 'block' : 'none';
      
      const question = questions[currentQuestionIndex];
      const hasAnswer = answers[question.id] !== undefined;
      btnNext.disabled = !hasAnswer;
      
      if (currentQuestionIndex === questions.length - 1) {
        btnNext.textContent = 'Виж резултатите';
      } else {
        btnNext.textContent = 'Следващ въпрос';
      }
    }

    function calculateScores() {
      const rawScores = { E: 0, C: 0, O: 0, A: 0, N: 0, I: 0, R: 0 };
      const minScores = { E: 0, C: 0, O: 0, A: 0, N: 0, I: 0, R: 0 };
      const maxScores = { E: 0, C: 0, O: 0, A: 0, N: 0, I: 0, R: 0 };
      
      // Calculate raw scores
      questions.forEach(q => {
        const answerIndex = answers[q.id];
        const scoring = scoringKey[q.id][answerIndex];
        
        Object.keys(scoring).forEach(dim => {
          rawScores[dim] += scoring[dim];
        });
      });
      
      // Calculate min/max possible scores
      questions.forEach(q => {
        const scorings = scoringKey[q.id];
        
        Object.keys(rawScores).forEach(dim => {
          const values = scorings.map(s => s[dim]);
          minScores[dim] += Math.min(...values);
          maxScores[dim] += Math.max(...values);
        });
      });
      
      // Normalize to 0-100
      const normalizedScores = {};
      Object.keys(rawScores).forEach(dim => {
        const raw = rawScores[dim];
        const min = minScores[dim];
        const max = maxScores[dim];
        const range = max - min;
        
        if (range === 0) {
          normalizedScores[dim] = 50;
        } else {
          normalizedScores[dim] = Math.round(((raw - min) / range) * 100);
        }
      });
      
      return normalizedScores;
    }

    function calculateAndShowResults() {
      const scores = calculateScores();
      
      showScreen('screenResults');
      renderDimensions(scores);
      renderTypeCode(scores);
      renderFlags(scores);
      generateAIAnalysis(scores);
    }

    function renderDimensions(scores) {
      const container = document.getElementById('dimensionsContainer');
      const dimensions = ['E', 'C', 'O', 'A', 'N', 'I', 'R'];
      
      const html = dimensions.map(dim => {
        const info = dimensionInfo[dim];
        const score = scores[dim];
        
        return `
          <div class="dimension-card">
            <div class="dimension-header">
              <div class="dimension-name">${info.name}</div>
              <div class="dimension-code">${dim}</div>
            </div>
            <div class="dimension-description">${info.description}</div>
            <div class="score-bar-container">
              <div class="score-bar-labels">
                <span>${info.lowLabel}</span>
                <span>${info.highLabel}</span>
              </div>
              <div class="score-bar">
                <div class="score-marker" style="left: ${score}%"></div>
              </div>
              <div class="score-value">${score} / 100</div>
            </div>
          </div>
        `;
      }).join('');
      
      container.innerHTML = html;
    }

    function renderTypeCode(scores) {
      const container = document.getElementById('typeCodeContainer');
      
      // Generate 4-axis type code (E-O-A-C)
      const E_code = scores.E >= dimensionInfo.E.threshold ? 'E' : 'X';
      const O_code = scores.O >= dimensionInfo.O.threshold ? 'V' : 'S';
      const A_code = scores.A >= dimensionInfo.A.threshold ? 'M' : 'D';
      const C_code = scores.C >= dimensionInfo.C.threshold ? 'J' : 'P';
      
      const typeCode = `${E_code}-${O_code}-${A_code}-${C_code}`;
      
      const html = `
        <div class="type-code-card">
          <div class="type-code-label">Вашият комуникационен код</div>
          <div class="type-code-value">${typeCode}</div>
        </div>
      `;
      
      container.innerHTML = html;
    }

    function renderFlags(scores) {
      const container = document.getElementById('flagsContainer');
      const flags = [];
      
      if (scores.I >= 65) {
        flags.push({
          title: 'Висока импулсивност',
          description: 'По-силен импулс "сега" - склонност към бързи решения без задълбочен анализ.',
          type: 'warning'
        });
      }
      
      if (scores.N >= 65) {
        flags.push({
          title: 'Висока емоционална реактивност',
          description: 'По-висока чувствителност към стрес и емоционални стимули.',
          type: 'warning'
        });
      }
      
      if (scores.R >= 65) {
        flags.push({
          title: 'Висока склонност към риск',
          description: 'По-висока толерантност към несигурност и рискови ситуации.',
          type: 'warning'
        });
      }
      
      if (flags.length === 0) {
        container.innerHTML = '';
        return;
      }
      
      const html = `
        <div class="flags-section">
          <h3>Области на внимание</h3>
          ${flags.map(flag => `
            <div class="flag-card ${flag.type}">
              <div class="flag-title">${flag.title}</div>
              <div class="flag-description">${flag.description}</div>
            </div>
          `).join('')}
        </div>
      `;
      
      container.innerHTML = html;
    }

    function generateAIAnalysis(scores) {
      // Simulate AI processing delay
      setTimeout(() => {
        const analysis = analyzeNutritionalRisks(scores);
        renderAIAnalysis(analysis);
      }, 1500);
    }

    function analyzeNutritionalRisks(scores) {
      const risks = [];
      const recommendations = [];
      const strengths = [];
      const behavioralPatterns = [];
      
      // High Conscientiousness (C >= 70) + High Neuroticism (N >= 65)
      if (scores.C >= 70 && scores.N >= 65) {
        risks.push({
          title: 'Рестриктивни тенденции и ортонексия',
          description: 'Комбинацията от висока дисциплина и емоционална реактивност може да води до твърде строги хранителни режими, перфекционизъм около храната и прекомерна фиксация върху "чистото" хранене. Възможни признаци: строго броене на калории/макроси, страх от "замърсяване" на диетата, силна тревожност при отклонение от плана, социална изолация заради хранителни ограничения.'
        });
        behavioralPatterns.push('Многократно претегляне на порциите и проверка на етикетите');
        behavioralPatterns.push('Избягване на социални ситуации където храната не е "контролируема"');
        behavioralPatterns.push('Усещане за вина или тревожност след "несъвършено" хранене');
        behavioralPatterns.push('Категоризиране на храните като "добри" и "лоши" без нюанси');
        recommendations.push('Практикувайте гъвкавост в храненето - позволете си 10-20% от калориите за храни "за удоволствие"');
        recommendations.push('Работете с нутриционист за създаване на реалистичен и устойчив план');
        recommendations.push('Използвайте когнитивна реструктуризация за преодоляване на "всичко или нищо" мисленето');
        recommendations.push('Наблюдавайте за ранни признаци на хранително разстройство и потърсете професионална помощ при нужда');
      }
      
      // High Neuroticism (N >= 65) + Low Conscientiousness (C < 40)
      if (scores.N >= 65 && scores.C < 40) {
        risks.push({
          title: 'Емоционално хранене и компулсивно преяждане',
          description: 'Високата емоционална реактивност съчетана с по-ниска самодисциплина може да води до използване на храната за регулиране на емоции. Рискови поведения: хранене като отговор на стрес, самота, скука или тъга; "нощно хранене"; невъзможност да спрете веднъж започнало хранене; чувство на безконтролност около храната; скрито хранене; цикли на ограничение-преяждане.'
        });
        behavioralPatterns.push('Автоматично посягане към храна при негативни емоции');
        behavioralPatterns.push('Хранене до чувство на физически дискомфорт');
        behavioralPatterns.push('Амнезия за количеството изядена храна при емоционален епизод');
        behavioralPatterns.push('Предпочитане на хиперпалатабилни храни (с високо съдържание на мазнини+захар)');
        recommendations.push('Създайте списък с алтернативни начини за справяне със стрес (разходка, дишане, музика, творчество)');
        recommendations.push('Водете дневник на емоциите и храненето за разпознаване на тригери');
        recommendations.push('Практикувайте mindfulness и осъзнато хранене');
        recommendations.push('Работете с психолог/психотерапевт за развиване на здравословни копинг стратегии');
        recommendations.push('Изградете система за емоционална подкрепа извън храната');
      }
      
      // High Impulsivity (I >= 65)
      if (scores.I >= 65) {
        risks.push({
          title: 'Импулсивно хранене и загуба на контрол',
          description: 'Склонността към бързи решения може да води до чести нежелани закуски, хранене при визуален или обонятелен стимул, и трудност да се спре веднъж започнало хранене. Типични модели: спонтанни покупки на нездравословна храна; начало на хранене без осъзнато решение; безконтролно хранене пред телевизор/компютър; трудност да се изчака редовно време за хранене.'
        });
        behavioralPatterns.push('Хранене директно от опаковката без порциониране');
        behavioralPatterns.push('Покупка на храна "на момента" без предварително планиране');
        behavioralPatterns.push('Хранене докато готвите или преди да сервирате');
        behavioralPatterns.push('Трудност да отложите удоволствието (желание за "сега")');
        recommendations.push('Премахнете видимите изкушения от битовата среда - "извън поглед, извън съзнание"');
        recommendations.push('Използвайте техниката "10-минутна пауза" преди да вземете решение за храна');
        recommendations.push('Планирайте хранения и закуски предварително - подгответе здравословни алтернативи');
        recommendations.push('Порционирайте храната преди да започнете да ядете');
        recommendations.push('Практикувайте "осъзнато бавене" - поставяйте приборите между хапките');
        recommendations.push('Използвайте външни структури: аларми, предварително подготвена храна, accountability partner');
      }
      
      // Low Conscientiousness (C < 40) + High Openness (O >= 65)
      if (scores.C < 40 && scores.O >= 65) {
        risks.push({
          title: 'Хаотични хранителни навици и непостоянство',
          description: 'Предпочитанието към спонтанност и новост може да води до нередовно хранене, пропускане на хранения, непостоянен режим и чести диетични експерименти без довеждане до край. Признаци: хранене на случаен принцип; чести пропускания на хранения особено сутрин; периоди на гладуване следвани от преяждане; експериментиране с нови диети но бързо отпадане; недостатъчен прием на есенциални хранителни вещества.'
        });
        behavioralPatterns.push('Нямане на фиксирано време за хранене');
        behavioralPatterns.push('Често хранене "на бягане" или докато правите друго');
        behavioralPatterns.push('Започване на нова диета всяка седмица/месец без приключване на предишна');
        behavioralPatterns.push('Силна зависимост от мотивацията в момента');
        recommendations.push('Създайте минимална рутина - поне 2-3 фиксирани хранения на ден');
        recommendations.push('Използвайте напомняния/аларми за хранене');
        recommendations.push('Експериментирайте с нови здравословни рецепти за поддържане на интерес');
        recommendations.push('Подгответе "emergency" храна за моментите когато липсва време за готвене');
        recommendations.push('Намерете начин да превърнете здравословното хранене в "нова интересна игра/challenge"');
      }
      
      // High Risk-seeking (R >= 65) + High Impulsivity (I >= 65)
      if (scores.R >= 65 && scores.I >= 65) {
        risks.push({
          title: 'Екстремни подходи и йо-йо ефект',
          description: 'Комбинацията от висока толерантност към риск и импулсивност може да води до опити с крайни диети, опасни добавки, "всичко или нищо" мислене и цикли на рязко отслабване-напълняване. Рискове: много ниско калорийни диети; монодиети; екстремни elimination диети без медицинска причина; употреба на непроверени хранителни добавки; прекалено интензивни тренировки; йо-йо ефект с метаболитни последствия.'
        });
        behavioralPatterns.push('Чести радикални промени в начина на хранене');
        behavioralPatterns.push('Привличане към "бързи" решения и обещания за бърз резултат');
        behavioralPatterns.push('Пренебрегване на ранните предупредителни сигнали от тялото');
        behavioralPatterns.push('Трудност с умерен, постепенен подход (изглежда "скучен")');
        recommendations.push('Избягвайте крайни и бързи диети - търсете умерени и устойчиви подходи');
        recommendations.push('Работете с професионалист преди да правите големи промени в храненето');
        recommendations.push('Поставете си правило: "Изчакай 2 седмици" преди да започнете радикална промяна');
        recommendations.push('Фокусирайте се върху поведенчески промени, не само върху цифри на теглото');
        recommendations.push('Проучете научната основа на подхода преди да го приложите');
      }
      
      // Low Extraversion (E < 35)
      if (scores.E < 35) {
        risks.push({
          title: 'Социална изолация и компенсаторно хранене',
          description: 'По-интровертираният стил може да води до хранене в самота, което понякога затруднява здравословния избор и самоконтрола. Храната може да се превърне в начин за компания или утеха. Рискове: емоционално хранене в изолация; липса на външна accountability; избягване на социални ситуации и засилване на самотата; по-висок риск от хранене като копинг механизъм за самота.'
        });
        behavioralPatterns.push('Предпочитане на хранене в самота, дори когато има опция за компания');
        behavioralPatterns.push('Използване на храната като основна форма на самоуспокояване');
        behavioralPatterns.push('Трудност да споделите хранителни цели с други');
        recommendations.push('Създайте структурирана хранителна среда и у дома');
        recommendations.push('Помислете за подкрепяща онлайн общност или accountability partner');
        recommendations.push('Разгледайте възможността за онлайн групова подкрепа или coaching');
        recommendations.push('Развийте и други форми на self-care извън храната');
      }
      
      // High Extraversion (E >= 70) + Low Agreeableness (A < 40)
      if (scores.E >= 70 && scores.A < 40) {
        risks.push({
          title: 'Прекомерно социално хранене и алкохол',
          description: 'Високата социална енергия може да води до чести излизания, алкохол и храна в компания, което затруднява контрола. Рискове: чести ресторантски посещения с големи порции; консумация на алкохол в социални ситуации (празни калории + намален самоконтрол); нощни хранения след излизания; peer pressure и състезателно хранене; нередовност заради социален календар.'
        });
        behavioralPatterns.push('Хранене значително повече в социални ситуации отколкото сам/а');
        behavioralPatterns.push('Трудност да откажете алкохол или десерт в компания');
        behavioralPatterns.push('Планиране на социални събития предимно около храна/пиене');
        behavioralPatterns.push('Пренебрегване на хранителни цели "заради компанията"');
        recommendations.push('Планирайте предварително какво ще поръчате в ресторант');
        recommendations.push('Разработете стратегии за социални ситуации (хранене преди излизане, избор на по-здравословни опции)');
        recommendations.push('Определете си правила за алкохол и се придържайте към тях');
        recommendations.push('Предложете на приятели алтернативни социални дейности без фокус върху храната');
        recommendations.push('Практикувайте асертивност - можете да се забавлявате без да преяждате');
      }
      
      // High Agreeableness (A >= 70)
      if (scores.A >= 70) {
        risks.push({
          title: 'Трудност с граници и people pleasing',
          description: 'Високата съгласуваност може да прави трудно отказването на предлагана храна или алкохол в социални ситуации, и може да води до пренебрегване на собствените хранителни нужди в полза на други. Рискове: хранене за да не обидите домакина; трудност да следвате своя план заради очаквания на други; избор на храна базирана на предпочитанията на другите; жертване на собственото здраве за "мир".'
        });
        behavioralPatterns.push('Автоматично "да" на предложена храна, дори да не искате');
        behavioralPatterns.push('Хранене повече за да не остане храна и да "обидите готвача"');
        behavioralPatterns.push('Трудност да поискате специални нужди в ресторант');
        behavioralPatterns.push('Чувство на вина при поставяне на хранителни граници');
        recommendations.push('Практикувайте учтиви начини за отказ ("Благодаря, но съм сит/а", "Изглежда вкусно, но в момента не ми се яде")');
        recommendations.push('Споделете целите си с близки хора за подкрепа и разбиране');
        recommendations.push('Запомнете: грижата за собственото здраве не е егоистична');
        recommendations.push('Упражнявайте асертивна комуникация без вина или агресия');
      }
      
      // Low Openness (O < 35) + High Conscientiousness (C >= 70)
      if (scores.O < 35 && scores.C >= 70) {
        risks.push({
          title: 'Твърде ограничаващ режим и монотонност',
          description: 'Предпочитанието към познато и рутина може да води до прекалено ограничен набор от храни, монотонност и потенциални хранителни дефицити. Рискове: същите храни всеки ден; избягване на нови здравословни храни; ригидност която води до "срив" при промяна на обстоятелствата; недостатъчно разнообразие от витамини и минерали; социално ограничение заради твърде тесен набор от храни.'
        });
        behavioralPatterns.push('Хранене на същите 5-10 храни постоянно');
        behavioralPatterns.push('Силна тревожност или дискомфорт при нужда да опитате ново');
        behavioralPatterns.push('Затруднения при пътуване или промяна на обстановката');
        behavioralPatterns.push('Избягване на социални събития заради "непозната храна"');
        recommendations.push('Постепенно добавяйте нови здравословни храни към рутината (една на седмица)');
        recommendations.push('Разнообразието е важно за дългосрочна устойчивост и хранителен баланс');
        recommendations.push('Работете с нутриционист за осигуряване на адекватен микронутриентен профил');
        recommendations.push('Използвайте "правилото на 80/20": 80% познато, 20% ново/различно');
      }
      
      // High Neuroticism (N >= 65) + High Impulsivity (I >= 65) + Low Conscientiousness (C < 40)
      if (scores.N >= 65 && scores.I >= 65 && scores.C < 40) {
        risks.push({
          title: 'Комплексно дизрегулирано хранене',
          description: 'Тази комбинация създава висок риск за сериозни проблеми: емоционално тригерирано + импулсивно изпълнено + липса на структура = високорискови епизоди на преяждане. Възможен е binge eating pattern с цикли на вина-компенсация-повторение. Необходима е професионална подкрепа.'
        });
        behavioralPatterns.push('Чести епизоди на загуба на контрол около храната');
        behavioralPatterns.push('Комбиниране на множество проблемни поведения едновременно');
        behavioralPatterns.push('Силни емоционални реакции свързани с храната и теглото');
        recommendations.push('ВАЖНО: Потърсете професионална помощ от психолог и нутриционист');
        recommendations.push('Работете върху емоционална регулация преди фокус върху диета');
        recommendations.push('Създайте силна система за подкрепа');
        recommendations.push('Обмислете когнитивно-поведенческа терапия (CBT) за хранителни разстройства');
      }
      
      // Low Conscientiousness (C < 40) + Low Agreeableness (A < 40)
      if (scores.C < 40 && scores.A < 40) {
        risks.push({
          title: 'Ниска мотивация за промяна',
          description: 'Комбинацията от ниска дисциплина и независимост може да води до съпротива срещу промени, дори когато са необходими за здравето. Трудност да се приемат препоръки и да се следва план дългосрочно.'
        });
        behavioralPatterns.push('Съпротива срещу съвети, дори да са обосновани');
        behavioralPatterns.push('Начало на промени но бързо отпадане');
        behavioralPatterns.push('Чувство че правилата "не важат за мен"');
        recommendations.push('Намерете лична мотивация отвъд външните препоръки');
        recommendations.push('Работете с професионалист който уважава автономията ви');
        recommendations.push('Фокусирайте се върху малки промени които ВИЕ избирате');
        recommendations.push('Свържете хранителните промени с ваши лични ценности и цели');
      }
      
      // High Conscientiousness (C >= 70) + High Impulsivity (I >= 65) - парадоксална комбинация
      if (scores.C >= 70 && scores.I >= 65) {
        risks.push({
          title: 'Парадоксален контрол-импулс модел',
          description: 'Необичайната комбинация от висока дисциплина и висока импулсивност може да създава цикли: строг контрол → натрупано напрежение → импулсивен "срив" → вина → още по-строг контрол. Води до нестабилност и стрес.'
        });
        behavioralPatterns.push('Периоди на перфектно спазване на плана следвани от "взрив"');
        behavioralPatterns.push('Изключителна строгост през седмицата, срив през уикенда');
        behavioralPatterns.push('Вътрешен конфликт и самокритика');
        recommendations.push('Разпознайте този парадокс като личностна особеност, не слабост');
        recommendations.push('Вградете "контролирани отстъпки" в плана преди импулсът да ви завладее');
        recommendations.push('Работете върху самосъстрадание вместо самокритика');
        recommendations.push('Използвайте техники за управление на импулса: дишане, mindfulness, distraction');
      }
      
      // Identify strengths
      if (scores.C >= 60) {
        strengths.push('Доброто ниво на самодисциплина е силен фактор за успех в промяна на навици');
      }
      
      if (scores.O >= 60) {
        strengths.push('Отвореността към ново улеснява експериментирането със здравословни рецепти и подходи');
      }
      
      if (scores.E >= 50 && scores.E <= 70) {
        strengths.push('Балансираната социална енергия помага за поддържане на здрави социални връзки без прекомерно социално хранене');
      }
      
      if (scores.N < 50) {
        strengths.push('По-ниската емоционална реактивност намалява риска от емоционално хранене');
      }
      
      if (scores.I < 50) {
        strengths.push('По-ниската импулсивност улеснява планирането и контрола върху хранителните избори');
      }
      
      if (scores.R < 50) {
        strengths.push('Предпазливият подход към риск помага за избягване на крайни и потенциално вредни диетични експерименти');
      }
      
      // If no specific risks identified
      if (risks.length === 0) {
        risks.push({
          title: 'Балансиран профил',
          description: 'Вашият личностен профил не показва ясно изразени области на риск във връзка с хранителните навици. Това е добра изходна позиция.'
        });
        recommendations.push('Поддържайте осъзнато хранене и редовен режим');
        recommendations.push('Следете за промени в стреса или емоционалното състояние, които могат да повлияят храненето');
      }
      
      return { risks, recommendations, strengths, behavioralPatterns };
    }

    function renderAIAnalysis(analysis) {
      const container = document.getElementById('aiAnalysisContainer');
      
      let html = '';
      
      // Strengths
      if (analysis.strengths.length > 0) {
        html += `
          <div class="ai-subsection">
            <h4>✓ Силни страни на вашия профил</h4>
            <ul class="ai-list">
              ${analysis.strengths.map(s => `
                <li>
                  <span class="ai-bullet">•</span>
                  <span class="ai-text">${s}</span>
                </li>
              `).join('')}
            </ul>
          </div>
        `;
      }
      
      // Risks
      html += `
        <div class="ai-subsection">
          <h4>⚠ Потенциални рискови области</h4>
          ${analysis.risks.map(risk => `
            <div style="margin-bottom: 16px;">
              <div style="font-weight: 700; color: var(--text); margin-bottom: 4px;">${risk.title}</div>
              <div class="ai-text">${risk.description}</div>
            </div>
          `).join('')}
        </div>
      `;
      
      // Behavioral Patterns (if any)
      if (analysis.behavioralPatterns && analysis.behavioralPatterns.length > 0) {
        html += `
          <div class="ai-subsection">
            <h4>🔍 Конкретни поведенчески признаци за наблюдение</h4>
            <ul class="ai-list">
              ${analysis.behavioralPatterns.map(pattern => `
                <li>
                  <span class="ai-bullet">⊳</span>
                  <span class="ai-text">${pattern}</span>
                </li>
              `).join('')}
            </ul>
            <div class="ai-text" style="margin-top: 12px; font-style: italic; font-size: 13px;">
              Ако разпознавате 3 или повече от тези модели редовно, това може да сигнализира за необходимост от по-активна намеса.
            </div>
          </div>
        `;
      }
      
      // Recommendations
      html += `
        <div class="ai-subsection">
          <h4>💡 Препоръки за действие</h4>
          <ul class="ai-list">
            ${analysis.recommendations.map(rec => `
              <li>
                <span class="ai-bullet">→</span>
                <span class="ai-text">${rec}</span>
              </li>
            `).join('')}
          </ul>
        </div>
      `;
      
      // General note
      html += `
        <div class="ai-subsection">
          <div class="ai-text" style="font-style: italic; padding-top: 12px; border-top: 1px solid var(--border);">
            <strong>Забележка:</strong> Този анализ е генериран на база научни изследвания за връзката между личностни черти и хранителни навици. 
            Той не заменя консултация с квалифициран специалист. За индивидуален план консултирайте се с лицензиран нутриционист или психолог.
            При признаци на хранително разстройство незабавно потърсете специализирана помощ.
          </div>
        </div>
      `;
      
      container.innerHTML = html;
    }

    function restartTest() {
      currentQuestionIndex = 0;
      answers = {};
      showScreen('screenIntro');
    }

    // Initialize
    document.getElementById('totalQuestions').textContent = questions.length;
  </script>
</body>
</html>
