<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Psych Results UI</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>
<body>
  <div class="container" style="margin-top: 2rem; max-width: 800px;">
    <h1>Demo: Психологически Тестове - UI Визуализация</h1>
    
    <div class="card" style="margin-top: var(--space-lg)">
      <h3><i class="bi bi-gear"></i> Инструменти за Индивидуализация</h3>
      <p style="color: var(--text-color-secondary); font-size: var(--fs-sm); margin-bottom: var(--space-md);">
        Изпълнете психологическите тестове за по-добро разбиране на вашия хранителен профил.
      </p>
      <a 
        href="visual-test.html" 
        class="button-secondary" 
        style="width: 100%; display: block; text-align: center; text-decoration: none; margin-bottom: var(--space-sm);"
      >
        <i class="bi bi-image"></i> Визуален тест
      </a>
      <a 
        href="personality-test.html" 
        class="button-secondary" 
        style="width: 100%; display: block; text-align: center; text-decoration: none;"
      >
        <i class="bi bi-person-check"></i> Личностен тест
      </a>
      <div id="psychTestResults" style="margin-top: var(--space-md); display: block;">
        <div style="background: var(--color-success-bg); padding: var(--space-sm); border-radius: var(--radius-md); border-left: 4px solid var(--color-success);">
          <p style="margin: 0; color: var(--text-color-primary); font-size: var(--fs-sm);">
            <i class="bi bi-check-circle-fill" style="color: var(--color-success);"></i>
            <strong>Резултатите са запазени!</strong>
          </p>
          <div id="psychTestSummary" style="margin-top: var(--space-xs); font-size: var(--fs-xs); color: var(--text-color-secondary);">
            Визуален тест: Емоционално-регулаторен профил<br>
            Личностен тест: E-V-M-J
          </div>
          <button 
            id="regeneratePlanBtn" 
            class="button" 
            style="width: 100%; margin-top: var(--space-sm);"
          >
            <i class="bi bi-arrow-clockwise"></i> Регенерирай План с Нови Данни
          </button>
        </div>
      </div>
    </div>
    
    <!-- Detailed Psych Test Results Card -->
    <div class="card" id="psychTestDetailsCard" style="margin-top: var(--space-lg);">
      <h3><i class="bi bi-clipboard-data"></i> Детайлни Резултати от Тестовете</h3>
      <div id="psychTestDetails"></div>
    </div>
  </div>

  <script type="module">
    const testPsychTests = {
      visualTest: {
        id: "02",
        name: "Емоционално-регулаторен профил",
        short: "Храната като бърз регулатор на напрежение",
        timestamp: new Date().toISOString()
      },
      personalityTest: {
        typeCode: "E-V-M-J",
        scores: {
          E: 75,
          C: 60,
          O: 80,
          A: 65,
          N: 55,
          I: 45,
          R: 40
        },
        riskFlags: [
          "по-висока емоционална реактивност",
          "склонност към comfort eating"
        ],
        timestamp: new Date().toISOString()
      }
    };

    async function displayDetailedPsychTestResults(psychTests, detailsContainer) {
      if (!psychTests || (!psychTests.visualTest && !psychTests.personalityTest)) {
        return;
      }

      let html = '';

      // Visual Test Details
      if (psychTests.visualTest) {
        const vt = psychTests.visualTest;
        html += `
          <div style="margin-bottom: var(--space-lg); padding: var(--space-md); background: var(--surface-background); border-radius: var(--radius-md);">
            <h4 style="margin-top: 0; color: var(--primary-color);">
              <i class="bi bi-image"></i> ${vt.name}
            </h4>
            <p style="font-style: italic; color: var(--text-color-secondary); margin-bottom: var(--space-md);">
              ${vt.short || ''}
            </p>
            ${vt.timestamp ? `<p style="font-size: var(--fs-xs); color: var(--text-color-tertiary); margin: 0;">
              Завършен на: ${new Date(vt.timestamp).toLocaleDateString('bg-BG', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
              })}
            </p>` : ''}
          </div>
        `;
      }

      // Personality Test Details
      if (psychTests.personalityTest) {
        const pt = psychTests.personalityTest;
        html += `
          <div style="margin-bottom: var(--space-lg); padding: var(--space-md); background: var(--surface-background); border-radius: var(--radius-md);">
            <h4 style="margin-top: 0; color: var(--primary-color);">
              <i class="bi bi-person-check"></i> Личностен профил: ${pt.typeCode}
            </h4>
        `;

        // Scores display
        if (pt.scores) {
          html += `<div style="margin-top: var(--space-md);">
            <h5 style="font-size: var(--fs-base); margin-bottom: var(--space-sm);">Измерения:</h5>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: var(--space-sm);">
          `;
          
          const dimensionNames = {
            'E': 'Екстраверсия',
            'C': 'Съвестност',
            'O': 'Откритост',
            'A': 'Доброжелателност',
            'N': 'Невротизъм',
            'I': 'Импулсивност',
            'R': 'Рестриктивност'
          };

          for (const [dim, score] of Object.entries(pt.scores)) {
            const percentage = score;
            const barColor = percentage > 60 ? 'var(--primary-color)' : 
                             percentage > 40 ? 'var(--color-warning)' : 'var(--secondary-color)';
            
            html += `
              <div style="padding: var(--space-xs); background: var(--card-bg); border-radius: var(--radius-sm);">
                <div style="font-size: var(--fs-sm); font-weight: 600; margin-bottom: 2px; color: var(--text-color-primary);">${dim}</div>
                <div style="font-size: var(--fs-xs); color: var(--text-color-secondary); margin-bottom: 4px;">
                  ${dimensionNames[dim] || dim}
                </div>
                <div style="width: 100%; height: 6px; background: var(--progress-bar-bg-empty); border-radius: 3px; overflow: hidden;">
                  <div style="width: ${percentage}%; height: 100%; background: ${barColor}; transition: width 0.3s ease;"></div>
                </div>
                <div style="font-size: var(--fs-xs); color: var(--text-color-muted); margin-top: 2px;">
                  ${score}%
                </div>
              </div>
            `;
          }
          html += `</div></div>`;
        }

        // Risk flags
        if (pt.riskFlags && pt.riskFlags.length > 0) {
          html += `
            <div style="margin-top: var(--space-md); padding: var(--space-sm); background: var(--color-warning-bg); border-left: 4px solid var(--color-warning); border-radius: var(--radius-sm);">
              <h5 style="font-size: var(--fs-base); margin: 0 0 var(--space-xs) 0; color: var(--color-warning);">
                <i class="bi bi-exclamation-triangle"></i> Рискови фактори:
              </h5>
              <ul style="margin: 0; padding-left: var(--space-md); font-size: var(--fs-sm);">
                ${pt.riskFlags.map(flag => `<li>${flag}</li>`).join('')}
              </ul>
            </div>
          `;
        }

        if (pt.timestamp) {
          html += `
            <p style="font-size: var(--fs-xs); color: var(--text-color-muted); margin: var(--space-sm) 0 0 0;">
              Завършен на: ${new Date(pt.timestamp).toLocaleDateString('bg-BG', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
              })}
            </p>
          `;
        }
        html += `</div>`;
      }

      // Correlation with existing profile data
      html += `
        <div style="padding: var(--space-md); background: var(--color-info-bg); border-radius: var(--radius-md); border-left: 4px solid var(--color-info);">
          <h5 style="margin-top: 0; color: var(--color-info);">
            <i class="bi bi-info-circle"></i> Как това влияе на вашия план:
          </h5>
          <p style="font-size: var(--fs-sm); margin: 0;">
            Психологическият ви профил ще бъде включен при следващото генериране на хранителен план. 
            AI моделът ще адаптира препоръките според вашите емоционални нужди, личностни характеристики и потенциални рискове.
          </p>
        </div>
      `;

      detailsContainer.innerHTML = html;
    }

    // Initialize display
    const detailsContainer = document.getElementById('psychTestDetails');
    displayDetailedPsychTestResults(testPsychTests, detailsContainer);

    // Handle button click
    document.getElementById('regeneratePlanBtn').addEventListener('click', () => {
      alert('Demo: В production версията това ще стартира регенериране на плана.');
    });
  </script>
</body>
</html>
