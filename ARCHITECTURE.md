# BodyBest - ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ½Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

> **Ğ¦ĞµĞ» Ğ½Ğ° Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°:** Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ°Ğ½ Ñ€ĞµÑÑƒÑ€Ñ Ğ·Ğ° Ğ±ÑŠÑ€Ğ·Ğ¾ Ğ¾Ñ€Ğ¸ĞµĞ½Ñ‚Ğ¸Ñ€Ğ°Ğ½Ğµ Ğ² ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°Ñ‚Ğ°, Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°Ñ‚Ğ° Ğ¸ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°Ñ‚Ğ° Ğ½Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°.

## Ğ¡ÑŠĞ´ÑŠÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ

1. [ĞĞ±Ñ‰Ğ° Ğ²Ğ¸Ğ·Ğ¸Ñ Ğ¸ Ñ„Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„Ğ¸Ñ](#Ğ¾Ğ±Ñ‰Ğ°-Ğ²Ğ¸Ğ·Ğ¸Ñ-Ğ¸-Ñ„Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„Ğ¸Ñ)
2. [Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµĞ½ ÑÑ‚ĞµĞº](#Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµĞ½-ÑÑ‚ĞµĞº)
3. [ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€ĞµĞ½ Ğ¼Ğ¾Ğ´ĞµĞ»](#Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€ĞµĞ½-Ğ¼Ğ¾Ğ´ĞµĞ»)
4. [Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ½Ğ° Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸Ñ‚Ğµ](#ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°-Ğ½Ğ°-Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸Ñ‚Ğµ)
5. [Frontend Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°](#frontend-Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°)
6. [Backend Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°](#backend-Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°)
7. [Ğ¡ÑŠÑ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ğ´Ğ°Ğ½Ğ½Ğ¸ (KV)](#ÑÑŠÑ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ-Ğ½Ğ°-Ğ´Ğ°Ğ½Ğ½Ğ¸-kv)
8. [API Endpoints](#api-endpoints)
9. [ĞŸĞ¾Ñ‚Ğ¾Ñ†Ğ¸ Ğ¾Ñ‚ Ğ´Ğ°Ğ½Ğ½Ğ¸](#Ğ¿Ğ¾Ñ‚Ğ¾Ñ†Ğ¸-Ğ¾Ñ‚-Ğ´Ğ°Ğ½Ğ½Ğ¸)
10. [Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¸ Ñ‚ĞµÑÑ‚Ğ²Ğ°Ğ½Ğµ](#Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°-Ğ¸-Ñ‚ĞµÑÑ‚Ğ²Ğ°Ğ½Ğµ)

---

## ĞĞ±Ñ‰Ğ° Ğ²Ğ¸Ğ·Ğ¸Ñ Ğ¸ Ñ„Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„Ğ¸Ñ

**BodyBest** Ğµ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑĞ¸Ğ²Ğ½Ğ¾ ÑƒĞµĞ± Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ (PWA) Ğ·Ğ° Ğ¿Ñ€Ğ¾ÑĞ»ĞµĞ´ÑĞ²Ğ°Ğ½Ğµ Ğ½Ğ° Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğµ, Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ¸ Ğ·Ğ´Ñ€Ğ°Ğ²Ğ½Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»Ğ¸ Ñ AI-Ğ°ÑĞ¸ÑÑ‚Ğ¸Ñ€Ğ°Ğ½Ğ¾ Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ°Ğ½Ğµ.

### ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¸ Ğ¿Ñ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ğ¸

- âœ… **ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ñ‚Ğ°** - ĞĞ°Ğ¹-Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ñ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞµÑ‰Ğ¾ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ
- âš¡ **Ğ•Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚** - ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ğ½Ğ¾ÑÑ‚Ñ‚Ğ°
- ğŸ¨ **ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ° Ğ²Ğ¸Ğ·Ğ¸Ñ** - ĞšĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½ UI/UX Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½
- ğŸ“± **Offline-First** - Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ° Ğ±ĞµĞ· Ğ¸Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚ Ğ²Ñ€ÑŠĞ·ĞºĞ°
- ğŸ¤– **AI-Powered** - Ğ˜Ğ½Ñ‚ĞµĞ»Ğ¸Ğ³ĞµĞ½Ñ‚Ğ½Ğ¸ Ğ¿Ñ€ĞµĞ¿Ğ¾Ñ€ÑŠĞºĞ¸ Ğ¸ Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ°Ñ†Ğ¸Ñ

### ĞšĞ»ÑÑ‡Ğ¾Ğ²Ğ¸ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»Ğ½Ğ¾ÑÑ‚Ğ¸

1. **ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ°Ğ½ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ĞµĞ»ĞµĞ½ Ğ¿Ğ»Ğ°Ğ½** - AI Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ°Ğ½ Ğ¿Ğ»Ğ°Ğ½ Ğ±Ğ°Ğ·Ğ¸Ñ€Ğ°Ğ½ Ğ½Ğ° Ğ²ÑŠĞ¿Ñ€Ğ¾ÑĞ½Ğ¸Ğº
2. **ĞŸÑ€Ğ¾ÑĞ»ĞµĞ´ÑĞ²Ğ°Ğ½Ğµ Ğ½Ğ° Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğµ** - Ğ›Ğ¾Ğ³Ğ²Ğ°Ğ½Ğµ Ğ½Ğ° Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ñ offline Ğ¿Ğ¾Ğ´Ğ´Ñ€ÑŠĞ¶ĞºĞ°
3. **ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° Ğ¸ Ğ½Ğ°Ğ¿Ñ€ĞµĞ´ÑŠĞº** - Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ AI Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·
4. **Ğ§Ğ°Ñ‚ Ğ°ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚** - AI Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰Ğ½Ğ¸Ğº Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ¾Ñ‚ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ¸Ñ‚ĞµĞ»ÑĞºĞ¸Ñ‚Ğµ Ğ´Ğ°Ğ½Ğ½Ğ¸
5. **ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¸Ğ²ĞµĞ½ Ğ¿Ğ°Ğ½ĞµĞ»** - Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ° AI Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸, Ğ¸Ğ¼ĞµĞ¹Ğ»Ğ¸, Ñ†Ğ²ĞµÑ‚Ğ¾Ğ²Ğµ
6. **Multi-tenant** - ĞŸĞ¾Ğ´Ğ´Ñ€ÑŠĞ¶ĞºĞ° Ğ·Ğ° Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ¸Ñ‚ĞµĞ»Ğ¸

---

## Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµĞ½ ÑÑ‚ĞµĞº

### Frontend
- **HTML5** - Ğ¡ĞµĞ¼Ğ°Ğ½Ñ‚Ğ¸Ñ‡Ğ½Ğ° ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°
- **CSS3** - ĞœĞ¾Ğ´ÑƒĞ»Ğ½Ğ¸ ÑÑ‚Ğ¸Ğ»Ğ¾Ğ²Ğµ Ñ CSS Ğ¿Ñ€Ğ¾Ğ¼ĞµĞ½Ğ»Ğ¸Ğ²Ğ¸
- **JavaScript (ES Modules)** - ĞĞ°Ñ‚Ğ¸Ğ²Ğ½Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ Ğ±ĞµĞ· bundler
- **Vite** - Dev server Ğ¸ build tool
- **Chart.js** - Ğ“Ñ€Ğ°Ñ„Ğ¸ĞºĞ¸ Ğ¸ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### Backend
- **Cloudflare Workers** - Serverless API platform
- **Cloudflare KV** - Key-Value storage
- **Cloudflare AI** - AI Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ·Ğ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ğ¸ Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ°Ğ½Ğµ
- **Node.js 18+** - Runtime Ğ·Ğ° ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ²Ğµ Ğ¸ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğµ

### AI Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
- **Gemini** - ĞÑĞ½Ğ¾Ğ²ĞµĞ½ Ğ¼Ğ¾Ğ´ĞµĞ» Ğ·Ğ° Ğ¿Ğ»Ğ°Ğ½Ğ¾Ğ²Ğµ
- **Claude** - ĞĞ»Ñ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²ĞµĞ½ Ğ¼Ğ¾Ğ´ĞµĞ»
- **Llama 3** - Cloudflare AI Ğ¼Ğ¾Ğ´ĞµĞ»
- **LLaVA** - ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ½Ğ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
- **Cohere Command-R** - Ğ¡Ğ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ°Ğ½ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·

### Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¸
- **ESLint** - Linting
- **Jest** - Unit testing
- **TypeDoc** - API Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ
- **Wrangler** - Cloudflare CLI

---

## ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€ĞµĞ½ Ğ¼Ğ¾Ğ´ĞµĞ»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CLIENT (Browser)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   HTML     â”‚  â”‚  CSS Modules â”‚  â”‚  JS Modules      â”‚    â”‚
â”‚  â”‚  Pages     â”‚  â”‚  + Themes    â”‚  â”‚  (ES6 Modules)   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚               â”‚                    â”‚               â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                         â”‚                                    â”‚
â”‚                    localStorage                              â”‚
â”‚                  (Offline caching)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ HTTPS
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CLOUDFLARE WORKERS (Serverless)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   worker.js                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Auth & Users â”‚  â”‚ AI Services  â”‚  â”‚   Cron    â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Plan Gen     â”‚  â”‚   Analytics  â”‚  â”‚   Email   â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              worker-backend.js (PHP proxy)           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                â”‚                â”‚
         â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESOURCES_KVâ”‚  â”‚USER_METADATA â”‚  â”‚  External    â”‚
â”‚  (Config &  â”‚  â”‚    _KV       â”‚  â”‚   AI APIs    â”‚
â”‚   Prompts)  â”‚  â”‚ (User data)  â”‚  â”‚ (Gemini etc.)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Offline-First Ğ¼Ğ¾Ğ´ĞµĞ»

```
User Action â†’ localStorage (Instant) â†’ Background Sync â†’ Server
                    â†“
              Immediate UI Update
```

**ĞŸÑ€ĞµĞ´Ğ¸Ğ¼ÑÑ‚Ğ²Ğ°:**
- ĞœĞ¸Ğ³Ğ½Ğ¾Ğ²ĞµĞ½ Ğ¾Ñ‚Ğ³Ğ¾Ğ²Ğ¾Ñ€ (< 50ms)
- Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ° Ğ±ĞµĞ· Ğ¸Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚
- 70-80% Ğ½Ğ°Ğ¼Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ° API calls
- Batch Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸

---

## Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ½Ğ° Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸Ñ‚Ğµ

```
bodybest/
â”œâ”€â”€ ğŸ“„ *.html                    # HTML ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ¸ (29 Ñ„Ğ°Ğ¹Ğ»Ğ°)
â”‚   â”œâ”€â”€ index.html               # Ğ“Ğ»Ğ°Ğ²ĞµĞ½ dashboard
â”‚   â”œâ”€â”€ landing.html             # Landing page
â”‚   â”œâ”€â”€ quest.html               # ĞŸÑŠÑ€Ğ²Ğ¾Ğ½Ğ°Ñ‡Ğ°Ğ»ĞµĞ½ Ğ²ÑŠĞ¿Ñ€Ğ¾ÑĞ½Ğ¸Ğº
â”‚   â”œâ”€â”€ code.html                # Ğ¥Ñ€Ğ°Ğ½Ğ¸Ñ‚ĞµĞ»ĞµĞ½ Ğ¿Ğ»Ğ°Ğ½
â”‚   â”œâ”€â”€ admin.html               # ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ÑĞºĞ¸ Ğ¿Ğ°Ğ½ĞµĞ»
â”‚   â”œâ”€â”€ assistant.html           # AI chat Ğ°ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚
â”‚   â”œâ”€â”€ clientProfile.html       # ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ» Ğ½Ğ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ ğŸ“ js/                       # JavaScript Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ (50+ Ñ„Ğ°Ğ¹Ğ»Ğ°)
â”‚   â”œâ”€â”€ app.js                   # Main app initialization
â”‚   â”œâ”€â”€ auth.js                  # Authentication Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°
â”‚   â”œâ”€â”€ config.js                # Configuration constants
â”‚   â”œâ”€â”€ offlineLogSync.js        # Offline logging ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°
â”‚   â”œâ”€â”€ requestCache.js          # Persistent caching
â”‚   â”œâ”€â”€ macroUtils.js            # Macro calculations
â”‚   â”œâ”€â”€ planGeneration.js        # ĞŸĞ»Ğ°Ğ½ Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ°Ğ½Ğµ
â”‚   â”œâ”€â”€ onboardingWizard.js      # Onboarding flow
â”‚   â”œâ”€â”€ themeControls.js         # Ğ¢ĞµĞ¼Ğ° ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ
â”‚   â””â”€â”€ __tests__/               # Jest Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğµ
â”‚
â”œâ”€â”€ ğŸ“ css/                      # CSS Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ (18 Ñ„Ğ°Ğ¹Ğ»Ğ°)
â”‚   â”œâ”€â”€ base_styles.css          # ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¸ ÑÑ‚Ğ¸Ğ»Ğ¾Ğ²Ğµ + Ñ‚ĞµĞ¼Ğ¸
â”‚   â”œâ”€â”€ index_styles.css         # Dashboard ÑÑ‚Ğ¸Ğ»Ğ¾Ğ²Ğµ
â”‚   â”œâ”€â”€ quest_styles.css         # Ğ’ÑŠĞ¿Ñ€Ğ¾ÑĞ½Ğ¸Ğº ÑÑ‚Ğ¸Ğ»Ğ¾Ğ²Ğµ
â”‚   â”œâ”€â”€ landing_styles.css       # Landing page ÑÑ‚Ğ¸Ğ»Ğ¾Ğ²Ğµ
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ ğŸ“ backend/                  # Backend Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğµ
â”‚   â””â”€â”€ tests/                   # Integration Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğµ
â”‚
â”œâ”€â”€ ğŸ“ scripts/                  # Utility ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ²Ğµ (17 Ñ„Ğ°Ğ¹Ğ»Ğ°)
â”‚   â”œâ”€â”€ sync-kv.js               # KV ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
â”‚   â”œâ”€â”€ validate-json.js         # JSON Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ
â”‚   â”œâ”€â”€ test.sh                  # Test runner
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ ğŸ“ docs/                     # Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ (20+ Ñ„Ğ°Ğ¹Ğ»Ğ°)
â”‚   â”œâ”€â”€ DEV_GUIDE_BG.md          # Ğ ÑŠĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ¾ Ğ·Ğ° Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ñ†Ğ¸
â”‚   â”œâ”€â”€ IMPLEMENTATION_SUMMARY_BG.md
â”‚   â”œâ”€â”€ QUESTIONNAIRE_ANALYSIS_CORRELATION.md
â”‚   â””â”€â”€ api/                     # TypeDoc Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ°Ğ½Ğ° Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ
â”‚
â”œâ”€â”€ ğŸ“ kv/                       # KV Ñ€ĞµÑÑƒÑ€ÑĞ¸
â”‚   â””â”€â”€ DIET_RESOURCES/          # Diet Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ¸, Ğ´Ğ°Ğ½Ğ½Ğ¸, Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
â”‚       â”œâ”€â”€ prompt_*.txt         # AI Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ¾Ğ²Ğµ
â”‚       â”œâ”€â”€ question_definitions.json
â”‚       â”œâ”€â”€ product_macros.json
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ ğŸ“ data/                     # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¸ Ğ´Ğ°Ğ½Ğ½Ğ¸
â”‚   â”œâ”€â”€ commonFoods.json
â”‚   â”œâ”€â”€ welcomeEmailTemplate.html
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ ğŸ“ locales/                  # Ğ›Ğ¾ĞºĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
â”‚   â”œâ”€â”€ macroCard.bg.json
â”‚   â””â”€â”€ macroCard.en.json
â”‚
â”œâ”€â”€ ğŸ“ img/                      # Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
â”œâ”€â”€ ğŸ“ mail/                     # Email ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ²Ğµ
â”œâ”€â”€ ğŸ“ partials/                 # HTML Ñ‡Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¸ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¸
â”‚
â”œâ”€â”€ ğŸ”§ worker.js                 # Main Cloudflare Worker (~9000 lines)
â”œâ”€â”€ ğŸ”§ worker-backend.js         # PHP proxy worker
â”œâ”€â”€ ğŸ”§ mailer.js                 # Email helper
â”œâ”€â”€ ğŸ”§ sendEmailWorker.js        # Email worker
â”‚
â”œâ”€â”€ âš™ï¸ package.json              # NPM dependencies & scripts
â”œâ”€â”€ âš™ï¸ wrangler.toml             # Cloudflare Worker config
â”œâ”€â”€ âš™ï¸ vite.config.js            # Vite configuration
â”œâ”€â”€ âš™ï¸ jest.config.js            # Jest configuration
â”œâ”€â”€ âš™ï¸ eslint.config.js          # ESLint rules
â”œâ”€â”€ âš™ï¸ tsconfig.json             # TypeScript config
â”‚
â””â”€â”€ ğŸ“– README.md                 # Main documentation
```

**Ğ”ĞµÑ‚Ğ°Ğ¹Ğ»Ğ½Ğ¾ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** Ğ’Ğ¸Ğ¶ [FILE_STRUCTURE.md](./FILE_STRUCTURE.md)

---

## Frontend Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### ĞœĞ¾Ğ´ÑƒĞ»Ğ½Ğ° Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

Frontend-ÑŠÑ‚ Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½ Ğ½Ğ° **Ğ½ĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¸ ES6 Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸** Ğ±ĞµĞ· Ğ¸Ğ·Ğ¿Ğ¾Ğ»Ğ·Ğ²Ğ°Ğ½Ğµ Ğ½Ğ° bundler. Ğ’ÑÑĞºĞ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ·Ğ°Ñ€ĞµĞ¶Ğ´Ğ° ÑĞ°Ğ¼Ğ¾ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¸Ñ‚Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸.

#### ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¸ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸

```
js/
â”œâ”€â”€ ğŸ¯ Core (Ğ¯Ğ´Ñ€Ğ¾)
â”‚   â”œâ”€â”€ app.js              # Main initialization
â”‚   â”œâ”€â”€ config.js           # Configuration
â”‚   â””â”€â”€ utils.js            # Common utilities
â”‚
â”œâ”€â”€ ğŸ” Authentication
â”‚   â”œâ”€â”€ auth.js             # Auth Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°
â”‚   â”œâ”€â”€ authModal.js        # Login/Register Ğ¼Ğ¾Ğ´Ğ°Ğ»Ğ¸
â”‚   â””â”€â”€ register.js         # Registration flow
â”‚
â”œâ”€â”€ ğŸ’¾ Data Management
â”‚   â”œâ”€â”€ offlineLogSync.js   # Offline logging (singleton)
â”‚   â”œâ”€â”€ requestCache.js     # PersistentCache ĞºĞ»Ğ°ÑĞ¾Ğ²Ğµ
â”‚   â”œâ”€â”€ safeStorage.js      # localStorage quota handling
â”‚   â””â”€â”€ logger.js           # Centralized logging
â”‚
â”œâ”€â”€ ğŸ“Š Analytics & Planning
â”‚   â”œâ”€â”€ macroUtils.js       # Macro calculations
â”‚   â”œâ”€â”€ planGeneration.js   # ĞŸĞ»Ğ°Ğ½ Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ°Ğ½Ğµ
â”‚   â”œâ”€â”€ planEditor.js       # Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ°Ğ½Ğµ Ğ½Ğ° Ğ¿Ğ»Ğ°Ğ½
â”‚   â”œâ”€â”€ planModChat.js      # Plan modification chat
â”‚   â””â”€â”€ metricUtils.js      # Health metrics
â”‚
â”œâ”€â”€ ğŸ¨ UI Components
â”‚   â”œâ”€â”€ uiHandlers.js       # Event handlers
â”‚   â”œâ”€â”€ uiElements.js       # DOM manipulation
â”‚   â”œâ”€â”€ themeControls.js    # Theme switching
â”‚   â”œâ”€â”€ themeConfig.js      # Theme definitions
â”‚   â”œâ”€â”€ onboardingWizard.js # Onboarding flow
â”‚   â””â”€â”€ syncStatusIndicator.js # Sync status UI
â”‚
â”œâ”€â”€ ğŸ’¬ Chat & AI
â”‚   â”œâ”€â”€ chat.js             # Main chat
â”‚   â”œâ”€â”€ assistantChat.js    # Assistant page chat
â”‚   â””â”€â”€ messageUtils.js     # Message formatting
â”‚
â”œâ”€â”€ ğŸ“ Forms
â”‚   â”œâ”€â”€ questionnaireCore.js # Ğ’ÑŠĞ¿Ñ€Ğ¾ÑĞ½Ğ¸Ğº Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°
â”‚   â”œâ”€â”€ extraMealForm.js    # Extra meal form
â”‚   â””â”€â”€ contactForm.js      # Contact form
â”‚
â”œâ”€â”€ ğŸ“ Admin
â”‚   â”œâ”€â”€ admin.js            # Admin panel logic
â”‚   â”œâ”€â”€ adminConfig.js      # AI model config
â”‚   â””â”€â”€ adminColors.js      # Theme editor
â”‚
â””â”€â”€ ğŸ§ª Testing
    â””â”€â”€ __tests__/          # Jest unit tests (40+ Ñ„Ğ°Ğ¹Ğ»Ğ°)
```

**Ğ”ĞµÑ‚Ğ°Ğ¹Ğ»Ğ½Ğ° ĞºĞ°Ñ€Ñ‚Ğ°:** Ğ’Ğ¸Ğ¶ [MODULE_MAP.md](./MODULE_MAP.md)

### ĞšĞ»ÑÑ‡Ğ¾Ğ²Ğ¸ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¸

#### 1. Singleton Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ ĞºĞ°Ñ‚Ğ¾ `offlineLogSync.js` Ğ¸ `requestCache.js` Ğ¸Ğ·Ğ¿Ğ¾Ğ»Ğ·Ğ²Ğ°Ñ‚ factory Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ·Ğ° singleton instance:

```javascript
// offlineLogSync.js
let instance = null;

export function getOfflineLogSync(options = {}) {
  if (!instance) {
    instance = new OfflineLogSync(options);
  }
  return instance;
}
```

#### 2. Event-driven architecture
ĞœĞ¾Ğ´ÑƒĞ»Ğ¸Ñ‚Ğµ ĞºĞ¾Ğ¼ÑƒĞ½Ğ¸ĞºĞ¸Ñ€Ğ°Ñ‚ Ñ‡Ñ€ĞµĞ· custom events:

```javascript
// offlineLogSync.js ĞµĞ¼Ğ¸Ñ‚Ğ²Ğ° ÑÑŠĞ±Ğ¸Ñ‚Ğ¸Ñ
window.dispatchEvent(new CustomEvent('offlineSyncStatus', {
  detail: { status: 'syncing', pending: count }
}));

// syncStatusIndicator.js ÑĞ»ÑƒÑˆĞ°
window.addEventListener('offlineSyncStatus', (e) => {
  updateIndicator(e.detail.status);
});
```

#### 3. Lazy loading
Ğ¢ĞµĞ¶ĞºĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ ÑĞµ Ğ·Ğ°Ñ€ĞµĞ¶Ğ´Ğ°Ñ‚ Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡Ğ½Ğ¾:

```javascript
// script.js (landing page)
async function showAuthModal() {
  const { setupAuthModal } = await import('./js/authModal.js');
  setupAuthModal();
}
```

### Themes ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°

Ğ¢Ñ€Ğ¸ Ñ‚ĞµĞ¼Ğ¸ + high contrast mode:
- **Light** - Ğ¡Ğ²ĞµÑ‚ÑŠĞ» Ñ„Ğ¾Ğ½
- **Dark** - Ğ¢ÑŠĞ¼ĞµĞ½ Ñ„Ğ¾Ğ½
- **Vivid** - Ğ¯Ñ€ĞºĞ¸ Ñ†Ğ²ĞµÑ‚Ğ¾Ğ²Ğµ
- **High Contrast** - Accessibility Ñ€ĞµĞ¶Ğ¸Ğ¼

Ğ¦Ğ²ĞµÑ‚Ğ¾Ğ²ĞµÑ‚Ğµ ÑĞµ ÑÑŠÑ…Ñ€Ğ°Ğ½ÑĞ²Ğ°Ñ‚ Ğ² CSS Ğ¿Ñ€Ğ¾Ğ¼ĞµĞ½Ğ»Ğ¸Ğ²Ğ¸:
```css
:root { --primary-color: #007bff; }
body.dark-theme { --primary-color: #4dabff; }
body.vivid-theme { --primary-color: #00d4ff; }
```

Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: `js/themeControls.js` + `js/themeConfig.js`

---

## Backend Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### Cloudflare Workers ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°

#### Main Worker (`worker.js`)

ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¸ÑÑ‚ worker Ğ¾Ğ±ÑĞ»ÑƒĞ¶Ğ²Ğ° ~60 API endpoints. Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ°Ğ½ Ğµ Ğ² ÑĞµĞºÑ†Ğ¸Ğ¸:

```javascript
// worker.js ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° (~9000 lines)

// 1. Imports & Configuration
import { Buffer } from 'node:buffer';
const CF_ACCOUNT_ID = env.CF_ACCOUNT_ID || 'xxx';

// 2. Utility Functions
function getLocalDate() { ... }
function sanitizeText(text) { ... }
function createUserKvIndex(userId, keys) { ... }

// 3. Authentication
async function authenticateUser(email, password, env) { ... }
async function registerUser(data, env) { ... }

// 4. AI Services
async function callOpenAI(messages, options, env) { ... }
async function callGemini(messages, options, env) { ... }
async function callCloudflareAI(model, messages, env) { ... }

// 5. Plan Generation
async function generateInitialPlan(userId, analysis, env) { ... }
async function modifyPlan(userId, userMessage, env) { ... }

// 6. Analytics
async function generatePraise(userId, env) { ... }
async function analyzeProgress(userId, env) { ... }

// 7. Cron Jobs
async function processScheduledTasks(env) { ... }

// 8. Main Request Handler
export default {
  async fetch(request, env, ctx) {
    const url = new URL(request.url);
    
    // Routing
    if (url.pathname === '/api/login') { ... }
    if (url.pathname === '/api/generatePlan') { ... }
    ...
    
    // Static file serving
    return env.ASSETS.fetch(request);
  },
  
  async scheduled(event, env, ctx) {
    // Cron handler
  }
}
```

#### ĞšĞ»ÑÑ‡Ğ¾Ğ²Ğ¸ ÑĞµĞºÑ†Ğ¸Ğ¸

**1. User Management**
- `/api/register` - Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ
- `/api/login` - Ğ’Ñ…Ğ¾Ğ´
- `/api/getProfile` - ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ» Ğ´Ğ°Ğ½Ğ½Ğ¸
- `/api/updateProfile` - ĞĞ±Ğ½Ğ¾Ğ²ÑĞ²Ğ°Ğ½Ğµ

**2. Plan Generation**
- `/api/submitQuestionnaire` - ĞŸÑŠÑ€Ğ²Ğ¾Ğ½Ğ°Ñ‡Ğ°Ğ»ĞµĞ½ Ğ²ÑŠĞ¿Ñ€Ğ¾ÑĞ½Ğ¸Ğº
- `/api/generatePlan` - Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ°Ğ½Ğµ Ğ½Ğ° Ğ¿Ğ»Ğ°Ğ½
- `/api/regeneratePlan` - ĞŸÑŠĞ»Ğ½Ğ¾ Ñ€ĞµĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ°Ğ½Ğµ
- `/api/modifyPlan` - ĞŸÑ€Ğ¾Ğ¼ÑĞ½Ğ° Ğ½Ğ° Ğ¿Ğ»Ğ°Ğ½
- `/api/checkPlanStatus` - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° ÑÑ‚Ğ°Ñ‚ÑƒÑ

**3. Logging**
- `/api/log` - Single log entry
- `/api/batch-log` - Batch logging (offline sync)
- `/api/log-extra-meal` - Ğ˜Ğ·Ğ²ÑŠĞ½Ñ€ĞµĞ´Ğ½Ğ¾ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğµ
- `/api/getDailyLog` - Ğ”Ğ½ĞµĞ²ĞµĞ½ Ğ»Ğ¾Ğ³

**4. Analytics**
- `/api/getAnalytics` - Dashboard Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°
- `/api/generatePraise` - AI Ğ¿Ğ¾Ñ…Ğ²Ğ°Ğ»Ğ°
- `/api/aiHelper` - AI ÑÑŠĞ²ĞµÑ‚Ğ¸
- `/api/getInitialAnalysis` - ĞŸÑŠÑ€Ğ²Ğ¾Ğ½Ğ°Ñ‡Ğ°Ğ»ĞµĞ½ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·

**5. Chat**
- `/api/chat` - AI Ñ‡Ğ°Ñ‚
- `/api/analyzeImage` - ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ½Ğ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ

**6. Admin**
- `/api/getAiConfig` - AI Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ config
- `/api/setAiConfig` - ĞŸÑ€Ğ¾Ğ¼ÑĞ½Ğ° Ğ½Ğ° AI config
- `/api/sendTestEmail` - Ğ¢ĞµÑÑ‚Ğ¾Ğ² Ğ¸Ğ¼ĞµĞ¹Ğ»
- `/api/setMaintenanceMode` - Ğ ĞµĞ¶Ğ¸Ğ¼ Ğ¿Ğ¾Ğ´Ğ´Ñ€ÑŠĞ¶ĞºĞ°

#### Backend Worker (`worker-backend.js`)

PHP proxy worker Ğ·Ğ° Cloudflare AI:
- ĞŸÑ€Ğ¸ĞµĞ¼Ğ° POST Ğ·Ğ°ÑĞ²ĞºĞ¸ Ğ¾Ñ‚ PHP
- Ğ˜Ğ·Ğ²Ğ¸ĞºĞ²Ğ° Cloudflare AI models
- Ğ’Ñ€ÑŠÑ‰Ğ° Ñ€ĞµĞ·ÑƒĞ»Ñ‚Ğ°Ñ‚Ğ¸ Ğ² JSON

```javascript
// worker-backend.js (~200 lines)
export default {
  async fetch(request, env) {
    if (request.method !== 'POST') {
      return new Response('Method not allowed', { status: 405 });
    }
    
    const { model, prompt, image } = await request.json();
    const result = await env.AI.run(model, { prompt, image });
    return Response.json(result);
  }
}
```

#### Email Worker (`sendEmailWorker.js`)

Worker Ğ·Ğ° Ğ¸Ğ·Ğ¿Ñ€Ğ°Ñ‰Ğ°Ğ½Ğµ Ğ½Ğ° Ğ¸Ğ¼ĞµĞ¹Ğ»Ğ¸:
- ĞŸÑ€Ğ¸ĞµĞ¼Ğ° `/api/sendEmail` Ğ·Ğ°ÑĞ²ĞºĞ¸
- Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ PHP backend
- Rate limiting

---

## Ğ¡ÑŠÑ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ğ´Ğ°Ğ½Ğ½Ğ¸ (KV)

### KV Namespaces

#### 1. `RESOURCES_KV` - ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¸ Ñ€ĞµÑÑƒÑ€ÑĞ¸

**ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸:**

**AI Prompts** (18 Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°)
```
prompt_unified_plan_generation_v2
prompt_questionnaire_analysis
prompt_plan_modification
prompt_chat
prompt_image_analysis
prompt_analytics_textual_summary
prompt_praise_generation
prompt_principle_adjustment
prompt_macro_calculation
...
```

**AI Models Configuration**
```
model_chat                    # @cf/meta/llama-3-8b-instruct
model_plan_generation         # gemini-1.5-pro
model_image_analysis          # @cf/llava-hf/llava-v1.6b
model_questionnaire_analysis  # claude-3-5-sonnet-20241022
...
```

**AI Parameters**
```
plan_token_limit    # 8000
plan_temperature    # 0.7
chat_token_limit    # 2000
chat_temperature    # 0.3
...
```

**Email Templates**
```
welcome_email_subject
welcome_email_body
questionnaire_email_subject
questionnaire_email_body
analysis_email_subject
analysis_email_body
password_reset_email_subject
password_reset_email_body
```

**Email Flags**
```
send_welcome_email          # "1"
send_questionnaire_email    # "1"
send_analysis_email         # "1"
send_contact_email          # "1"
```

**Diet Data**
```
allowed_meal_combinations   # JSON array
base_diet_model            # JSON object
eating_psychology          # Text
question_definitions       # JSON array
recipe_data               # JSON array
product_macros            # JSON object
nutrient_overrides        # JSON object
```

**Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:** `npm run sync-kv` (Ğ¾Ñ‚ `kv/DIET_RESOURCES/`)

#### 2. `USER_METADATA_KV` - ĞŸĞ¾Ñ‚Ñ€ĞµĞ±Ğ¸Ñ‚ĞµĞ»ÑĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ğ¸

**User records:**
```
user:<userId>                    # User profile
{
  userId: string,
  email: string,
  passwordHash: string,
  name: string,
  createdAt: number,
  lastLogin: number
}
```

**Plan data:**
```
<userId>_final_plan              # Generated plan
{
  meals: [...],
  caloriesMacros: {
    plan: { calories, protein_grams, carbs_grams, fat_grams },
    recommendation: { ... }
  },
  principles: [...],
  adaptiveQuiz: [...]
}

<userId>_questionnaire           # Initial questionnaire
<userId>_analysis                # Initial AI analysis
<userId>_analysis_status         # "pending" | "done" | "error"
```

**Daily logs:**
```
<userId>_log_<YYYY-MM-DD>        # Daily log
{
  date: "YYYY-MM-DD",
  meals: {
    breakfast: { consumed: true, time: "08:00" },
    ...
  },
  extraMeals: [
    { time, description, calories, protein, carbs, fat }
  ],
  water_intake: 2.0,
  weight_kg: 75.5,
  ...
}
```

**Events & Queue:**
```
event_<type>_<userId>            # Pending events
events_queue                     # Array of event objects
[
  { key: "event_planMod_123", type: "planMod", userId: "123" }
]
```

**Index:**
```
<userId>_kv_index                # User's important keys
[
  "<userId>_final_plan",
  "<userId>_questionnaire",
  "<userId>_log_2024-01-15",
  ...
]
```

### KV ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸

**Ğ§ĞµÑ‚ĞµĞ½Ğµ:**
```javascript
const plan = await env.USER_METADATA_KV.get(`${userId}_final_plan`, 'json');
```

**Ğ—Ğ°Ğ¿Ğ¸Ñ:**
```javascript
await env.USER_METADATA_KV.put(
  `${userId}_final_plan`,
  JSON.stringify(plan),
  { expirationTtl: 60 * 60 * 24 * 365 } // 1 Ğ³Ğ¾Ğ´Ğ¸Ğ½Ğ°
);
```

**Ğ¡Ğ¿Ğ¸ÑÑŠĞº:**
```javascript
const list = await env.USER_METADATA_KV.list({ prefix: `${userId}_` });
```

**Ğ˜Ğ½Ğ´ĞµĞºÑĞ¸Ñ€Ğ°Ğ½Ğµ:**
```javascript
// Ğ¡ÑŠĞ·Ğ´Ğ°Ğ²Ğ°Ğ½Ğµ Ğ½Ğ° Ğ¸Ğ½Ğ´ĞµĞºÑ Ñ Ğ²Ğ°Ğ¶Ğ½Ğ¸ ĞºĞ»ÑÑ‡Ğ¾Ğ²Ğµ
const index = [
  `${userId}_final_plan`,
  `${userId}_questionnaire`,
  // ... Ğ´Ñ€ÑƒĞ³Ğ¸ Ğ²Ğ°Ğ¶Ğ½Ğ¸ ĞºĞ»ÑÑ‡Ğ¾Ğ²Ğµ
];
await env.USER_METADATA_KV.put(`${userId}_kv_index`, JSON.stringify(index));
```

---

## API Endpoints

### ĞŸÑŠĞ»ĞµĞ½ ÑĞ¿Ğ¸ÑÑŠĞº (60+ endpoints)

#### Authentication & Users
| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/register` | Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° Ğ½Ğ¾Ğ² Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ¸Ñ‚ĞµĞ» |
| POST | `/api/login` | Ğ’Ñ…Ğ¾Ğ´ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°Ñ‚Ğ° |
| GET | `/api/getProfile` | Ğ—Ğ°Ñ€ĞµĞ¶Ğ´Ğ°Ğ½Ğµ Ğ½Ğ° Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ» |
| POST | `/api/updateProfile` | ĞĞ±Ğ½Ğ¾Ğ²ÑĞ²Ğ°Ğ½Ğµ Ğ½Ğ° Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ» |
| POST | `/api/requestPasswordReset` | Ğ—Ğ°ÑĞ²ĞºĞ° Ğ·Ğ° Ğ½Ğ¾Ğ²Ğ° Ğ¿Ğ°Ñ€Ğ¾Ğ»Ğ° |
| POST | `/api/performPasswordReset` | Ğ—Ğ°Ğ´Ğ°Ğ²Ğ°Ğ½Ğµ Ğ½Ğ° Ğ½Ğ¾Ğ²Ğ° Ğ¿Ğ°Ñ€Ğ¾Ğ»Ğ° |

#### Plan Generation & Modification
| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/submitQuestionnaire` | Ğ˜Ğ·Ğ¿Ñ€Ğ°Ñ‰Ğ°Ğ½Ğµ Ğ½Ğ° Ğ²ÑŠĞ¿Ñ€Ğ¾ÑĞ½Ğ¸Ğº |
| POST | `/api/generatePlan` | Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ°Ğ½Ğµ Ğ½Ğ° Ğ¿Ğ»Ğ°Ğ½ |
| POST | `/api/regeneratePlan` | ĞŸÑŠĞ»Ğ½Ğ¾ Ñ€ĞµĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ°Ğ½Ğµ |
| POST | `/api/modifyPlan` | ĞŸÑ€Ğ¾Ğ¼ÑĞ½Ğ° Ğ½Ğ° Ğ¿Ğ»Ğ°Ğ½ |
| GET | `/api/checkPlanStatus` | ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° ÑÑ‚Ğ°Ñ‚ÑƒÑ |
| GET | `/api/getPlan` | Ğ—Ğ°Ñ€ĞµĞ¶Ğ´Ğ°Ğ½Ğµ Ğ½Ğ° Ğ¿Ğ»Ğ°Ğ½ |
| GET | `/api/checkPlanPrerequisites` | ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ·Ğ° prerequisites |

#### Logging
| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/log` | Single log entry |
| POST | `/api/batch-log` | Batch Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ (offline sync) |
| POST | `/api/log-extra-meal` | Ğ˜Ğ·Ğ²ÑŠĞ½Ñ€ĞµĞ´Ğ½Ğ¾ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğµ |
| GET | `/api/getDailyLog` | Ğ”Ğ½ĞµĞ²ĞµĞ½ Ğ»Ğ¾Ğ³ |
| GET | `/api/getLogs` | ĞœĞ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²Ğ¾ Ğ»Ğ¾Ğ³Ğ¾Ğ²Ğµ |

#### Analytics
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/getAnalytics` | Dashboard Ğ´Ğ°Ğ½Ğ½Ğ¸ |
| GET | `/api/getInitialAnalysis` | ĞŸÑŠÑ€Ğ²Ğ¾Ğ½Ğ°Ñ‡Ğ°Ğ»ĞµĞ½ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· |
| GET | `/api/analysisStatus` | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ½Ğ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° |
| POST | `/api/generatePraise` | AI Ğ¿Ğ¾Ñ…Ğ²Ğ°Ğ»Ğ° |
| POST | `/api/aiHelper` | AI ÑÑŠĞ²ĞµÑ‚Ğ¸ |
| POST | `/api/acknowledgeAiUpdate` | ĞœĞ°Ñ€ĞºĞ¸Ñ€Ğ° AI update ĞºĞ°Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ñ‡ĞµÑ‚ĞµĞ½Ğ¾ |
| GET | `/api/getAchievements` | ĞŸĞ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ |

#### Chat & AI
| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/chat` | AI Ñ‡Ğ°Ñ‚ |
| POST | `/api/analyzeImage` | ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ½Ğ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ |
| POST | `/api/runImageModel` | Direct Cloudflare AI image |
| POST | `/api/testAiModel` | Ğ¢ĞµÑÑ‚ Ğ½Ğ° AI Ğ¼Ğ¾Ğ´ĞµĞ» |

#### Admin
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/getAiConfig` | AI ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ |
| POST | `/api/setAiConfig` | ĞŸÑ€Ğ¾Ğ¼ÑĞ½Ğ° Ğ½Ğ° AI config |
| GET | `/api/listAiPresets` | AI Ğ¿Ñ€ĞµÑĞµÑ‚Ğ¸ |
| GET | `/api/getAiPreset` | ĞšĞ¾Ğ½ĞºÑ€ĞµÑ‚ĞµĞ½ Ğ¿Ñ€ĞµÑĞµÑ‚ |
| POST | `/api/saveAiPreset` | Ğ—Ğ°Ğ¿Ğ°Ğ·Ğ²Ğ°Ğ½Ğµ Ğ½Ğ° Ğ¿Ñ€ĞµÑĞµÑ‚ |
| POST | `/api/sendTestEmail` | Ğ¢ĞµÑÑ‚Ğ¾Ğ² Ğ¸Ğ¼ĞµĞ¹Ğ» |
| POST | `/api/sendEmail` | Ğ˜Ğ·Ğ¿Ñ€Ğ°Ñ‰Ğ°Ğ½Ğµ Ğ½Ğ° Ğ¸Ğ¼ĞµĞ¹Ğ» |
| GET | `/api/getMaintenanceMode` | Ğ ĞµĞ¶Ğ¸Ğ¼ Ğ¿Ğ¾Ğ´Ğ´Ñ€ÑŠĞ¶ĞºĞ° |
| POST | `/api/setMaintenanceMode` | Ğ—Ğ°Ğ´Ğ°Ğ²Ğ°Ğ½Ğµ Ğ½Ğ° Ñ€ĞµĞ¶Ğ¸Ğ¼ |
| GET | `/api/peekAdminQueries` | ĞĞµĞ¿Ñ€Ğ¾Ñ‡ĞµÑ‚ĞµĞ½Ğ¸ Ğ·Ğ°ÑĞ²ĞºĞ¸ |
| GET | `/api/getAdminQueries` | Ğ’ÑĞ¸Ñ‡ĞºĞ¸ Ğ·Ğ°ÑĞ²ĞºĞ¸ |

#### Feedback
| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/submitFeedback` | ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ° Ğ²Ñ€ÑŠĞ·ĞºĞ° |
| POST | `/api/recordFeedbackChat` | ĞÑ‚Ğ±ĞµĞ»ÑĞ·Ğ²Ğ°Ğ½Ğµ Ğ½Ğ° Ñ‡Ğ°Ñ‚ |
| GET | `/api/getFeedbackMessages` | Ğ¡ÑŠĞ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ |

#### File Management
| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/uploadTestResult` | Ğ˜Ğ·ÑĞ»ĞµĞ´Ğ²Ğ°Ğ½Ğµ |
| POST | `/api/uploadIrisDiag` | Ğ˜Ñ€Ğ¸ÑĞ¾Ğ²Ğ° Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° |

#### KV & Data
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/listUserKv` | KV ĞºĞ»ÑÑ‡Ğ¾Ğ²Ğµ Ğ½Ğ° Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ¸Ñ‚ĞµĞ» |

**ĞŸÑŠĞ»Ğ½Ğ° Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ:** Ğ’Ğ¸Ğ¶ [API_REFERENCE.md](./docs/API_REFERENCE.md)

---

## ĞŸĞ¾Ñ‚Ğ¾Ñ†Ğ¸ Ğ¾Ñ‚ Ğ´Ğ°Ğ½Ğ½Ğ¸

### 1. Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¸ Ğ¿ÑŠÑ€Ğ²Ğ¾Ğ½Ğ°Ñ‡Ğ°Ğ»ĞµĞ½ Ğ²ÑŠĞ¿Ñ€Ğ¾ÑĞ½Ğ¸Ğº

```mermaid
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant W as Worker
    participant KV as USER_METADATA_KV
    participant AI as AI Model
    
    U->>F: ĞŸĞ¾Ğ¿ÑŠĞ»Ğ²Ğ° Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ
    F->>W: POST /api/register
    W->>KV: Ğ¡ÑŠĞ·Ğ´Ğ°Ğ²Ğ° user:<userId>
    W->>U: Ğ˜Ğ·Ğ¿Ñ€Ğ°Ñ‰Ğ° welcome email
    W->>F: { userId, success: true }
    
    U->>F: ĞŸĞ¾Ğ¿ÑŠĞ»Ğ²Ğ° Ğ²ÑŠĞ¿Ñ€Ğ¾ÑĞ½Ğ¸Ğº
    F->>W: POST /api/submitQuestionnaire
    W->>KV: Ğ—Ğ°Ğ¿Ğ¸ÑĞ²Ğ° <userId>_questionnaire
    W->>KV: Ğ—Ğ°Ğ¿Ğ¸ÑĞ²Ğ° <userId>_analysis_status = "pending"
    W->>AI: ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ½Ğ° Ğ¾Ñ‚Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸
    AI->>W: Analysis result
    W->>KV: Ğ—Ğ°Ğ¿Ğ¸ÑĞ²Ğ° <userId>_analysis
    W->>KV: Ğ—Ğ°Ğ¿Ğ¸ÑĞ²Ğ° <userId>_analysis_status = "done"
    W->>U: Ğ˜Ğ·Ğ¿Ñ€Ğ°Ñ‰Ğ° analysis email
    W->>F: { success: true }
```

### 2. Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ°Ğ½Ğµ Ğ½Ğ° Ğ¿Ğ»Ğ°Ğ½

```mermaid
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant W as Worker
    participant KV as USER_METADATA_KV
    participant AI as AI Model
    
    U->>F: ĞĞ°Ñ‚Ğ¸ÑĞºĞ° "Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ°Ğ¹ Ğ¿Ğ»Ğ°Ğ½"
    F->>W: POST /api/generatePlan
    W->>KV: Ğ—Ğ°Ñ€ĞµĞ¶Ğ´Ğ° <userId>_analysis
    W->>KV: Ğ—Ğ°Ñ€ĞµĞ¶Ğ´Ğ° question_definitions Ğ¾Ñ‚ RESOURCES_KV
    W->>AI: Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ° Ğ¿Ğ»Ğ°Ğ½ Ñ prompt_unified_plan_generation_v2
    AI->>W: Generated plan JSON
    W->>KV: Ğ—Ğ°Ğ¿Ğ¸ÑĞ²Ğ° <userId>_final_plan
    W->>KV: ĞĞ±Ğ½Ğ¾Ğ²ÑĞ²Ğ° <userId>_kv_index
    W->>F: { success: true, plan }
    F->>U: ĞŸĞ¾ĞºĞ°Ğ·Ğ²Ğ° Ğ¿Ğ»Ğ°Ğ½Ğ°
```

### 3. Offline Logging

```mermaid
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant LS as localStorage
    participant W as Worker (Background)
    participant KV as USER_METADATA_KV
    
    U->>F: Ğ›Ğ¾Ğ³Ğ²Ğ° Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğµ
    F->>LS: Ğ—Ğ°Ğ¿Ğ¸ÑĞ²Ğ° Ğ² pending_logs (instant)
    F->>U: ĞŸĞ¾ĞºĞ°Ğ·Ğ²Ğ° ÑƒÑĞ¿ĞµÑ… (<50ms)
    
    Note over F,LS: User Ğ¿Ñ€Ğ¾Ğ´ÑŠĞ»Ğ¶Ğ°Ğ²Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°
    
    loop Ğ’ÑĞµĞºĞ¸ 30 ÑĞµĞºÑƒĞ½Ğ´Ğ¸
        F->>LS: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞ²Ğ° pending logs
        alt Ğ˜Ğ¼Ğ° pending logs
            F->>W: POST /api/batch-log (background)
            W->>KV: Batch Ğ·Ğ°Ğ¿Ğ¸Ñ
            W->>F: { success: true, count }
            F->>LS: Ğ˜Ğ·Ñ‚Ñ€Ğ¸Ğ²Ğ° ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ°Ğ½Ğ¸Ñ‚Ğµ
        end
    end
```

### 4. AI Chat Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚

```mermaid
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant W as Worker
    participant KV as USER_METADATA_KV
    participant AI as AI Model
    
    U->>F: Ğ˜Ğ·Ğ¿Ñ€Ğ°Ñ‰Ğ° ÑÑŠĞ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ² Ñ‡Ğ°Ñ‚Ğ°
    F->>W: POST /api/chat
    W->>KV: Ğ—Ğ°Ñ€ĞµĞ¶Ğ´Ğ° <userId>_final_plan
    W->>KV: Ğ—Ğ°Ñ€ĞµĞ¶Ğ´Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸ Ğ»Ğ¾Ğ³Ğ¾Ğ²Ğµ
    W->>W: Ğ˜Ğ·Ğ³Ñ€Ğ°Ğ¶Ğ´Ğ° ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚
    W->>AI: Ğ˜Ğ·Ğ¿Ñ€Ğ°Ñ‰Ğ° Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚
    AI->>W: AI response
    W->>F: { message: "..." }
    F->>U: ĞŸĞ¾ĞºĞ°Ğ·Ğ²Ğ° Ğ¾Ñ‚Ğ³Ğ¾Ğ²Ğ¾Ñ€
```

### 5. ĞŸÑ€Ğ¾Ğ¼ÑĞ½Ğ° Ğ½Ğ° Ğ¿Ğ»Ğ°Ğ½

```mermaid
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant W as Worker
    participant KV as USER_METADATA_KV
    participant AI as AI Model
    
    U->>F: ĞĞ°Ñ‚Ğ¸ÑĞºĞ° "Ğ’ÑŠĞ²ĞµĞ´Ğ¸ Ğ¿Ñ€Ğ¾Ğ¼ĞµĞ½Ğ¸"
    F->>F: ĞÑ‚Ğ²Ğ°Ñ€Ñ plan modification modal
    U->>F: ĞĞ¿Ğ¸ÑĞ²Ğ° Ğ¿Ñ€Ğ¾Ğ¼ÑĞ½Ğ° Ğ² chat
    F->>W: POST /api/chat?source=planModChat
    W->>KV: Ğ¡ÑŠĞ·Ğ´Ğ°Ğ²Ğ° event_planMod_<userId>
    W->>KV: Ğ”Ğ¾Ğ±Ğ°Ğ²Ñ ĞºÑŠĞ¼ events_queue
    W->>F: { success: true }
    
    Note over W,KV: Cron job (scheduled)
    
    W->>KV: Ğ§ĞµÑ‚Ğµ events_queue
    W->>KV: Ğ—Ğ°Ñ€ĞµĞ¶Ğ´Ğ° event_planMod_<userId>
    W->>KV: Ğ—Ğ°Ñ€ĞµĞ¶Ğ´Ğ° Ñ‚ĞµĞºÑƒÑ‰ <userId>_final_plan
    W->>AI: ĞœĞ¾Ğ´Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ° Ğ¿Ğ»Ğ°Ğ½ Ñ prompt_plan_modification
    AI->>W: Modified plan
    W->>KV: Ğ—Ğ°Ğ¿Ğ¸ÑĞ²Ğ° Ğ½Ğ¾Ğ² <userId>_final_plan
    W->>KV: Ğ˜Ğ·Ñ‚Ñ€Ğ¸Ğ²Ğ° event_planMod_<userId>
    W->>KV: ĞŸÑ€ĞµĞ¼Ğ°Ñ…Ğ²Ğ° Ğ¾Ñ‚ events_queue
    
    F->>W: ĞŸĞµÑ€Ğ¸Ğ¾Ğ´Ğ¸Ñ‡Ğ½Ğ¾ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞ²Ğ° ÑÑ‚Ğ°Ñ‚ÑƒÑ
    W->>F: { status: "done", plan }
    F->>U: ĞŸĞ¾ĞºĞ°Ğ·Ğ²Ğ° Ğ¾Ğ±Ğ½Ğ¾Ğ²ĞµĞ½Ğ¸Ñ Ğ¿Ğ»Ğ°Ğ½
```

---

## Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¸ Ñ‚ĞµÑÑ‚Ğ²Ğ°Ğ½Ğµ

### Development Setup

```bash
# 1. Clone
git clone https://github.com/Radilovk/bodybest.git
cd bodybest

# 2. Install
npm install

# 3. Start dev server
npm run dev
# â†’ http://localhost:5173
```

### NPM Scripts

```bash
npm run dev          # Vite dev server
npm run build        # Production build
npm run lint         # ESLint
npm test             # Jest Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğµ
npm run test:watch   # Watch mode
npm run test:file <path>  # ĞšĞ¾Ğ½ĞºÑ€ĞµÑ‚ĞµĞ½ Ñ„Ğ°Ğ¹Ğ»
npm run test:related # Ğ¡Ñ‚ĞµĞ¹Ğ´Ğ¶Ğ½Ğ°Ñ‚Ğ¸ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğµ
npm run coverage     # Code coverage
npm run docs         # TypeDoc documentation
npm run sync-kv      # Sync KV resources
npm run deploy       # Deploy to Cloudflare
```

### Testing Strategy

#### Unit Tests (Jest)
```bash
js/__tests__/
â”œâ”€â”€ adminConfig.test.js         # Admin configuration
â”œâ”€â”€ auth.test.js                # Authentication
â”œâ”€â”€ macroUtils.test.js          # Macro calculations
â”œâ”€â”€ offlineLogSync.test.js      # Offline logging
â”œâ”€â”€ requestCache.test.js        # Caching
â”œâ”€â”€ themeAccessibility.test.js  # Accessibility
â””â”€â”€ ... (40+ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¸ Ñ„Ğ°Ğ¹Ğ»Ğ°)
```

**Ğ˜Ğ·Ğ¿ÑŠĞ»Ğ½ĞµĞ½Ğ¸Ğµ:**
```bash
npm test                        # Ğ’ÑĞ¸Ñ‡ĞºĞ¸ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğµ
npm run test:watch              # Watch mode
npm run test:file js/__tests__/auth.test.js
```

#### Backend Tests
```bash
backend/tests/
â”œâ”€â”€ checkPlanPrerequisites.test.js
â”œâ”€â”€ regeneratePlan.test.js
â””â”€â”€ submitQuestionnairePlanStart.test.js
```

#### Lint
```bash
npm run lint
# ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ° Ğ¿Ğ¾Ğ¿Ñ€Ğ°Ğ²ĞºĞ°:
npm run lint -- --fix
```

### Debugging

#### Worker Logs
```bash
# Local dev
wrangler dev

# Production logs
wrangler tail
```

#### Browser DevTools
- Network tab: API Ğ·Ğ°ÑĞ²ĞºĞ¸
- Application â†’ localStorage: Offline Ğ´Ğ°Ğ½Ğ½Ğ¸
- Console: Debug ÑÑŠĞ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ

### Deployment

```bash
# 1. Ğ›Ğ¾ĞºĞ°Ğ»Ğ½Ğ° Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ
npm run lint
npm test
npm run build

# 2. Deploy
npm run deploy
# Ğ¸Ğ»Ğ¸
wrangler deploy

# 3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°
curl https://your-worker.workers.dev/api/healthcheck
```

**CI/CD:** GitHub Actions (`.github/workflows/deploy.yml`)

---

## Ğ¡Ğ»ĞµĞ´Ğ²Ğ°Ñ‰Ğ¸ ÑÑ‚ÑŠĞ¿ĞºĞ¸

### Ğ—Ğ° Ğ½Ğ¾Ğ²Ğ¸ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ñ†Ğ¸
ğŸš€ **Ğ—Ğ°Ğ¿Ğ¾Ñ‡Ğ½Ğ¸ Ñ [QUICK_START.md](./QUICK_START.md)** - Ğ‘ÑŠÑ€Ğ· ÑÑ‚Ğ°Ñ€Ñ‚ Ğ·Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

### Ğ—Ğ° Ğ´ĞµÑ‚Ğ°Ğ¹Ğ»Ğ½Ğ° Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ
- ğŸ“ [FILE_STRUCTURE.md](./FILE_STRUCTURE.md) - Ğ”ĞµÑ‚Ğ°Ğ¹Ğ»Ğ½Ğ° ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ½Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²ĞµÑ‚Ğµ
- ğŸ—ºï¸ [MODULE_MAP.md](./MODULE_MAP.md) - ĞšĞ°Ñ€Ñ‚Ğ° Ğ½Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸Ñ‚Ğµ Ğ¸ Ñ‚ĞµÑ…Ğ½Ğ¸Ñ‚Ğµ Ğ¾Ñ‚Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ½Ğ¾ÑÑ‚Ğ¸
- ğŸ”Œ [API_REFERENCE.md](./docs/API_REFERENCE.md) - API endpoint Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ (Ğ°ĞºĞ¾ ÑÑŠÑ‰ĞµÑÑ‚Ğ²ÑƒĞ²Ğ°)
- ğŸ¨ [THEME_SYSTEM.md](./docs/THEME_SYSTEM.md) - Ğ¢ĞµĞ¼Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° (Ğ°ĞºĞ¾ ÑÑŠÑ‰ĞµÑÑ‚Ğ²ÑƒĞ²Ğ°)
- ğŸ“– [DEV_GUIDE_BG.md](./docs/DEV_GUIDE_BG.md) - Ğ ÑŠĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ¾ Ğ·Ğ° Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ñ†Ğ¸

### Ğ”Ğ¾Ğ¿ÑŠĞ»Ğ½Ğ¸Ñ‚ĞµĞ»Ğ½Ğ° Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ
- ğŸ“Š [ANALYTICS_FORMULAS_BG.md](./docs/ANALYTICS_FORMULAS_BG.md) - Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ¸ Ğ·Ğ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°
- ğŸ¤– [AI_PLAN_MODIFICATION_BG.md](./docs/AI_PLAN_MODIFICATION_BG.md) - AI Ğ¿Ğ»Ğ°Ğ½ Ğ¿Ñ€Ğ¾Ğ¼ĞµĞ½Ğ¸
- ğŸ“‹ [QUESTIONNAIRE_ANALYSIS_CORRELATION.md](./docs/QUESTIONNAIRE_ANALYSIS_CORRELATION.md) - ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ½Ğ° Ğ²ÑŠĞ¿Ñ€Ğ¾ÑĞ½Ğ¸Ğº
- âš¡ [OPTIMIZATIONS.md](./docs/OPTIMIZATIONS.md) - ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

---

**ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ° Ğ°ĞºÑ‚ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:** 2024-12-08  
**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.0.0
