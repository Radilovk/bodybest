# –ê–Ω–∞–ª–∏–∑ –Ω–∞ –±–µ–∫–µ–Ω–¥ –æ–ø–µ—Ä–∞—Ü–∏–∏—Ç–µ –∏ –ø–ª–∞–Ω –∑–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —á—Ä–µ–∑ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

**–î–∞—Ç–∞ –Ω–∞ —Å—ä–∑–¥–∞–≤–∞–Ω–µ:** 18.11.2025  
**–ü—Ä–æ–µ–∫—Ç:** BodyBest - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–Ω –ø–ª–∞–Ω –∏ —Ñ–∏—Ç–Ω–µ—Å –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ

## –û–±–æ–±—â–µ–Ω–∏–µ

–¢–æ–∑–∏ –¥–æ–∫—É–º–µ–Ω—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–∞ –≤—Å–∏—á–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏, —Å–≤—ä—Ä–∑–∞–Ω–∏ —Å –±–µ–∫–µ–Ω–¥–∞ –Ω–∞ –ø—Ä–æ–µ–∫—Ç–∞ BodyBest, –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–∞ –∫–æ–∏ –æ—Ç —Ç—è—Ö –º–æ–≥–∞—Ç –¥–∞ –±—ä–¥–∞—Ç –∏–∑–≤–µ–¥–µ–Ω–∏ –ª–æ–∫–∞–ª–Ω–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞, –∑–∞ –¥–∞ —Å–µ –Ω–∞–º–∞–ª–∏ –Ω–∞—Ç–æ–≤–∞—Ä–≤–∞–Ω–µ—Ç–æ –Ω–∞ —Å—ä—Ä–≤—ä—Ä–∞ –∏ –¥–∞ —Å–µ –ø–æ–¥–æ–±—Ä–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–æ—Ç–æ –∏–∑–∂–∏–≤—è–≤–∞–Ω–µ.

## 1. –¢–µ–∫—É—â–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1.1 –ë–µ–∫–µ–Ω–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
- **Cloudflare Worker** (`worker.js`) - –û—Å–Ω–æ–≤–µ–Ω API —Å—ä—Ä–≤—ä—Ä
- **Cloudflare KV Storage** - –°—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ –¥–∞–Ω–Ω–∏ –∏ —Ä–µ—Å—É—Ä—Å–∏
- **PHP Backend** - Email –∏–∑–ø—Ä–∞—â–∞–Ω–µ –∏ —Ñ–∞–π–ª–æ–≤–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
- **AI Services** - Cloudflare AI, OpenAI, Gemini, Cohere –º–æ–¥–µ–ª–∏

### 1.2 Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
- **Vite Dev Server** - –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- **Static HTML/CSS/JS** - –ö–ª–∏–µ–Ω—Ç—Å–∫–∞ —á–∞—Å—Ç
- **localStorage/sessionStorage** - –õ–æ–∫–∞–ª–Ω–æ —Å—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ
- **IndexedDB** - –ù–µ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –ø–æ–Ω–∞—Å—Ç–æ—è—â–µ–º

## 2. –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ –±–µ–∫–µ–Ω–¥ –æ–ø–µ—Ä–∞—Ü–∏–∏—Ç–µ

### 2.1 –ê—É—Ç–µ–Ω—Ç–∏–∫–∞—Ü–∏—è –∏ –ø—Ä–æ—Ñ–∏–ª–∏ (üî¥ –ù–µ–æ–±—Ö–æ–¥–∏–º –±–µ–∫–µ–Ω–¥)

| –û–ø–µ—Ä–∞—Ü–∏—è | –ï–Ω–¥–ø–æ–π–Ω—Ç | –ü—Ä–∏—á–∏–Ω–∞ –∑–∞ –±–µ–∫–µ–Ω–¥ | –í—ä–∑–º–æ–∂–Ω–æ—Å—Ç –∑–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è |
|----------|----------|-------------------|---------------------------|
| –í—Ö–æ–¥ | `/api/login` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ credentials | ‚ùå –ù–µ –º–æ–∂–µ –ª–æ–∫–∞–ª–Ω–æ (—Å–∏–≥—É—Ä–Ω–æ—Å—Ç) |
| –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è | `/api/register` | –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –∞–∫–∞—É–Ω—Ç | ‚ùå –ù–µ –º–æ–∂–µ –ª–æ–∫–∞–ª–Ω–æ |
| –°–º—è–Ω–∞ –Ω–∞ –ø–∞—Ä–æ–ª–∞ | `/api/requestPasswordReset` | –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –∏–º–µ–π–ª | ‚ùå –ù–µ –º–æ–∂–µ –ª–æ–∫–∞–ª–Ω–æ |
| –ò–∑–≤–ª–∏—á–∞–Ω–µ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª | `/api/getProfile` | –ß–µ—Ç–µ–Ω–µ –æ—Ç KV | üü° –ß–∞—Å—Ç–∏—á–Ω–æ - –∫–µ—à–∏—Ä–∞–Ω–µ |
| –û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª | `/api/updateProfile` | –ó–∞–ø–∏—Å–≤–∞–Ω–µ –≤ KV | üü° –ß–∞—Å—Ç–∏—á–Ω–æ - offline sync |

**–ü—Ä–µ–ø–æ—Ä—ä–∫–∞:** –ò–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –∞–≥—Ä–µ—Å–∏–≤–Ω–æ –∫–µ—à–∏—Ä–∞–Ω–µ —Å localStorage –∏ offline-first –ø–æ–¥—Ö–æ–¥ —Å –ø–µ—Ä–∏–æ–¥–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è.

### 2.2 –•—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏ –¥–∞–Ω–Ω–∏ –∏ –º–∞–∫—Ä–æ—Å–∏ (üü¢ –ú–æ–∂–µ –ª–æ–∫–∞–ª–Ω–æ)

| –û–ø–µ—Ä–∞—Ü–∏—è | –¢–µ–∫—É—â–æ —Ä–µ—à–µ–Ω–∏–µ | –õ–æ–∫–∞–ª–Ω–æ —Ä–µ—à–µ–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|----------|----------------|-----------------|-----------|
| –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –¥–∏–µ—Ç–µ–Ω –º–æ–¥–µ–ª | KV —á–µ—Ç–µ–Ω–µ | Static JSON import | ‚úÖ –í–ò–°–û–ö |
| Product macros | KV —á–µ—Ç–µ–Ω–µ | Static JSON import | ‚úÖ –í–ò–°–û–ö |
| –ò–∑—á–∏—Å–ª–µ–Ω–∏–µ –Ω–∞ –º–∞–∫—Ä–æ—Å–∏ | Client-side | Client-side | ‚úÖ –í–µ—á–µ –ª–æ–∫–∞–ª–Ω–æ |
| –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–µ | Client-side | Client-side | ‚úÖ –í–µ—á–µ –ª–æ–∫–∞–ª–Ω–æ |
| Recipe data | KV —á–µ—Ç–µ–Ω–µ | Static JSON import | ‚úÖ –í–ò–°–û–ö |

**–ê–Ω–∞–ª–∏–∑:** 
- `base_diet_model.json` (–¥–∏–µ—Ç–µ–Ω –º–æ–¥–µ–ª) - üü¢ **100% –ª–æ–∫–∞–ª–Ω–æ**
- `product_macros.json` (—Ö—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏ —Å—Ç–æ–π–Ω–æ—Å—Ç–∏) - üü¢ **100% –ª–æ–∫–∞–ª–Ω–æ**
- `recipe_data.json` (—Ä–µ—Ü–µ–ø—Ç–∏) - üü¢ **100% –ª–æ–∫–∞–ª–Ω–æ**
- `nutrient_overrides.json` - üü¢ **100% –ª–æ–∫–∞–ª–Ω–æ**

–¢–µ–∑–∏ —Ñ–∞–π–ª–æ–≤–µ **–≤–µ—á–µ —Å–∞ –Ω–∞–ª–∏—á–Ω–∏** –≤ `/kv/DIET_RESOURCES/` –∏ —Å–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–∞—Ç –¥–∏—Ä–µ–∫—Ç–Ω–æ –≤ `macroUtils.js`:
```javascript
import dietModel from '../kv/DIET_RESOURCES/base_diet_model.json' with { type: 'json' };
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–µ—á–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–∞–Ω–æ - –¥–∞–Ω–Ω–∏—Ç–µ —Å–µ –∑–∞—Ä–µ–∂–¥–∞—Ç —Å—Ç–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ build time.

### 2.3 –õ–æ–≥–≤–∞–Ω–µ –Ω–∞ –¥–∞–Ω–Ω–∏ (üü° –•–∏–±—Ä–∏–¥–µ–Ω –ø–æ–¥—Ö–æ–¥)

| –û–ø–µ—Ä–∞—Ü–∏—è | –ï–Ω–¥–ø–æ–π–Ω—Ç | –¢–µ–∫—É—â–æ | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è |
|----------|----------|--------|-------------|
| Daily log | `/api/log` | –ù–µ–∑–∞–±–∞–≤–Ω–æ –∑–∞–ø–∏—Å–≤–∞–Ω–µ | üü¢ localStorage + batch sync |
| Extra meal log | `/api/log-extra-meal` | –ù–µ–∑–∞–±–∞–≤–Ω–æ –∑–∞–ø–∏—Å–≤–∞–Ω–µ | üü¢ localStorage + batch sync |
| Plan log | `/api/planLog` | –ù–µ–∑–∞–±–∞–≤–Ω–æ –∑–∞–ø–∏—Å–≤–∞–Ω–µ | üü¢ localStorage + batch sync |

**–ü—Ä–µ–ø–æ—Ä—ä–∫–∞:**
1. –ó–∞–ø–∏—Å–≤–∞–Ω–µ –ø—ä—Ä–≤–æ –≤ `localStorage` (–Ω–µ–∑–∞–±–∞–≤–Ω–æ, –±–µ–∑ –º—Ä–µ–∂–∞)
2. Background sync –∫—ä–º —Å—ä—Ä–≤—ä—Ä–∞ (batch –æ–ø–µ—Ä–∞—Ü–∏–∏)
3. Conflict resolution –ø—Ä–∏ —Ä–∞–∑–ª–∏—á–∏—è
4. Fallback –∫—ä–º online-only –ø—Ä–∏ –≥—Ä–µ—à–∫–∏

**–ò–∑—á–∏—Å–ª–µ–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- –ù–∞–º–∞–ª—è–≤–∞–Ω–µ –Ω–∞ API calls: ~70-80% (–ø—Ä–∏ –Ω–æ—Ä–º–∞–ª–Ω–∞ —É–ø–æ—Ç—Ä–µ–±–∞)
- –ü–æ-–¥–æ–±—ä—Ä UX: –º–∏–≥–Ω–æ–≤–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä –≤–º–µ—Å—Ç–æ 200-500ms –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç
- –†–∞–±–æ—Ç–∞ offline

### 2.4 AI –∞–Ω–∞–ª–∏–∑ (üî¥ –ù–µ–æ–±—Ö–æ–¥–∏–º –±–µ–∫–µ–Ω–¥ —Å –∏–∑–∫–ª—é—á–µ–Ω–∏—è)

| –û–ø–µ—Ä–∞—Ü–∏—è | –ï–Ω–¥–ø–æ–π–Ω—Ç | AI –ú–æ–¥–µ–ª | –õ–æ–∫–∞–ª–Ω–∞ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç |
|----------|----------|----------|-------------------|
| Questionnaire analysis | `/api/submitQuestionnaire` | Cloudflare AI | ‚ùå –ò–∑–∏—Å–∫–≤–∞ AI API |
| Image analysis | `/api/analyzeImage` | Cloudflare AI / Gemini | üü° Client-side ML –º–æ–¥–µ–ª |
| Chat assistant | `/api/chat` | Multiple providers | ‚ùå –ò–∑–∏—Å–∫–≤–∞ AI API |
| Plan generation | Background cron | Cloudflare AI | ‚ùå –ò–∑–∏—Å–∫–≤–∞ AI API |
| Praise generation | `/api/generatePraise` | Cloudflare AI | üü° Template-based –ª–æ–∫–∞–ª–Ω–æ |

**–õ–æ–∫–∞–ª–Ω–∏ –∞–ª—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏ –∑–∞ –∏–∑–±—Ä–∞–Ω–∏ AI –æ–ø–µ—Ä–∞—Ü–∏–∏:**

1. **Image analysis** (üü° –ß–∞—Å—Ç–∏—á–Ω–æ –ª–æ–∫–∞–ª–Ω–æ)
   - –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ TensorFlow.js –∏–ª–∏ ONNX Runtime
   - –ú–æ–¥–µ–ª–∏ –∫–∞—Ç–æ MobileNet –∑–∞ –±–∞–∑–æ–≤ –∞–Ω–∞–ª–∏–∑ –Ω–∞ —Ö—Ä–∞–Ω–∞
   - Fallback –∫—ä–º –±–µ–∫–µ–Ω–¥ –∑–∞ —Å–ª–æ–∂–µ–Ω –∞–Ω–∞–ª–∏–∑
   - **–ü—Ä–æ–≥–Ω–æ–∑–∞:** 60-70% –æ—Ç —Å–ª—É—á–∞–∏—Ç–µ –ª–æ–∫–∞–ª–Ω–æ

2. **Praise generation** (üü¢ –ù–∞–ø—ä–ª–Ω–æ –ª–æ–∫–∞–ª–Ω–æ)
   - Template-based —Å–∏—Å—Ç–µ–º–∞ —Å randomization
   - –ü—Ä–∞–≤–∏–ª–∞ –±–∞–∑–∏—Ä–∞–Ω–∏ –Ω–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫
   - –ë–µ–∑ –Ω—É–∂–¥–∞ –æ—Ç AI –º–æ–¥–µ–ª
   - **–ü—Ä–æ–≥–Ω–æ–∑–∞:** 100% –ª–æ–∫–∞–ª–Ω–æ

3. **Simple chat responses** (üü° –ß–∞—Å—Ç–∏—á–Ω–æ –ª–æ–∫–∞–ª–Ω–æ)
   - FAQ —Å–∏—Å—Ç–µ–º–∞ —Å keyword matching
   - –ß–µ—Å—Ç–æ –∑–∞–¥–∞–≤–∞–Ω–∏ –≤—ä–ø—Ä–æ—Å–∏
   - Fallback –∫—ä–º AI –∑–∞ —Å–ª–æ–∂–Ω–∏ –≤—ä–ø—Ä–æ—Å–∏
   - **–ü—Ä–æ–≥–Ω–æ–∑–∞:** 30-40% –æ—Ç –≤—ä–ø—Ä–æ—Å–∏—Ç–µ –ª–æ–∫–∞–ª–Ω–æ

### 2.5 –°—Ç–∞—Ç–∏—á–Ω–∏ —Ä–µ—Å—É—Ä—Å–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (üü¢ –ú–æ–∂–µ –ª–æ–∫–∞–ª–Ω–æ)

| –†–µ—Å—É—Ä—Å | –¢–µ–∫—É—â–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|--------|----------------------|-------------|---------|
| Question definitions | KV: `question_definitions` | Static JSON | ‚úÖ –í–µ—á–µ –ª–æ–∫–∞–ª–Ω–æ –≤ `kv/DIET_RESOURCES/` |
| Prompts (AI) | KV: `prompt_*` | Static files | ‚úÖ –í–µ—á–µ –ª–æ–∫–∞–ª–Ω–æ –≤ `kv/DIET_RESOURCES/` |
| Email templates | KV | Static HTML | üü¢ –ú–æ–∂–µ –ª–æ–∫–∞–ª–Ω–æ |
| Eating psychology | KV: `eating_psychology` | Static text | ‚úÖ –í–µ—á–µ –ª–æ–∫–∞–ª–Ω–æ |
| Meal combinations | KV: `allowed_meal_combinations` | Static config | ‚úÖ –í–µ—á–µ –ª–æ–∫–∞–ª–Ω–æ |
| Localization | `locales/` | Static JSON | ‚úÖ –í–µ—á–µ –ª–æ–∫–∞–ª–Ω–æ |

**–°—Ç–∞—Ç—É—Å:** –ü–æ–≤–µ—á–µ—Ç–æ —Å—Ç–∞—Ç–∏—á–Ω–∏ —Ä–µ—Å—É—Ä—Å–∏ **–≤–µ—á–µ —Å–∞ –ª–æ–∫–∞–ª–∏–∑–∏—Ä–∞–Ω–∏** –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏—Ç–µ:
- `/kv/DIET_RESOURCES/` - –¥–∏–µ—Ç–Ω–∏ –¥–∞–Ω–Ω–∏, prompts, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `/locales/` - –ø—Ä–µ–≤–æ–¥–∏
- `/data/` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∏ —Ç–µ–∫—Å—Ç–æ–≤–µ –∏ —à–∞–±–ª–æ–Ω–∏

### 2.6 Caching –∏ Request Optimization (üü¢ –ß–∞—Å—Ç–∏—á–Ω–æ –≤–Ω–µ–¥—Ä–µ–Ω–æ)

**–¢–µ–∫—É—â–æ –≤–Ω–µ–¥—Ä—è–≤–∞–Ω–µ:**
- `requestCache.js` - Request deduplication –∏ TTL caching
- TTL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: 5 –º–∏–Ω—É—Ç–∏ –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ
- Memory-based –∫–µ—à

**–ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ –∫–µ—à–∏—Ä–∞–Ω–µ:**
```javascript
// –ù–∞–ª–∏—á–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ —Å cachedFetch:
- js/admin.js
- js/app.js
- js/clientProfile.js
- js/editClient.js
- js/macroAnalyticsCardComponent.js
- js/profileEdit.js
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
1. ‚úÖ –í–µ—á–µ –≤–Ω–µ–¥—Ä–µ–Ω–æ - request deduplication
2. ‚úÖ –í–µ—á–µ –≤–Ω–µ–¥—Ä–µ–Ω–æ - TTL –∫–µ—à–∏—Ä–∞–Ω–µ
3. üü° –ú–æ–∂–µ –¥–∞ —Å–µ –ø–æ–¥–æ–±—Ä–∏ - localStorage persistence
4. üü° –ú–æ–∂–µ –¥–∞ —Å–µ –ø–æ–¥–æ–±—Ä–∏ - Service Worker –∑–∞ offline

### 2.7 –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ (üî¥ –ù–µ–æ–±—Ö–æ–¥–∏–º –±–µ–∫–µ–Ω–¥)

| –û–ø–µ—Ä–∞—Ü–∏—è | –ï–Ω–¥–ø–æ–π–Ω—Ç | –õ–æ–∫–∞–ª–Ω–∞ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç |
|----------|----------|--------------------|
| List clients | `/api/listClients` | ‚ùå –ò–∑–∏—Å–∫–≤–∞ KV |
| Delete client | `/api/deleteClient` | ‚ùå –ò–∑–∏—Å–∫–≤–∞ KV |
| Update KV | `/api/updateKv` | ‚ùå –ò–∑–∏—Å–∫–≤–∞ KV |
| Admin queries | `/api/getAdminQueries` | ‚ùå –ò–∑–∏—Å–∫–≤–∞ KV |
| AI config | `/api/setAiConfig` | ‚ùå –ò–∑–∏—Å–∫–≤–∞ KV |
| Send email | `/api/sendTestEmail` | ‚ùå –ò–∑–∏—Å–∫–≤–∞ SMTP |

**–ü—Ä–µ–ø–æ—Ä—ä–∫–∞:** –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ—Å—Ç–∞–≤–∞—Ç –Ω–∞ –±–µ–∫–µ–Ω–¥ –∑–∞—Ä–∞–¥–∏ —Å–∏–≥—É—Ä–Ω–æ—Å—Ç –∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∏—Ä–∞–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ.

## 3. –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–∞–Ω –ø–ª–∞–Ω –∑–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –§–∞–∑–∞ 1: –í–∏—Å–æ–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∏ (–õ–µ—Å–Ω–∏ –ø–æ–±–µ–¥–∏) ‚úÖ –í–ï–ß–ï –ì–û–¢–û–í–û

**–°—Ç–∞—Ç—É—Å:** –¢–µ–∑–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤–µ—á–µ —Å–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏ –≤ –ø—Ä–æ–µ–∫—Ç–∞!

1. ‚úÖ **–°—Ç–∞—Ç–∏—á–Ω–∏ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏ –¥–∞–Ω–Ω–∏** 
   - base_diet_model.json
   - product_macros.json
   - recipe_data.json
   - **–†–µ–∑—É–ª—Ç–∞—Ç:** –ü—Ä–µ–º–∞—Ö–Ω–∞—Ç–∏ ~100% –æ—Ç KV —á–µ—Ç–µ–Ω–∏—è—Ç–∞ –∑–∞ —Ç–µ–∑–∏ —Ä–µ—Å—É—Ä—Å–∏

2. ‚úÖ **–°—Ç–∞—Ç–∏—á–Ω–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
   - question_definitions.json
   - eating_psychology.txt
   - allowed_meal_combinations.txt
   - AI prompts (prompt_*.txt)
   - **–†–µ–∑—É–ª—Ç–∞—Ç:** –ü—Ä–µ–º–∞—Ö–Ω–∞—Ç–∏ ~100% –æ—Ç KV —á–µ—Ç–µ–Ω–∏—è—Ç–∞ –∑–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

3. ‚úÖ **Request caching** (requestCache.js)
   - Deduplication –Ω–∞ –ø–∞—Ä–∞–ª–µ–ª–Ω–∏ –∑–∞—è–≤–∫–∏
   - TTL-based memory cache
   - **–†–µ–∑—É–ª—Ç–∞—Ç:** ~40-60% –Ω–∞–º–∞–ª–µ–Ω–∏–µ –Ω–∞ –¥—É–±–ª–∏—Ä–∞–Ω–∏ –∑–∞—è–≤–∫–∏

### –§–∞–∑–∞ 2: –°—Ä–µ–¥–µ–Ω –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (Offline-first –¥–∞–Ω–Ω–∏)

**–¶–µ–ª–µ–≤–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** 70-80% –Ω–∞–º–∞–ª–µ–Ω–∏–µ –Ω–∞ API calls –∑–∞ –¥–∞–Ω–Ω–∏

1. **localStorage —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞ –ª–æ–≥–æ–≤–µ** (üî¥ –ù–ï –ï –í–ù–ï–î–†–ï–ù–û)
   ```javascript
   // –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
   const logStorage = {
     pending: [],      // –ù–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–∞–Ω–∏ –∑–∞–ø–∏—Å–∏
     synced: {},       // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–∞–Ω–∏ –∑–∞–ø–∏—Å–∏ (–∫–µ—à)
     lastSync: null    // –ü–æ—Å–ª–µ–¥–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
   };
   ```
   
   **–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:**
   - –ó–∞–ø–∏—Å–≤–∞–Ω–µ –≤ localStorage –ø—Ä–∏ `log()`, `log-extra-meal()`
   - Background sync –Ω–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª (–Ω–∞–ø—Ä. 30 —Å–µ–∫ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç)
   - Batch –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–º–µ—Å—Ç–æ –æ—Ç–¥–µ–ª–Ω–∏ requests
   - Conflict resolution —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
   
   **–û—á–∞–∫–≤–∞–Ω –µ—Ñ–µ–∫—Ç:**
   - API calls –∑–∞ –ª–æ–≥–æ–≤–µ: -70%
   - –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç –ø—Ä–∏ –ª–æ–≥–≤–∞–Ω–µ: -95% (–º–∏–≥–Ω–æ–≤–µ–Ω–æ)
   - –†–∞–±–æ—Ç–∞ –≤ offline —Ä–µ–∂–∏–º

2. **localStorage –∫–µ—à –∑–∞ dashboard –¥–∞–Ω–Ω–∏** (üî¥ –ù–ï –ï –í–ù–ï–î–†–ï–ù–û)
   ```javascript
   // –ö–µ—à–∏—Ä–∞–Ω–µ –Ω–∞ dashboard —Å smart invalidation:
   - –ö–µ—à –Ω–∞ —Ü—è–ª dashboard response
   - Invalidation –ø—Ä–∏ log/update –æ–ø–µ—Ä–∞—Ü–∏–∏
   - TTL: 5-10 –º–∏–Ω—É—Ç–∏
   - Background refresh –±–µ–∑ blocking UI
   ```
   
   **–û—á–∞–∫–≤–∞–Ω –µ—Ñ–µ–∫—Ç:**
   - Dashboard load time: -80%
   - API calls –∑–∞ dashboard: -60%

3. **localStorage –∫–µ—à –∑–∞ profile –¥–∞–Ω–Ω–∏** (üü° –ß–ê–°–¢–ò–ß–ù–û –í–ù–ï–î–†–ï–ù–û)
   - –¢–µ–∫—É—â–æ: sessionStorage –∑–∞ userId
   - –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: –ø—ä–ª–µ–Ω profile –∫–µ—à –≤ localStorage
   
   **–û—á–∞–∫–≤–∞–Ω –µ—Ñ–µ–∫—Ç:**
   - Profile load time: -90%
   - API calls –∑–∞ profile: -70%

### –§–∞–∑–∞ 3: –ù–∏—Å—ä–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–ï–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏)

1. **Client-side Image Analysis** (üî¥ –ù–ï –ï –í–ù–ï–î–†–ï–ù–û)
   - TensorFlow.js —Å Food-101 –º–æ–¥–µ–ª
   - Fallback –∫—ä–º Cloudflare AI –∑–∞ —Å–ª–æ–∂–Ω–∏ —Å–ª—É—á–∞–∏
   - **Estimation:** 3-4 —Å–µ–¥–º–∏—Ü–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
   - **–ï—Ñ–µ–∫—Ç:** 50-60% –æ—Ç image analysis –ª–æ–∫–∞–ª–Ω–æ

2. **Template-based Praise Generation** (üî¥ –ù–ï –ï –í–ù–ï–î–†–ï–ù–û)
   - –ü—Ä–∞–≤–∏–ª–æ-–±–∞–∑–∏—Ä–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞
   - Randomization –Ω–∞ templates
   - **Estimation:** 1 —Å–µ–¥–º–∏—Ü–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
   - **–ï—Ñ–µ–∫—Ç:** 100% –ª–æ–∫–∞–ª–Ω–æ

3. **FAQ Chat System** (üî¥ –ù–ï –ï –í–ù–ï–î–†–ï–ù–û)
   - Keyword matching –∑–∞ —á–µ—Å—Ç–∏ –≤—ä–ø—Ä–æ—Å–∏
   - Fallback –∫—ä–º AI chat
   - **Estimation:** 2 —Å–µ–¥–º–∏—Ü–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
   - **–ï—Ñ–µ–∫—Ç:** 30-40% –æ—Ç chat queries –ª–æ–∫–∞–ª–Ω–æ

4. **Service Worker –∑–∞ offline** (üî¥ –ù–ï –ï –í–ù–ï–î–†–ï–ù–û)
   - –ö–µ—à–∏—Ä–∞–Ω–µ –Ω–∞ static assets
   - Background sync –∑–∞ API calls
   - Offline fallback UI
   - **Estimation:** 2-3 —Å–µ–¥–º–∏—Ü–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
   - **–ï—Ñ–µ–∫—Ç:** –ü—ä–ª–Ω–∞ offline —Ä–∞–±–æ—Ç–∞ –∑–∞ –±–∞–∑–æ–≤–∏ —Ñ—É–Ω–∫—Ü–∏–∏

## 4. –ü—Ä–µ–ø–æ—Ä—ä–∫–∏ –∑–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è

### 4.1 –í–∏—Å–æ–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∏ (–§–∞–∑–∞ 2)

#### A. Offline-first Log Storage

**–§–∞–π–ª–æ–≤–µ –∑–∞ –ø—Ä–æ–º—è–Ω–∞:**
- `js/app.js` - –ª–æ–≥–∏–∫–∞ –∑–∞ log/log-extra-meal
- `js/extraMealForm.js` - —Ñ–æ—Ä–º–∞ –∑–∞ –∏–∑–≤—ä–Ω—Ä–µ–¥–Ω–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è
- –ù–æ–≤ —Ñ–∞–π–ª: `js/offlineLogSync.js` - sync –ª–æ–≥–∏–∫–∞

**–ü—Å–µ–≤–¥–æ–∫–æ–¥:**
```javascript
// js/offlineLogSync.js
export class OfflineLogSync {
  constructor() {
    this.storageKey = 'bodybest_pending_logs';
    this.syncInterval = 30000; // 30 —Å–µ–∫—É–Ω–¥–∏
    this.maxBatchSize = 50;
  }

  async addLog(logData) {
    // 1. –ó–∞–ø–∞–∑–∏ –≤ localStorage
    const pending = this.getPendingLogs();
    pending.push({ ...logData, timestamp: Date.now(), id: generateId() });
    localStorage.setItem(this.storageKey, JSON.stringify(pending));
    
    // 2. –û–ø–∏—Ç–∞–π –Ω–µ–∑–∞–±–∞–≤–µ–Ω sync –∞–∫–æ online
    if (navigator.onLine) {
      await this.syncPendingLogs();
    }
    
    return true; // –ú–∏–≥–Ω–æ–≤–µ–Ω —É—Å–ø–µ—Ö –∑–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è
  }

  async syncPendingLogs() {
    const pending = this.getPendingLogs();
    if (pending.length === 0) return;
    
    // Batch sync –≤ –≥—Ä—É–ø–∏
    const batches = chunk(pending, this.maxBatchSize);
    
    for (const batch of batches) {
      try {
        const response = await fetch('/api/batch-log', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ logs: batch })
        });
        
        if (response.ok) {
          // –ü—Ä–µ–º–∞—Ö–Ω–∏ —É—Å–ø–µ—à–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–∞–Ω–∏—Ç–µ
          this.removeSyncedLogs(batch.map(l => l.id));
        }
      } catch (error) {
        console.warn('Sync failed, will retry:', error);
        break; // –°–ø—Ä–∏ –ø—Ä–∏ –≥—Ä–µ—à–∫–∞, –æ–ø–∏—Ç–∞–π –ø–æ-–∫—ä—Å–Ω–æ
      }
    }
  }

  getPendingLogs() {
    try {
      return JSON.parse(localStorage.getItem(this.storageKey) || '[]');
    } catch {
      return [];
    }
  }

  removeSyncedLogs(ids) {
    const pending = this.getPendingLogs();
    const filtered = pending.filter(log => !ids.includes(log.id));
    localStorage.setItem(this.storageKey, JSON.stringify(filtered));
  }

  startAutoSync() {
    this.syncTimer = setInterval(() => {
      if (navigator.onLine) {
        this.syncPendingLogs();
      }
    }, this.syncInterval);
  }

  stopAutoSync() {
    if (this.syncTimer) {
      clearInterval(this.syncTimer);
    }
  }
}
```

**Backend –ø—Ä–æ–º–µ–Ω–∏:**
```javascript
// worker.js - –Ω–æ–≤ –µ–Ω–¥–ø–æ–π–Ω—Ç
async function handleBatchLog(request, env) {
  const { logs } = await request.json();
  const userId = /* extract from auth */;
  
  // –û–±—Ä–∞–±–æ—Ç–∏ –≤—Å–∏—á–∫–∏ –ª–æ–≥–æ–≤–µ –≤ batch
  for (const log of logs) {
    await storeLog(userId, log, env);
  }
  
  return new Response(JSON.stringify({ success: true, count: logs.length }));
}
```

**–ü–æ–ª–∑–∏:**
- ‚úÖ –ú–∏–≥–Ω–æ–≤–µ–Ω UX –ø—Ä–∏ –ª–æ–≥–≤–∞–Ω–µ
- ‚úÖ –†–∞–±–æ—Ç–∞ –≤ offline —Ä–µ–∂–∏–º
- ‚úÖ 70-80% –ø–æ-–º–∞–ª–∫–æ API calls
- ‚úÖ –ü–æ-–º–∞–ª–∫–æ –≥—Ä–µ—à–∫–∏ –æ—Ç –º—Ä–µ–∂–æ–≤–∏ –ø—Ä–æ–±–ª–µ–º–∏

#### B. Dashboard Data Caching

**–§–∞–π–ª–æ–≤–µ –∑–∞ –ø—Ä–æ–º—è–Ω–∞:**
- `js/app.js` - dashboard loading –ª–æ–≥–∏–∫–∞
- `js/requestCache.js` - extend —Å localStorage persistence

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:**
```javascript
// js/requestCache.js - –¥–æ–±–∞–≤–∏ persistence
export class PersistentCache {
  constructor(storageKey = 'bodybest_cache') {
    this.storageKey = storageKey;
    this.memoryCache = new Map();
    this.loadFromStorage();
  }

  loadFromStorage() {
    try {
      const stored = localStorage.getItem(this.storageKey);
      if (stored) {
        const data = JSON.parse(stored);
        // –ó–∞—Ä–µ–¥–∏ —Å–∞–º–æ –Ω–µ-–∏–∑—Ç–µ–∫–ª–∏ –∑–∞–ø–∏—Å–∏
        Object.entries(data).forEach(([key, value]) => {
          if (value.expiry > Date.now()) {
            this.memoryCache.set(key, value);
          }
        });
      }
    } catch (error) {
      console.warn('Failed to load cache from storage:', error);
    }
  }

  saveToStorage() {
    try {
      const data = Object.fromEntries(this.memoryCache);
      localStorage.setItem(this.storageKey, JSON.stringify(data));
    } catch (error) {
      console.warn('Failed to save cache to storage:', error);
    }
  }

  set(key, value, ttl = 300000) { // 5 –º–∏–Ω—É—Ç–∏ TTL
    this.memoryCache.set(key, {
      value,
      expiry: Date.now() + ttl
    });
    this.saveToStorage();
  }

  get(key) {
    const cached = this.memoryCache.get(key);
    if (!cached) return null;
    
    if (cached.expiry < Date.now()) {
      this.memoryCache.delete(key);
      this.saveToStorage();
      return null;
    }
    
    return cached.value;
  }

  invalidate(pattern) {
    // Invalidate keys matching pattern
    for (const key of this.memoryCache.keys()) {
      if (key.includes(pattern)) {
        this.memoryCache.delete(key);
      }
    }
    this.saveToStorage();
  }

  clear() {
    this.memoryCache.clear();
    localStorage.removeItem(this.storageKey);
  }
}
```

**–ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ:**
```javascript
// js/app.js
import { PersistentCache } from './requestCache.js';

const dashboardCache = new PersistentCache('bodybest_dashboard_cache');

async function loadDashboard(userId, forceRefresh = false) {
  const cacheKey = `dashboard:${userId}`;
  
  // –û–ø–∏—Ç–∞–π –∫–µ—à –∞–∫–æ –Ω–µ –µ —Ñ–æ—Ä—Å–∏—Ä–∞–Ω refresh
  if (!forceRefresh) {
    const cached = dashboardCache.get(cacheKey);
    if (cached) {
      renderDashboard(cached);
      // Background refresh –∑–∞ —Å–≤–µ–∂–µ—Å—Ç
      refreshDashboardInBackground(userId);
      return cached;
    }
  }
  
  // Fetch –æ—Ç API
  const data = await fetch(`/api/dashboardData?userId=${userId}`).then(r => r.json());
  
  // –ö–µ—à–∏—Ä–∞–π –∑–∞ 5 –º–∏–Ω—É—Ç–∏
  dashboardCache.set(cacheKey, data, 300000);
  
  renderDashboard(data);
  return data;
}

async function refreshDashboardInBackground(userId) {
  try {
    const data = await fetch(`/api/dashboardData?userId=${userId}`).then(r => r.json());
    dashboardCache.set(`dashboard:${userId}`, data, 300000);
    // –û–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ: update UI –∞–∫–æ –∏–º–∞ –ø—Ä–æ–º–µ–Ω–∏
  } catch (error) {
    // –¢–∏—Ö refresh, –Ω–µ –ø–æ–∫–∞–∑–≤–∞–π –≥—Ä–µ—à–∫–∞
  }
}

// Invalidate –∫–µ—à–∞ –ø—Ä–∏ log –æ–ø–µ—Ä–∞—Ü–∏–∏
async function logMeal(mealData) {
  await offlineLogSync.addLog(mealData);
  dashboardCache.invalidate('dashboard:'); // Invalidate –≤—Å–∏—á–∫–∏ dashboard –∫–µ—à–æ–≤–µ
}
```

**–ü–æ–ª–∑–∏:**
- ‚úÖ Dashboard –∑–∞—Ä–µ–∂–¥–∞ –∑–∞ <100ms –æ—Ç –∫–µ—à
- ‚úÖ Background refresh –±–µ–∑ –∑–∞–±–∞–≤—è–Ω–µ –Ω–∞ UI
- ‚úÖ 60-70% –ø–æ-–º–∞–ª–∫–æ API calls
- ‚úÖ –ü–æ-–¥–æ–±—Ä–æ –∏–∑–∂–∏–≤—è–≤–∞–Ω–µ –ø—Ä–∏ –±–∞–≤–Ω–∞ –º—Ä–µ–∂–∞

### 4.2 –°—Ä–µ–¥–µ–Ω –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–§–∞–∑–∞ 3)

–¢–µ–∑–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–∞ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª–Ω–∏ –∏ –∏–∑–∏—Å–∫–≤–∞—Ç –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ R&D:

1. **Client-side ML –∑–∞ Image Analysis**
   - TensorFlow.js integration
   - Pre-trained –º–æ–¥–µ–ª–∏
   - Fallback –ª–æ–≥–∏–∫–∞

2. **Service Worker –∑–∞ offline**
   - Asset caching
   - Background sync API
   - Offline fallback pages

3. **Template-based Praise System**
   - Rule engine
   - Template —Å–∏—Å—Ç–µ–º–∞

## 5. –û—á–∞–∫–≤–∞–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏

### 5.1 –¢–µ–∫—É—â–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ (100% baseline)

| –ú–µ—Ç—Ä–∏–∫–∞ | –°—Ç–æ–π–Ω–æ—Å—Ç |
|---------|----------|
| API calls –∑–∞ dashboard load | 5-8 requests |
| API calls –∑–∞ log –æ–ø–µ—Ä–∞—Ü–∏—è | 1 request (–Ω–µ–∑–∞–±–∞–≤–µ–Ω) |
| API calls –∑–∞ —Å—Ç–∞—Ç–∏—á–Ω–∏ –¥–∞–Ω–Ω–∏ | 0 (–≤–µ—á–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–∞–Ω–æ ‚úÖ) |
| Dashboard load time | 500-1500ms |
| Log operation latency | 200-500ms |
| Offline capability | –ú–∏–Ω–∏–º–∞–ª–Ω–∞ |

### 5.2 –°–ª–µ–¥ –§–∞–∑–∞ 1 –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (‚úÖ –í–ï–ß–ï –ü–û–°–¢–ò–ì–ù–ê–¢–û)

| –ú–µ—Ç—Ä–∏–∫–∞ | –°—Ç–æ–π–Ω–æ—Å—Ç | –ü–æ–¥–æ–±—Ä–µ–Ω–∏–µ |
|---------|----------|------------|
| API calls –∑–∞ —Å—Ç–∞—Ç–∏—á–Ω–∏ –¥–∞–Ω–Ω–∏ | 0 | ‚úÖ -100% |
| Request deduplication | –ê–∫—Ç–∏–≤–µ–Ω | ‚úÖ -40-60% –¥—É–±–ª–∏–∫–∞—Ç–∏ |
| Static resource loading | Build-time | ‚úÖ –ú–∏–≥–Ω–æ–≤–µ–Ω–æ |

### 5.3 –°–ª–µ–¥ –§–∞–∑–∞ 2 –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–ü–õ–ê–ù–ò–†–ê–ù–û)

| –ú–µ—Ç—Ä–∏–∫–∞ | –ü—Ä–æ–≥–Ω–æ–∑–∞ | –ü–æ–¥–æ–±—Ä–µ–Ω–∏–µ |
|---------|----------|------------|
| API calls –∑–∞ dashboard | 2-3 requests | üéØ -40-50% |
| API calls –∑–∞ –ª–æ–≥–æ–≤–µ | 0.3 requests (batch) | üéØ -70% |
| Dashboard load time | 100-200ms | üéØ -80-90% |
| Log operation latency | <50ms | üéØ -90% |
| Offline capability | –ü—ä–ª–Ω–∞ –∑–∞ –ª–æ–≥–æ–≤–µ | üéØ +‚àû |

### 5.4 –°–ª–µ–¥ –§–∞–∑–∞ 3 –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–ï–ö–°–ü–ï–†–ò–ú–ï–ù–¢–ê–õ–ù–û)

| –ú–µ—Ç—Ä–∏–∫–∞ | –ü—Ä–æ–≥–Ω–æ–∑–∞ | –ü–æ–¥–æ–±—Ä–µ–Ω–∏–µ |
|---------|----------|------------|
| API calls –∑–∞ image analysis | -50-60% | üî¨ –õ–æ–∫–∞–ª–µ–Ω ML |
| Chat satisfaction rate | +30-40% | üî¨ FAQ —Å–∏—Å—Ç–µ–º–∞ |
| Offline functionality | –ü—ä–ª–Ω–∞ | üî¨ Service Worker |
| Praise generation cost | -100% | üî¨ Template-based |

## 6. –†–∏—Å–∫–æ–≤–µ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### 6.1 –†–∏—Å–∫–æ–≤–µ

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç | –í—ä–∑–¥–µ–π—Å—Ç–≤–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|------------|-------------|-----------|
| localStorage quota limit | –°—Ä–µ–¥–Ω–∞ | –°—Ä–µ–¥–µ–Ω | Cleanup —Å—Ç–∞—Ä–∏—Ç–µ –∑–∞–ø–∏—Å–∏, compression |
| Data synchronization –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∏ | –í–∏—Å–æ–∫–∞ | –í–∏—Å–æ–∫ | Conflict resolution —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, timestamps |
| Increased client-side complexity | –í–∏—Å–æ–∫–∞ | –°—Ä–µ–¥–µ–Ω | –î–æ–±—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, —Ç–µ—Å—Ç–æ–≤–µ |
| Browser compatibility | –ù–∏—Å–∫–∞ | –°—Ä–µ–¥–µ–Ω | Fallback –∫—ä–º online-only –∑–∞ —Å—Ç–∞—Ä–∏ browsers |

### 6.2 –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **localStorage Quota (5-10MB)**
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: Rotation –Ω–∞ —Å—Ç–∞—Ä–∏ –¥–∞–Ω–Ω–∏
   - Compression –Ω–∞ JSON –¥–∞–Ω–Ω–∏
   - Cleanup —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

2. **Sync –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∏**
   - Last-write-wins —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
   - Timestamp-based resolution
   - User prompt –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–Ω–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∏

3. **Security concerns**
   - –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª–Ω–∏ –¥–∞–Ω–Ω–∏ –Ω–µ —Å–µ –ø–∞–∑—è—Ç –ª–æ–∫–∞–ª–Ω–æ –±–µ–∑ encryption
   - Session tokens –æ—Å—Ç–∞–≤–∞—Ç –≤ sessionStorage
   - Passwords –Ω–∏–∫–æ–≥–∞ –ª–æ–∫–∞–ª–Ω–æ

4. **AI Operations**
   - –°–ª–æ–∂–Ω–∏ AI –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ—Å—Ç–∞–≤–∞—Ç –Ω–∞ –±–µ–∫–µ–Ω–¥
   - –õ–æ–∫–∞–ª–µ–Ω ML –µ —Å–∞–º–æ –∑–∞ –ø—Ä–æ—Å—Ç–∏ —Å–ª—É—á–∞–∏
   - Quality –º–æ–∂–µ –¥–∞ –µ –ø–æ-–Ω–∏—Å–∫–æ –ø—Ä–∏ –ª–æ–∫–∞–ª–µ–Ω ML

## 7. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ –∏ –ø—Ä–µ–ø–æ—Ä—ä–∫–∏

### 7.1 –¢–µ–∫—É—â–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ ‚úÖ

–ü—Ä–æ–µ–∫—Ç—ä—Ç **–≤–µ—á–µ –µ –∑–Ω–∞—á–∏—Ç–µ–ª–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–∞–Ω** –≤ —Å–ª–µ–¥–Ω–∏—Ç–µ –æ–±–ª–∞—Å—Ç–∏:

1. ‚úÖ **–°—Ç–∞—Ç–∏—á–Ω–∏ –¥–∞–Ω–Ω–∏** - 100% –ª–æ–∫–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ (base_diet_model, product_macros, prompts, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
2. ‚úÖ **Request caching** - –í–Ω–µ–¥—Ä–µ–Ω memory cache —Å TTL –∏ deduplication
3. ‚úÖ **Macros calculation** - 100% client-side –ª–æ–≥–∏–∫–∞

**–†–µ–∑—É–ª—Ç–∞—Ç:** –ü—Ä–æ–µ–∫—Ç—ä—Ç –≤–µ—á–µ –∏–∑–±—è–≥–≤–∞ –≥–æ–ª—è–º–∞ —á–∞—Å—Ç –æ—Ç –Ω–µ–Ω—É–∂–Ω–∏—Ç–µ KV —á–µ—Ç–µ–Ω–∏—è –∑–∞ —Å—Ç–∞—Ç–∏—á–Ω–∏ —Ä–µ—Å—É—Ä—Å–∏.

### 7.2 –°–ª–µ–¥–≤–∞—â–∏ —Å—Ç—ä–ø–∫–∏ (–§–∞–∑–∞ 2)

**–í–∏—Å–æ–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** –∑–∞ –≤–Ω–µ–¥—Ä—è–≤–∞–Ω–µ –≤ —Å–ª–µ–¥–≤–∞—â–∏—Ç–µ 2-4 —Å–µ–¥–º–∏—Ü–∏:

1. **Offline-first Log Storage** (–°–µ–¥–º–∏—Ü–∞ 1-2)
   - localStorage –∫–µ—à –∑–∞ –ª–æ–≥–æ–≤–µ
   - Background batch sync
   - Conflict resolution
   - **–û—á–∞–∫–≤–∞–Ω –µ—Ñ–µ–∫—Ç:** -70% API calls, –º–∏–≥–Ω–æ–≤–µ–Ω UX

2. **Dashboard & Profile Caching** (–°–µ–¥–º–∏—Ü–∞ 2-3)
   - localStorage persistence –Ω–∞ –∫–µ—à–∞
   - Smart invalidation
   - Background refresh
   - **–û—á–∞–∫–≤–∞–Ω –µ—Ñ–µ–∫—Ç:** -60% API calls, -80% load time

3. **Testing & Validation** (–°–µ–¥–º–∏—Ü–∞ 3-4)
   - Unit tests –∑–∞ sync –ª–æ–≥–∏–∫–∞
   - Integration tests
   - Performance benchmarks
   - Stress testing –Ω–∞ sync

### 7.3 –î—ä–ª–≥–æ—Å—Ä–æ—á–Ω–∞ –≤–∏–∑–∏—è (–§–∞–∑–∞ 3)

–ï–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞ –±—ä–¥–µ—â–æ —Ä–∞–∑–≥–ª–µ–∂–¥–∞–Ω–µ (3-6+ –º–µ—Å–µ—Ü–∞):

1. **Client-side ML** - TensorFlow.js –∑–∞ image analysis
2. **Service Worker** - –ü—ä–ª–Ω–∞ offline —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç
3. **Template-based AI** - –õ–æ–∫–∞–ª–Ω–∏ –∞–ª—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏ –∑–∞ –ø—Ä–æ—Å—Ç–∏ AI –æ–ø–µ—Ä–∞—Ü–∏–∏

### 7.4 –ë–∏–∑–Ω–µ—Å –∏–º–ø–∞–∫—Ç

**–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–∏ –ø–æ–ª–∑–∏ (—Å–ª–µ–¥ –§–∞–∑–∞ 2):**
- üìâ -60-70% –Ω–∞–º–∞–ª–µ–Ω–∏–µ –Ω–∞ API calls
- ‚ö° -80% –ø–æ–¥–æ–±—Ä–µ–Ω–∏–µ –Ω–∞ response time
- üì± Offline —Ä–∞–±–æ—Ç–∞ –∑–∞ –æ—Å–Ω–æ–≤–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏
- üí∞ –ü–æ-–Ω–∏—Å–∫–∏ Cloudflare Worker —Ä–∞–∑—Ö–æ–¥–∏
- üòä –ü–æ-–¥–æ–±—Ä–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–æ –∏–∑–∂–∏–≤—è–≤–∞–Ω–µ

**–î—ä–ª–≥–æ—Å—Ä–æ—á–Ω–∏ –ø–æ–ª–∑–∏ (—Å–ª–µ–¥ –§–∞–∑–∞ 3):**
- üåç –ü—ä–ª–Ω–∞ offline —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç
- ü§ñ –ù–∞–º–∞–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç –æ—Ç –≤—ä–Ω—à–Ω–∏ AI services
- üí™ –ü–æ-—É—Å—Ç–æ–π—á–∏–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- üöÄ –ü–æ-–±—ä—Ä–∑–∞ –∏ responsive –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### 7.5 –û–∫–æ–Ω—á–∞—Ç–µ–ª–Ω–∞ –ø—Ä–µ–ø–æ—Ä—ä–∫–∞

**–ü—Ä–µ–ø–æ—Ä—ä—á–≤–∞–º –≤–Ω–µ–¥—Ä—è–≤–∞–Ω–µ –Ω–∞ –§–∞–∑–∞ 2 –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** –∫–∞—Ç–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
- ‚úÖ –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∏ —Å—Ä–æ–∫–æ–≤–µ (2-4 —Å–µ–¥–º–∏—Ü–∏)
- ‚úÖ –í–∏—Å–æ–∫ ROI (return on investment)
- ‚úÖ –ù–∏—Å–∫–∏ —Ä–∏—Å–∫–æ–≤–µ
- ‚úÖ –°—ä—â–µ—Å—Ç–≤–µ–Ω–æ –ø–æ–¥–æ–±—Ä–µ–Ω–∏–µ –Ω–∞ UX

–§–∞–∑–∞ 3 –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏—Ç–µ –º–æ–≥–∞—Ç –¥–∞ —Å–µ —Ä–∞–∑–≥–ª–µ–¥–∞—Ç –∫–∞—Ç–æ **–¥—ä–ª–≥–æ—Å—Ä–æ—á–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è** —Å–ª–µ–¥ —É—Å–ø–µ—à–Ω–æ—Ç–æ –≤–Ω–µ–¥—Ä—è–≤–∞–Ω–µ –Ω–∞ –§–∞–∑–∞ 2.

---

## 8. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 8.1 –°–ø–∏—Å—ä–∫ –Ω–∞ —Ñ–∞–π–ª–æ–≤–µ—Ç–µ –∑–∞ –ø—Ä–æ–º—è–Ω–∞ (–§–∞–∑–∞ 2)

**–ù–æ–≤–∏ —Ñ–∞–π–ª–æ–≤–µ:**
- `js/offlineLogSync.js` - Offline sync –ª–æ–≥–∏–∫–∞
- `js/persistentCache.js` - Persistent localStorage cache
- `tests/offlineLogSync.test.js` - Unit tests
- `tests/persistentCache.test.js` - Unit tests

**–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–∞–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ:**
- `js/app.js` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞ offline sync –∏ caching
- `js/extraMealForm.js` - –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ offline sync
- `js/requestCache.js` - Extension –∑–∞ persistence
- `worker.js` - –ù–æ–≤ `/api/batch-log` –µ–Ω–¥–ø–æ–π–Ω—Ç
- `README.md` - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –Ω–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 8.2 –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —Å—Ç–µ–∫ –∑–∞ –§–∞–∑–∞ 2

**–ë–µ–∑ –Ω–æ–≤–∏ dependencies:**
- localStorage API (native)
- IndexedDB API (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ, –∑–∞ –±—ä–¥–µ—â–æ)
- Navigator.onLine API (native)
- Background Sync (Service Worker - –§–∞–∑–∞ 3)

**–°—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏:**
- Vite
- Jest (–∑–∞ —Ç–µ—Å—Ç–æ–≤–µ)
- ESLint

### 8.3 –†–µ—Ñ–µ—Ä–µ–Ω—Ü–∏–∏

- [MDN - Web Storage API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API)
- [MDN - IndexedDB API](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API)
- [Google - Offline First](https://developer.chrome.com/docs/workbox/service-worker-overview/)
- [Cloudflare Workers - Best Practices](https://developers.cloudflare.com/workers/best-practices/)

---

**–î–æ–∫—É–º–µ–Ω—Ç —Å—ä–∑–¥–∞–¥–µ–Ω:** 18.11.2025  
**–ê–≤—Ç–æ—Ä:** Copilot Coding Agent  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∑–∞ —Ä–∞–∑–≥–ª–µ–∂–¥–∞–Ω–µ –∏ –æ–¥–æ–±—Ä–µ–Ω–∏–µ
