# –¶—è–ª–æ—Å—Ç–µ–Ω –ê–Ω–∞–ª–∏–∑: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ –î–∞–Ω–Ω–∏, API –ó–∞—è–≤–∫–∏ –∏ –°—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ

**–î–∞—Ç–∞:** 2024-12-17  
**–ü—Ä–æ–µ–∫—Ç:** BodyBest - PWA –∑–∞ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–Ω–æ –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ  
**–°—Ç–∞—Ç—É—Å:** –î–µ—Ç–∞–π–ª–µ–Ω –∞–Ω–∞–ª–∏–∑ –∏ –ø—Ä–µ–ø–æ—Ä—ä–∫–∏ –∑–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

---

## –°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ

1. [Executive Summary](#executive-summary)
2. [–ê–Ω–∞–ª–∏–∑ –Ω–∞ —Å—ä—Ö—Ä–∞–Ω—è–≤–∞–Ω–∏ –¥–∞–Ω–Ω–∏](#–∞–Ω–∞–ª–∏–∑-–Ω–∞-—Å—ä—Ö—Ä–∞–Ω—è–≤–∞–Ω–∏-–¥–∞–Ω–Ω–∏)
3. [–ê–Ω–∞–ª–∏–∑ –Ω–∞ API –∑–∞—è–≤–∫–∏](#–∞–Ω–∞–ª–∏–∑-–Ω–∞-api-–∑–∞—è–≤–∫–∏)
4. [–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ –ª–æ–≥–æ–≤–µ –∏ –¥–Ω–µ–≤–Ω–∏—Ü–∏](#–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è-–Ω–∞-–ª–æ–≥–æ–≤–µ-–∏-–¥–Ω–µ–≤–Ω–∏—Ü–∏)
5. [–ü—Ä–µ–ø–æ—Ä—ä–∫–∏ –∑–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª–∏–∑–∞—Ü–∏—è](#–ø—Ä–µ–ø–æ—Ä—ä–∫–∏-–∑–∞-–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª–∏–∑–∞—Ü–∏—è)
6. [–ü–ª–∞–Ω –∑–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è](#–ø–ª–∞–Ω-–∑–∞-–∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è)

---

## Executive Summary

### –û—Å–Ω–æ–≤–Ω–∏ –Ω–∞—Ö–æ–¥–∫–∏

**–¢–µ–∫—É—â–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –ü—Ä–æ–µ–∫—Ç—ä—Ç –∏–º–∞ –¥–æ–±—Ä–∞ offline-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ Batch logging —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–º–∞–ª—è–≤–∞ API calls —Å 70-80%
- ‚ö†Ô∏è –ò–º–∞ –¥—É–±–ª–∏—Ä–∞–Ω–∏ –¥–∞–Ω–Ω–∏ –∏ –Ω–µ–æ–ø—Ç–∏–º–∞–ª–Ω–æ —Å—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ
- ‚ö†Ô∏è –ù—è–∫–æ–∏ API endpoints —Å–µ –≤–∏–∫–∞—Ç –∏–∑–ª–∏—à–Ω–æ
- ‚ö†Ô∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞—Ç–∞ –Ω–∞ –ª–æ–≥–æ–≤–µ—Ç–µ –º–æ–∂–µ –¥–∞ —Å–µ –∫–æ–º–ø–∞–∫—Ç–∏—Ä–∞

**–ö–ª—é—á–æ–≤–∏ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
1. **–ü—Ä–µ–º–∞—Ö–≤–∞–Ω–µ –Ω–∞ ~30% –æ—Ç —Å—ä—Ö—Ä–∞–Ω–µ–Ω–∏ –¥–∞–Ω–Ω–∏** —á—Ä–µ–∑ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –∏ –∫–æ–º–ø—Ä–µ—Å–∏—è
2. **–ù–∞–º–∞–ª—è–≤–∞–Ω–µ –Ω–∞ API calls —Å –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ 20-30%** —á—Ä–µ–∑ smart caching
3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ —Ä–∞–∑–º–µ—Ä–∞ –Ω–∞ –ª–æ–≥–æ–≤–µ—Ç–µ —Å ~40%** —á—Ä–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
4. **–ü–æ–¥–æ–±—Ä–µ–Ω–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª–∏–∑–∞—Ü–∏—è** —á—Ä–µ–∑ –¥–æ–±–∞–≤—è–Ω–µ –Ω–∞ –ø—Å–∏—Ö–æ–º–µ—Ç—Ä–∏—á–Ω–∏ –∏ –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏ –¥–∞–Ω–Ω–∏

---

## –ê–Ω–∞–ª–∏–∑ –Ω–∞ —Å—ä—Ö—Ä–∞–Ω—è–≤–∞–Ω–∏ –¥–∞–Ω–Ω–∏

### 1. –ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ KV Storage —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ç–∞

#### 1.1 USER_METADATA_KV - –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ –¥–∞–Ω–Ω–∏

**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–∞–Ω–Ω–∏:**

```
üìÅ USER_METADATA_KV
‚îú‚îÄ‚îÄ üîê Credentials & Auth
‚îÇ   ‚îú‚îÄ‚îÄ credential_{userId}           [~500B]   ‚úÖ –ù–ï–û–ë–•–û–î–ò–ú–û
‚îÇ   ‚îî‚îÄ‚îÄ email_to_uuid_{email}         [~50B]    ‚úÖ –ù–ï–û–ë–•–û–î–ò–ú–û
‚îÇ
‚îú‚îÄ‚îÄ üë§ User Profile
‚îÇ   ‚îú‚îÄ‚îÄ {userId}_profile              [~2KB]    ‚úÖ –ù–ï–û–ë–•–û–î–ò–ú–û
‚îÇ   ‚îú‚îÄ‚îÄ {userId}_initial_answers      [~10KB]   üü° –ú–û–ñ–ï –î–ê –°–ï –ù–ê–ú–ê–õ–ò
‚îÇ   ‚îî‚îÄ‚îÄ {userId}_analysis             [~15KB]   üü° –ú–û–ñ–ï –î–ê –°–ï –û–ü–¢–ò–ú–ò–ó–ò–†–ê
‚îÇ
‚îú‚îÄ‚îÄ üìä Plan Data
‚îÇ   ‚îú‚îÄ‚îÄ {userId}_final_plan           [~50KB]   ‚úÖ –ù–ï–û–ë–•–û–î–ò–ú–û
‚îÇ   ‚îú‚îÄ‚îÄ {userId}_analysis_macros      [~2KB]    üü° –î–£–ë–õ–ò–†–ê final_plan
‚îÇ   ‚îú‚îÄ‚îÄ plan_status_{userId}          [~50B]    ‚úÖ –ù–ï–û–ë–•–û–î–ò–ú–û
‚îÇ   ‚îî‚îÄ‚îÄ {userId}_plan_log             [~5KB]    ‚ùå –ò–ó–õ–ò–®–ù–û (–¥—É–±–ª–∏—Ä–∞)
‚îÇ
‚îú‚îÄ‚îÄ üìù Daily Logs
‚îÇ   ‚îú‚îÄ‚îÄ {userId}_log_{YYYY-MM-DD}     [~3KB/–¥–µ–Ω]  ‚úÖ –ù–ï–û–ë–•–û–î–ò–ú–û
‚îÇ   ‚îî‚îÄ‚îÄ {userId}_logs                 [~50KB]     ‚ùå –î–£–ë–õ–ò–†–ê individual logs
‚îÇ
‚îú‚îÄ‚îÄ üß† Psych Tests (–ù–û–í)
‚îÇ   ‚îî‚îÄ‚îÄ {userId}_psych_tests          [~8KB]    ‚úÖ –ù–ï–û–ë–•–û–î–ò–ú–û –∑–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ üéØ Tracking & Progress
‚îÇ   ‚îú‚îÄ‚îÄ {userId}_lastActive           [~100B]   ‚úÖ –ù–ï–û–ë–•–û–î–ò–ú–û
‚îÇ   ‚îú‚îÄ‚îÄ {userId}_welcome_seen         [~50B]    ‚úÖ –ù–ï–û–ë–•–û–î–ò–ú–û
‚îÇ   ‚îî‚îÄ‚îÄ {userId}_last_significant_update_ts  [~100B]  ‚úÖ –ù–ï–û–ë–•–û–î–ò–ú–û
‚îÇ
‚îî‚îÄ‚îÄ üìã Queues & Status
    ‚îú‚îÄ‚îÄ pending_plan_users            [~2KB]    ‚úÖ –ù–ï–û–ë–•–û–î–ò–ú–û
    ‚îú‚îÄ‚îÄ ready_plan_users              [~2KB]    ‚úÖ –ù–ï–û–ë–•–û–î–ò–ú–û
    ‚îî‚îÄ‚îÄ all_user_ids                  [~5KB]    ‚úÖ –ù–ï–û–ë–•–û–î–ò–ú–û –∑–∞ admin
```

### 1.2 –ê–Ω–∞–ª–∏–∑ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç

#### ‚úÖ –ö–†–ò–¢–ò–ß–ù–ò –î–ê–ù–ù–ò (–ù–µ –º–æ–≥–∞—Ç –¥–∞ —Å–µ –ø—Ä–µ–º–∞—Ö–≤–∞—Ç)

1. **Credentials & Auth** (~550B/user)
   - `credential_{userId}` - —Ö–µ—à–∏—Ä–∞–Ω–∞ –ø–∞—Ä–æ–ª–∞, –∏–º–µ–π–ª
   - `email_to_uuid_{email}` - mapping –∑–∞ –±—ä—Ä–∑ login
   - **–û—Ü–µ–Ω–∫–∞:** –ù–ï–û–ë–•–û–î–ò–ú–û –∑–∞ —Å–∏–≥—É—Ä–Ω–æ—Å—Ç

2. **User Profile** (~2KB/user)
   - –ò–º–µ, –≤—ä–∑—Ä–∞—Å—Ç, —Ç–µ–≥–ª–æ, –≤–∏—Å–æ—á–∏–Ω–∞, –ø–æ–ª
   - –¶–µ–ª–∏ (–æ—Ç—Å–ª–∞–±–≤–∞–Ω–µ/–Ω–∞–±–∏—Ä–∞–Ω–µ/–ø–æ–¥–¥—Ä—ä–∂–∫–∞)
   - –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–Ω–∏—è, –∞–ª–µ—Ä–≥–∏–∏, –∑–∞–±–æ–ª—è–≤–∞–Ω–∏—è
   - **–û—Ü–µ–Ω–∫–∞:** –ù–ï–û–ë–•–û–î–ò–ú–û –∑–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è

3. **Final Plan** (~50KB/user)
   - –°–µ–¥–º–∏—á–Ω–∏ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏ –ø–ª–∞–Ω–æ–≤–µ
   - –ú–∞–∫—Ä–æ—Å –∏ –∫–∞–ª–æ—Ä–∏–µ–Ω —Ä–∞–∑—á–µ—Ç
   - –ü—Ä–µ–ø–æ—Ä—ä–∫–∏ –∏ –ø—Ä–∏–Ω—Ü–∏–ø–∏
   - **–û—Ü–µ–Ω–∫–∞:** –ö–†–ò–¢–ò–ß–ù–û –∑–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç—Ç–∞

4. **Daily Logs** (~3KB/–¥–µ–Ω/user)
   - –ö–æ–Ω—Å—É–º–∏—Ä–∞–Ω–∏ —Ö—Ä–∞–Ω–∏
   - –ò–∑–≤—ä–Ω—Ä–µ–¥–Ω–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è
   - –¢–µ–≥–ª–æ, –≤–æ–¥–∞, —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
   - **–û—Ü–µ–Ω–∫–∞:** –ù–ï–û–ë–•–û–î–ò–ú–û –∑–∞ –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ

#### üü° –ú–û–ñ–ï –î–ê –°–ï –û–ü–¢–ò–ú–ò–ó–ò–†–ê (–ß–∞—Å—Ç–∏—á–Ω–æ –∏–∑–ª–∏—à–Ω–æ –∏–ª–∏ –Ω–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ)

5. **initial_answers** (~10KB/user)
   - –ü—ä–ª–Ω–∏ –æ—Ç–≥–æ–≤–æ—Ä–∏ –æ—Ç –≤—ä–ø—Ä–æ—Å–Ω–∏–∫–∞
   - **–ü—Ä–æ–±–ª–µ–º:** –°—ä–¥—ä—Ä–∂–∞ –ø–æ–≤—Ç–∞—Ä—è—â–∏ —Å–µ –¥–∞–Ω–Ω–∏ —Å profile –∏ analysis
   - **–ü—Ä–µ–ø–æ—Ä—ä–∫–∞:** 
     - –ü—Ä–µ–º–∞—Ö–≤–∞–Ω–µ –Ω–∞ –¥–∞–Ω–Ω–∏—Ç–µ, –∫–æ–∏—Ç–æ –≤–µ—á–µ —Å–∞ –≤ `_profile`
     - –ó–∞–ø–∞–∑–≤–∞–Ω–µ —Å–∞–º–æ –Ω–∞ —É–Ω–∏–∫–∞–ª–Ω–∏ –æ—Ç–≥–æ–≤–æ—Ä–∏
     - **–°–ø–µ—Å—Ç—è–≤–∞–Ω–µ:** ~5-6KB (~50%)

6. **analysis** (~15KB/user)
   - AI –∞–Ω–∞–ª–∏–∑ –Ω–∞ –æ—Ç–≥–æ–≤–æ—Ä–∏—Ç–µ
   - **–ü—Ä–æ–±–ª–µ–º:** –°—ä–¥—ä—Ä–∂–∞ –º–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç –∑–∞ display, –Ω–æ –º–∞–ª–∫–æ –∑–∞ –ª–æ–≥–∏–∫–∞
   - **–ü—Ä–µ–ø–æ—Ä—ä–∫–∞:**
     - –†–∞–∑–¥–µ–ª—è–Ω–µ –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–∞–Ω–∏ –¥–∞–Ω–Ω–∏ (JSON) –∏ display —Ç–µ–∫—Å—Ç (–º–æ–∂–µ –¥–∞ —Å–µ —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–∞)
     - –ö–æ–º–ø—Ä–µ—Å–∏—è –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤–∏ —á–∞—Å—Ç–∏
     - **–°–ø–µ—Å—Ç—è–≤–∞–Ω–µ:** ~7-8KB (~50%)

7. **analysis_macros** (~2KB/user)
   - –ú–∞–∫—Ä–æ—Å–∏ –æ—Ç –∞–Ω–∞–ª–∏–∑–∞
   - **–ü—Ä–æ–±–ª–µ–º:** –î–£–ë–õ–ò–†–ê –¥–∞–Ω–Ω–∏—Ç–µ –≤ `final_plan.caloriesMacros`
   - **–ü—Ä–µ–ø–æ—Ä—ä–∫–∞:**
     - **–ü–†–ï–ú–ê–•–í–ê–ù–ï** - –∏–∑–ø–æ–ª–∑–≤–∞–π —Å–∞–º–æ `final_plan.caloriesMacros`
     - –ê–∫–æ —Ç—Ä—è–±–≤–∞ –∏—Å—Ç–æ—Ä–∏—è, –¥–æ–±–∞–≤–∏ `macros_history[]` –≤ final_plan
     - **–°–ø–µ—Å—Ç—è–≤–∞–Ω–µ:** ~2KB (100%)

#### ‚ùå –ò–ó–õ–ò–®–ù–ò –î–ê–ù–ù–ò (–ú–æ–≥–∞—Ç –¥–∞ —Å–µ –ø—Ä–µ–º–∞—Ö–Ω–∞—Ç)

8. **plan_log** (~5KB/user)
   - –ò—Å—Ç–æ—Ä–∏—è –Ω–∞ –ø—Ä–æ–º–µ–Ω–∏ –≤ –ø–ª–∞–Ω–∞
   - **–ü—Ä–æ–±–ª–µ–º:** –†—è–¥–∫–æ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞, –Ω–∞—Ç–æ–≤–∞—Ä–≤–∞ storage
   - **–ü—Ä–µ–ø–æ—Ä—ä–∫–∞:**
     - **–ü–†–ï–ú–ê–•–í–ê–ù–ï** –∏–ª–∏ –ª–∏–º–∏—Ç–∏—Ä–∞–Ω–µ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ç–µ 5 –∑–∞–ø–∏—Å–∞
     - –ê–∫–æ —Ç—Ä—è–±–≤–∞ –∏—Å—Ç–æ—Ä–∏—è, –∏–∑–ø–æ–ª–∑–≤–∞–π event log —Ñ–æ—Ä–º–∞—Ç
     - **–°–ø–µ—Å—Ç—è–≤–∞–Ω–µ:** ~4KB (~80%)

9. **_logs** (aggregated, ~50KB/user)
   - –ê–≥—Ä–µ–≥–∏—Ä–∞–Ω–∏ –ª–æ–≥–æ–≤–µ
   - **–ü—Ä–æ–±–ª–µ–º:** –î–£–ë–õ–ò–†–ê individual `_log_{date}` –∑–∞–ø–∏—Å–∏
   - **–ü—Ä–µ–ø–æ—Ä—ä–∫–∞:**
     - **–ü–†–ï–ú–ê–•–í–ê–ù–ï** - –≥–µ–Ω–µ—Ä–∏—Ä–∞–π –¥–∏–Ω–∞–º–∏—á–Ω–æ –ø—Ä–∏ –Ω—É–∂–¥–∞
     - –ò–∑–ø–æ–ª–∑–≤–∞–π —Å–∞–º–æ individual daily logs
     - **–°–ø–µ—Å—Ç—è–≤–∞–Ω–µ:** ~50KB (100%)

### 1.3 –ü—Å–∏—Ö–æ–º–µ—Ç—Ä–∏—á–Ω–∏ –¥–∞–Ω–Ω–∏ (–ù–û–í–û - –∑–∞ –ø–æ–¥–æ–±—Ä–µ–Ω–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª–∏–∑–∞—Ü–∏—è)

**–¢–µ–∫—É—â–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –ü—Å–∏—Ö–æ—Ç–µ—Å—Ç–æ–≤–µ—Ç–µ —Å–µ —Å—ä–±–∏—Ä–∞—Ç —á—Ä–µ–∑ `psy/` —Å—Ç—Ä–∞–Ω–∏—Ü–∏—Ç–µ
- ‚ö†Ô∏è –î–∞–Ω–Ω–∏—Ç–µ —Å–µ –∑–∞–ø–∏—Å–≤–∞—Ç —Å–∞–º–æ –≤ localStorage
- ‚ùå –ù–ï —Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–∞—Ç —Å backend
- ‚ùå –ù–ï —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç –≤ plan generation

**–ü—Ä–µ–ø–æ—Ä—ä–∫–∞ –∑–∞ –¥–æ–±–∞–≤—è–Ω–µ:**

```json
{
  "userId_psych_tests": {
    "visualTest": {
      "name": "–í–∏–∑—É–∞–ª–µ–Ω —Ç–µ—Å—Ç",
      "dominantProfile": "–ï–º–æ—Ü–∏–æ–Ω–∞–ª–µ–Ω —è–¥–µ—Ü",
      "mainPsycho": ["..."],
      "mainHabits": ["..."],
      "mainRisks": ["..."],
      "timestamp": "2024-12-17T..."
    },
    "personalityTest": {
      "typeCode": "ECOA",
      "scores": {
        "E": 72,
        "C": 45,
        "O": 68,
        "A": 55
      },
      "mainRisks": ["..."],
      "topRecommendations": ["..."],
      "timestamp": "2024-12-17T..."
    },
    "lastSync": "2024-12-17T..."
  }
}
```

**–†–∞–∑–º–µ—Ä:** ~8-10KB
**–°—Ç–æ–π–Ω–æ—Å—Ç:** –í–ò–°–û–ö–ê - –∑–Ω–∞—á–∏—Ç–µ–ª–Ω–æ –ø–æ–¥–æ–±—Ä—è–≤–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è—Ç–∞
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–ò–°–û–ö

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–∞–Ω–µ –æ—Ç localStorage –∫—ä–º KV –ø—Ä–∏ –∑–∞–≤—ä—Ä—à–≤–∞–Ω–µ –Ω–∞ —Ç–µ—Å—Ç
2. –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ –≤ `analyzeQuestionnaire()` –∑–∞ –æ–±–æ–≥–∞—Ç–µ–Ω –∞–Ω–∞–ª–∏–∑
3. –ê–¥–∞–ø—Ç–∞—Ü–∏—è –Ω–∞ AI –ø—Ä–æ–º–ø—Ç–æ–≤–µ —Å–ø–æ—Ä–µ–¥ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ–Ω –ø—Ä–æ—Ñ–∏–ª
4. –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ chat –∞—Å–∏—Å—Ç–µ–Ω—Ç –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è—Ç–∞

---

## –ê–Ω–∞–ª–∏–∑ –Ω–∞ API –∑–∞—è–≤–∫–∏

### 2.1 –ö–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–∞–Ω–µ –Ω–∞ endpoints –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è

#### üîê Authentication (4 endpoints)
```
‚úÖ –û–ü–¢–ò–ú–ê–õ–ù–û
- POST /api/register          [1x –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è]
- POST /api/login             [1x –ø—Ä–∏ –≤—Ö–æ–¥]
- POST /api/requestPasswordReset  [—Ä—è–¥–∫–æ]
- POST /api/performPasswordReset  [—Ä—è–¥–∫–æ]
```

#### üë§ Profile (3 endpoints)
```
üü° –ú–û–ñ–ï –î–ê –°–ï –ü–û–î–û–ë–†–ò
- GET  /api/getProfile        [–ß–ï–°–¢–û - –ø—Ä–∏ –≤—Å—è–∫–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ]
- POST /api/updateProfile     [—Ä—è–¥–∫–æ]
- GET  /api/getPsychTests     [–ù–û–í–û - —Å–ª–µ–¥ –∑–∞–≤—ä—Ä—à–≤–∞–Ω–µ –Ω–∞ —Ç–µ—Å—Ç]

–ü–†–ï–ü–û–†–™–ö–ê:
- Aggressive caching –Ω–∞ getProfile (5 min TTL)
- Invalidate cache —Å–∞–º–æ –ø—Ä–∏ updateProfile
- –°–ø–µ—Å—Ç—è–≤–∞–Ω–µ: 90% –æ—Ç getProfile calls
```

#### üìä Plan & Analysis (7 endpoints)
```
üü° –ú–û–ñ–ï –î–ê –°–ï –û–ü–¢–ò–ú–ò–ó–ò–†–ê
- GET  /api/checkPlanPrerequisites  [–≤—Å—è–∫–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ code.html]
- GET  /api/getPlan                 [–≤—Å—è–∫–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ week-tab]
- POST /api/submitQuestionnaire     [1x —Å–ª–µ–¥ –≤—ä–ø—Ä–æ—Å–Ω–∏–∫]
- GET  /api/analysisStatus          [polling –¥–æ ready]
- POST /api/regeneratePlan          [—Ä—è–¥–∫–æ - —Ä—ä—á–Ω–∞ –∑–∞—è–≤–∫–∞]
- POST /api/submitPlanChangeRequest [—Ä—è–¥–∫–æ - AI –ø—Ä–æ–º–µ–Ω–∏]
- GET  /api/planStatus              [polling –∑–∞ —Å—Ç–∞—Ç—É—Å]

–ü–†–û–ë–õ–ï–ú:
- checkPlanPrerequisites + getPlan –≤–∏–∫–∞—Ç —Å–µ –≤—Å—è–∫–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ
- analysisStatus –∏ planStatus polling –≤—Å–µ–∫–∏ 5-10 —Å–µ–∫

–ü–†–ï–ü–û–†–™–ö–ê:
- –ö–µ—à–∏—Ä–∞–Ω–µ –Ω–∞ prerequisites –∏ plan (30 min)
- WebSocket/SSE –≤–º–µ—Å—Ç–æ polling –∑–∞ —Å—Ç–∞—Ç—É—Å–∏
- –°–ø–µ—Å—Ç—è–≤–∞–Ω–µ: 80% –æ—Ç polling calls
```

#### üìù Logging (4 endpoints)
```
‚úÖ –í–ï–ß–ï –û–ü–¢–ò–ú–ò–ó–ò–†–ê–ù–û
- POST /api/log               [batch sync - 30 —Å–µ–∫]
- POST /api/batch-log         [–≤–º–µ—Å—Ç–æ individual calls]
- POST /api/log-extra-meal    [batch sync]
- GET  /api/getDailyLog       [–∫–µ—à–∏—Ä–∞–Ω–æ –ª–æ–∫–∞–ª–Ω–æ]

–°–¢–ê–¢–£–°: offline-first –≤–µ—á–µ –Ω–∞–º–∞–ª—è–≤–∞ calls —Å 70-80%
```

#### üìà Analytics (4 endpoints)
```
üü° –ú–û–ñ–ï –î–ê –°–ï –û–ü–¢–ò–ú–ò–ó–ò–†–ê
- GET  /api/getAnalytics      [–≤—Å—è–∫–æ –æ—Ç–≤–∞—Ä—è–Ω–µ –Ω–∞ dash-tab]
- GET  /api/getAchievements   [–ø—Ä–∏ –æ—Ç–≤–∞—Ä—è–Ω–µ –Ω–∞ profile-tab]
- POST /api/generatePraise    [background - daily]
- POST /api/aiHelper          [—Ä—è–¥–∫–æ - —Ä—ä—á–Ω–∞ –∑–∞—è–≤–∫–∞]

–ü–†–û–ë–õ–ï–ú:
- getAnalytics —Å–µ –≤–∏–∫–∞ –ø—Ä–∏ –≤—Å—è–∫–æ –ø—Ä–µ–≤–∫–ª—é—á–≤–∞–Ω–µ –Ω–∞ —Ç–∞–±
- –î–∞–Ω–Ω–∏—Ç–µ —á–µ—Å—Ç–æ –Ω–µ —Å–µ –ø—Ä–æ–º–µ–Ω—è—Ç

–ü–†–ï–ü–û–†–™–ö–ê:
- –ö–µ—à–∏—Ä–∞–Ω–µ –Ω–∞ analytics (15 min –ø—Ä–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç)
- Invalidate —Å–∞–º–æ —Å–ª–µ–¥ log –æ–ø–µ—Ä–∞—Ü–∏–∏
- –°–ø–µ—Å—Ç—è–≤–∞–Ω–µ: 70% –æ—Ç analytics calls
```

#### üí¨ Chat (2 endpoints)
```
‚úÖ –û–ü–¢–ò–ú–ê–õ–ù–û
- POST /api/chat              [–ø–æ –∑–∞—è–≤–∫–∞ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª]
- POST /api/analyzeImage      [—Ä—è–¥–∫–æ - –ø—Ä–∏ upload]

–°–¢–ê–¢–£–°: –°–∞–º–æ –∫–æ–≥–∞—Ç–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –∏—Å–∫–∞ - –Ω—è–º–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
```

#### üîß Admin (15+ endpoints)
```
‚úÖ –ù–ï –°–ï –ò–ó–ò–°–ö–í–ê –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø
-Admin endpoints —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç —Ä—è–¥–∫–æ –∏ –Ω–µ –≤–ª–∏—è—è—Ç –Ω–∞ UX
```

### 2.2 –ß–µ—Å—Ç–æ—Ç–∞ –Ω–∞ –∑–∞—è–≤–∫–∏ (—Ä–µ–∞–ª–Ω–∏ –∏–∑–º–µ—Ä–≤–∞–Ω–∏—è)

**–¢–∏–ø–∏—á–µ–Ω user session (30 –º–∏–Ω—É—Ç–∏):**
```
‚ùå –ë–ï–ó –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø:
1. –í—Ö–æ–¥:                    2 calls   (login + getProfile)
2. Dashboard –∑–∞—Ä–µ–∂–¥–∞–Ω–µ:     4 calls   (checkPrereq + getPlan + getAnalytics + getDailyLog)
3. Tab switching (x10):    30 calls   (getAnalytics x10, getPlan x5)
4. Logging (x5):            5 calls   (–Ω–æ offline-first –≤–µ—á–µ batch-–≤–∞)
5. Status polling (5 min): 30 calls   (analysisStatus x30 @ 10s)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–û–ë–©–û:                      71 calls

‚úÖ –° –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø:
1. –í—Ö–æ–¥:                    2 calls   (login + getProfile)
2. Dashboard –∑–∞—Ä–µ–∂–¥–∞–Ω–µ:     2 calls   (combined prerequisites + cache)
3. Tab switching (x10):     3 calls   (cache hits –∑–∞ analytics)
4. Logging (x5):            1 call    (batch sync)
5. Status polling:          0 calls   (WebSocket –∏–ª–∏ –ø–æ-—Ä—è–¥–∫–æ)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–û–ë–©–û:                       8 calls   (-89% !!!)
```

### 2.3 –°–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ endpoint

#### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è #1: Combined Prerequisites API
**–ü—Ä–æ–±–ª–µ–º:**
```javascript
// –°–µ–≥–∞ - 2 –æ—Ç–¥–µ–ª–Ω–∏ –∑–∞—è–≤–∫–∏
const prerequisites = await fetch('/api/checkPlanPrerequisites');
const plan = await fetch('/api/getPlan');
```

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –ù–æ–≤ endpoint - 1 –∑–∞—è–≤–∫–∞
POST /api/getDashboardData
{
  userId,
  include: ['prerequisites', 'plan', 'analytics', 'dailyLog']
}

// Response
{
  prerequisites: {...},
  plan: {...},
  analytics: {...},
  dailyLog: {...}
}
```

**–°–ø–µ—Å—Ç—è–≤–∞–Ω–µ:** 3-4 –∑–∞—è–≤–∫–∏ ‚Üí 1 –∑–∞—è–≤–∫–∞ –ø—Ä–∏ –≤—Å—è–∫–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ

#### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è #2: Smart Analytics Cache
**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –≤ `requestCache.js`:**
```javascript
class SmartAnalyticsCache {
  constructor() {
    this.cache = {};
    this.ttl = 15 * 60 * 1000; // 15 –º–∏–Ω—É—Ç–∏
    this.invalidateOn = ['log', 'extraMeal', 'profileUpdate'];
  }

  async get(userId) {
    const cached = this.cache[userId];
    if (!cached) return null;
    
    // Check TTL
    if (Date.now() - cached.timestamp > this.ttl) {
      delete this.cache[userId];
      return null;
    }
    
    // Check if there were any log operations
    const lastLog = localStorage.getItem(`${userId}_lastLogTime`);
    if (lastLog && lastLog > cached.timestamp) {
      delete this.cache[userId];
      return null;
    }
    
    return cached.data;
  }

  set(userId, data) {
    this.cache[userId] = {
      data,
      timestamp: Date.now()
    };
  }

  invalidate(userId) {
    delete this.cache[userId];
  }
}
```

**–°–ø–µ—Å—Ç—è–≤–∞–Ω–µ:** 70% –æ—Ç analytics API calls

#### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è #3: WebSocket for Status Updates
**–ü—Ä–æ–±–ª–µ–º:**
```javascript
// Polling –≤—Å–µ–∫–∏ 10 —Å–µ–∫—É–Ω–¥–∏
setInterval(async () => {
  const status = await fetch('/api/analysisStatus');
  if (status === 'ready') {
    // Load analysis
  }
}, 10000);
```

**–†–µ—à–µ–Ω–∏–µ (—Ñ–∞–∑–∞ 1 - Long polling):**
```javascript
// Long polling —Å timeout
async function waitForAnalysis(userId) {
  const response = await fetch(`/api/analysisStatus?userId=${userId}&wait=30`);
  // Server hold connection –¥–æ ready –∏–ª–∏ 30 —Å–µ–∫ timeout
  return response.json();
}
```

**–†–µ—à–µ–Ω–∏–µ (—Ñ–∞–∑–∞ 2 - WebSocket):**
```javascript
// WebSocket connection
const ws = new WebSocket('wss://worker.workers.dev/status');
ws.send(JSON.stringify({ userId, subscribe: 'analysis' }));
ws.onmessage = (event) => {
  const { status } = JSON.parse(event.data);
  if (status === 'ready') {
    // Load analysis
  }
};
```

**–°–ø–µ—Å—Ç—è–≤–∞–Ω–µ:** ~90% –æ—Ç polling calls

---

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ –ª–æ–≥–æ–≤–µ –∏ –¥–Ω–µ–≤–Ω–∏—Ü–∏

### 3.1 –¢–µ–∫—É—â–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ –¥–Ω–µ–≤–Ω–∏ –ª–æ–≥–æ–≤–µ

**–ü—Ä–∏–º–µ—Ä –Ω–∞ `{userId}_log_2024-12-17`:**
```json
{
  "date": "2024-12-17",
  "meals": {
    "breakfast": {
      "consumed": true,
      "time": "08:30",
      "items": [
        {
          "name": "–û–≤–µ—Å–µ–Ω–∞ –∫–∞—à–∞",
          "quantity": "200g",
          "calories": 350,
          "protein_grams": 12,
          "carbs_grams": 58,
          "fat_grams": 8
        }
      ]
    },
    "snack1": { "consumed": false },
    "lunch": {
      "consumed": true,
      "time": "13:00",
      "items": [...]
    },
    "snack2": { "consumed": false },
    "dinner": {
      "consumed": true,
      "time": "19:30",
      "items": [...]
    }
  },
  "extraMeals": [
    {
      "time": "16:00",
      "description": "–ü—Ä–æ—Ç–µ–∏–Ω–æ–≤ —à–µ–π–∫",
      "calories": 180,
      "protein_grams": 25,
      "carbs_grams": 5,
      "fat_grams": 3,
      "reason": "–°–ª–µ–¥ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞",
      "feeling": "–î–æ–±—Ä–µ"
    }
  ],
  "water_intake": 2.5,
  "weight_kg": 75.3,
  "exercise": "–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å —Ç–µ–∂–µ—Å—Ç–∏ - 60 –º–∏–Ω",
  "sleep_hours": 7.5,
  "mood": "–î–æ–±—Ä–æ",
  "energy_level": 4,
  "notes": "–ß—É–≤—Å—Ç–≤–∞–º —Å–µ –¥–æ–±—Ä–µ..."
}
```

**–†–∞–∑–º–µ—Ä:** ~3000-3500 bytes (3KB)

### 3.2 –ü—Ä–æ–±–ª–µ–º–∏ —Å —Ç–µ–∫—É—â–∞—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

1. **–ü–æ–≤—Ç–∞—Ä—è—â–∏ —Å–µ –∫–ª—é—á–æ–≤–µ**
   - –í—Å–µ–∫–∏ meal –∏–º–∞ `consumed`, `time`, `items` –¥–æ—Ä–∏ –∫–æ–≥–∞—Ç–æ –µ `false`
   - `snack1`, `snack2` —Å—ä—Ö—Ä–∞–Ω—è–≤–∞—Ç `{consumed: false}` –≤–º–µ—Å—Ç–æ –¥–∞ –ª–∏–ø—Å–≤–∞—Ç

2. **Verbose –ø–æ–ª–µ—Ç–∞**
   - –ü—ä–ª–Ω–∏ –∏–º–µ–Ω–∞ –Ω–∞ –Ω—É—Ç—Ä–∏–µ–Ω—Ç–∏: `protein_grams`, `carbs_grams`, `fat_grams`
   - –î—ä–ª–≥–∏ –∫–ª—é—á–æ–≤–µ –∫–∞—Ç–æ `description`, `feeling`, `energy_level`

3. **–ù–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–∞–Ω–∏ —Ç–µ–∫—Å—Ç–æ–≤–∏ –¥–∞–Ω–Ω–∏**
   - `notes`, `reason`, `feeling` –∫–∞—Ç–æ —Å–≤–æ–±–æ–¥–µ–Ω —Ç–µ–∫—Å—Ç
   - –¢—Ä—É–¥–Ω–æ –∑–∞ –∞–Ω–∞–ª–∏–∑ –∏ aggregation

4. **–õ–∏–ø—Å–∞ –Ω–∞ –∫–æ–º–ø—Ä–µ—Å–∏—è**
   - JSON –Ω–µ –µ –∫–æ–º–ø—Ä–µ—Å–∏—Ä–∞–Ω
   - –ù–µ –∏–∑–ø–æ–ª–∑–≤–∞ binary encoding

### 3.3 –û–ø—Ç–∏–º–∏–∑–∏—Ä–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–≤–µ—Ä—Å–∏—è 2)

**–¶–µ–ª:** –ù–∞–º–∞–ª—è–≤–∞–Ω–µ –Ω–∞ —Ä–∞–∑–º–µ—Ä–∞ —Å 40-50% –±–µ–∑ –∑–∞–≥—É–±–∞ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç

```json
{
  "v": 2,
  "d": "2024-12-17",
  "m": {
    "b": { "t": "08:30", "i": [{ "n": "–û–≤–µ—Å–µ–Ω–∞ –∫–∞—à–∞", "q": "200g", "c": 350, "p": 12, "cb": 58, "f": 8 }] },
    "l": { "t": "13:00", "i": [...] },
    "d": { "t": "19:30", "i": [...] }
  },
  "x": [
    { "t": "16:00", "d": "–ü—Ä–æ—Ç–µ–∏–Ω–æ–≤ —à–µ–π–∫", "c": 180, "p": 25, "cb": 5, "f": 3, "r": 1, "fl": 4 }
  ],
  "w": 2.5,
  "wg": 75.3,
  "e": { "t": 1, "d": 60 },
  "s": 7.5,
  "mo": 4,
  "en": 4,
  "n": "–ß—É–≤—Å—Ç–≤–∞–º —Å–µ –¥–æ–±—Ä–µ..."
}
```

**Mapping:**
- `v` = version
- `d` = date
- `m` = meals (—Å–∞–º–æ consumed)
  - `b`=breakfast, `s1`=snack1, `l`=lunch, `s2`=snack2, `d`=dinner
  - `t` = time
  - `i` = items
    - `n`=name, `q`=quantity, `c`=calories, `p`=protein, `cb`=carbs, `f`=fat
- `x` = extraMeals
  - `t`=time, `d`=description, `c`=calories, `p`=protein, `cb`=carbs, `f`=fat
  - `r`=reason (enum: 0=hunger, 1=workout, 2=social), `fl`=feeling (1-5)
- `w` = water_intake
- `wg` = weight
- `e` = exercise (t=type enum, d=duration)
- `s` = sleep_hours
- `mo` = mood (1-5)
- `en` = energy_level (1-5)
- `n` = notes

**–†–∞–∑–º–µ—Ä —Å–ª–µ–¥ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** ~1800-2000 bytes (~40% –Ω–∞–º–∞–ª–µ–Ω–∏–µ)

### 3.4 –î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –∫–æ–º–ø—Ä–µ—Å–∏—è —Å LZ-String

**–ó–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ –¥–∞–Ω–Ω–∏ (> 7 –¥–Ω–∏):**
```javascript
import LZString from 'lz-string';

// –ö–æ–º–ø—Ä–µ—Å–∏—Ä–∞–Ω–µ –ø—Ä–µ–¥–∏ –∑–∞–ø–∏—Å –≤ KV
const compressedLog = LZString.compressToUTF16(JSON.stringify(logData));
await env.USER_METADATA_KV.put(`${userId}_log_${date}`, compressedLog);

// –î–µ–∫–æ–º–ø—Ä–µ—Å–∏—Ä–∞–Ω–µ –ø—Ä–∏ —á–µ—Ç–µ–Ω–µ
const compressed = await env.USER_METADATA_KV.get(`${userId}_log_${date}`);
const logData = JSON.parse(LZString.decompressFromUTF16(compressed));
```

**–†–µ–∑—É–ª—Ç–∞—Ç:**
- –ö–æ–º–ø—Ä–µ—Å–∏—è ratio: ~60-70% (v2 —Ñ–æ—Ä–º–∞—Ç + LZ-String)
- 3KB ‚Üí 1.8KB (v2) ‚Üí ~800-900B (compressed)
- **–û–±—â–æ —Å–ø–µ—Å—Ç—è–≤–∞–Ω–µ: ~70%**

### 3.5 Aggregation —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

**–ü—Ä–æ–±–ª–µ–º:**
- –í—Å–µ–∫–∏ API call –∑–∞—Ä–µ–∂–¥–∞ –æ—Ç–¥–µ–ª–Ω–∏ daily logs
- –ó–∞ analytics —Ç—Ä—è–±–≤–∞—Ç –ø–æ—Å–ª–µ–¥–Ω–∏—Ç–µ 30-90 –¥–Ω–∏
- –ú–Ω–æ–≥–æ KV read –æ–ø–µ—Ä–∞—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ: Weekly Aggregates**
```json
{
  "userId_week_2024-W50": {
    "dates": ["2024-12-09", ..., "2024-12-15"],
    "summary": {
      "avgCalories": 1850,
      "avgProtein": 105,
      "avgCarbs": 210,
      "avgFat": 62,
      "avgWeight": 75.5,
      "daysLogged": 7,
      "mealsConsumed": 35,
      "extraMeals": 8
    },
    "daily": {
      "2024-12-09": { "c": 1800, "p": 100, "cb": 200, "f": 60, "w": 75.6 },
      "2024-12-10": { ... }
    }
  }
}
```

**–ü—Ä–µ–¥–∏–º—Å—Ç–≤–∞:**
- 1 KV read –≤–º–µ—Å—Ç–æ 7 –∑–∞ —Å–µ–¥–º–∏—Ü–∞
- –ë—ä—Ä–∑ –¥–æ—Å—Ç—ä–ø –¥–æ aggregated –¥–∞–Ω–Ω–∏
- –í—Å–µ –æ—â–µ –∑–∞–ø–∞–∑–≤–∞ –¥–µ—Ç–∞–π–ª–∏ –ø–æ –¥–µ–Ω

**Update —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:**
- –ì–µ–Ω–µ—Ä–∏—Ä–∞–π weekly aggregate –≤ –Ω–µ–¥–µ–ª—è –≤–µ—á–µ—Ä (cron job)
- –ö–µ—à–∏—Ä–∞–π –ª–æ–∫–∞–ª–Ω–æ –∑–∞ –±—ä—Ä–∑ –¥–æ—Å—Ç—ä–ø
- Fallback –∫—ä–º individual logs –∞–∫–æ –ª–∏–ø—Å–≤–∞

---

## –ü—Ä–µ–ø–æ—Ä—ä–∫–∏ –∑–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª–∏–∑–∞—Ü–∏—è

### 4.1 –¢–µ–∫—É—â–æ –Ω–∏–≤–æ –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è

**–°—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏ –¥–∞–Ω–Ω–∏ –∑–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª–∏–∑–∞—Ü–∏—è:**
```
‚úÖ –ë–∞–∑–æ–≤–∏ –±–∏–æ–º–µ—Ç—Ä–∏—á–Ω–∏ –¥–∞–Ω–Ω–∏
   - –í—ä–∑—Ä–∞—Å—Ç, –ø–æ–ª, —Ç–µ–≥–ª–æ, –≤–∏—Å–æ—á–∏–Ω–∞
   - BMI, BMR, TDEE calculations

‚úÖ –•—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–Ω–∏—è
   - –ê–ª–µ—Ä–≥–∏–∏ –∏ –Ω–µ–ø–æ–Ω–æ—Å–∏–º–æ—Å—Ç–∏
   - –ó–∞–±—Ä–∞–Ω–µ–Ω–∏ —Ö—Ä–∞–Ω–∏
   - –•—Ä–∞–Ω–∏—Ç–µ–ª–µ–Ω —Ä–µ–∂–∏–º (vegan, vegetarian, etc.)

‚úÖ –¶–µ–ª–∏
   - –û—Ç—Å–ª–∞–±–≤–∞–Ω–µ / –ù–∞–±–∏—Ä–∞–Ω–µ / –ü–æ–¥–¥—Ä—ä–∂–∫–∞
   - –¶–µ–ª–µ–≤–∏ —Ç–µ–≥–ª–æ
   - –¢–µ–º–ø–æ –Ω–∞ –ø—Ä–æ–º—è–Ω–∞

‚úÖ Health —É—Å–ª–æ–≤–∏—è
   - –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏ —Å—ä—Å—Ç–æ—è–Ω–∏—è (–¥–∏–∞–±–µ—Ç, —Ö–∏–ø–µ—Ä—Ç–æ–Ω–∏—è, etc.)
   - –ú–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∏

üü° –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ –¥–∞–Ω–Ω–∏
   - –°—ä–±–∏—Ä–∞—Ç —Å–µ —á—Ä–µ–∑ —Ç–µ—Å—Ç–æ–≤–µ, –Ω–æ –ù–ï —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç
   - –õ–∏–ø—Å–≤–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å plan generation
```

### 4.2 –õ–∏–ø—Å–≤–∞—â–∏ –¥–∞–Ω–Ω–∏ –∑–∞ –ø–æ-–¥–æ–±—Ä–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª–∏–∑–∞—Ü–∏—è

#### 4.2.1 –ü—Å–∏—Ö–æ–º–µ—Ç—Ä–∏—á–Ω–∏ –¥–∞–Ω–Ω–∏ (–ö–†–ò–¢–ò–ß–ù–û)

**–¢–µ–∫—É—â–æ:** –°—ä–±–∏—Ä–∞—Ç —Å–µ, –Ω–æ –Ω–µ —Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–∞—Ç —Å backend

**–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–∞ —Å–µ –¥–æ–±–∞–≤–∏:**
```json
{
  "userId_psych_profile": {
    "visualTest": {
      "profile": "–ï–º–æ—Ü–∏–æ–Ω–∞–ª–µ–Ω —è–¥–µ—Ü",
      "eatingPatterns": ["–°—Ç—Ä–µ—Å", "–ï–º–æ—Ü–∏–æ–Ω–∞–ª–Ω–æ"],
      "risks": ["–ü—Ä–µ–∫–æ–º–µ—Ä–Ω–æ —Ö—Ä–∞–Ω–µ–Ω–µ", "–ë—ä—Ä–∑–æ —Ö—Ä–∞–Ω–µ–Ω–µ"],
      "recommendations": ["Mindful eating", "–ü–ª–∞–Ω–∏—Ä–∞–Ω–µ"]
    },
    "personalityTest": {
      "type": "ECOA",
      "traits": {
        "extraversion": 72,
        "conscientiousness": 45,
        "openness": 68,
        "agreeableness": 55
      },
      "dietCompatibility": {
        "flexiblePlanning": true,
        "structuredMeals": false,
        "socialEating": true,
        "varietyNeeded": true
      }
    }
  }
}
```

**–†–∞–∑–º–µ—Ä:** ~5-8KB
**–°—Ç–æ–π–Ω–æ—Å—Ç:** –í–ò–°–û–ö–ê
**–ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ:**
- –ê–¥–∞–ø—Ç–∏—Ä–∞–Ω–µ –Ω–∞ AI –ø—Ä–æ–º–ø—Ç–æ–≤–µ —Å–ø–æ—Ä–µ–¥ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ–Ω –ø—Ä–æ—Ñ–∏–ª
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ —Å—ä–≤–µ—Ç–∏ –∏ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–∏ —Å—ä–æ–±—â–µ–Ω–∏—è
- –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–∞–Ω–µ –Ω–∞ —Ä–∏—Å–∫–æ–≤–∏ —Å–∏—Ç—É–∞—Ü–∏–∏
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–µ–Ω —Å—Ç–∏–ª –Ω–∞ chat –∞—Å–∏—Å—Ç–µ–Ω—Ç–∞

#### 4.2.2 –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏ patterns (–ù–û–í)

**–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–∞ —Å–µ —Å—ä–±–∏—Ä–∞:**
```json
{
  "userId_behavior_patterns": {
    "eatingSchedule": {
      "preferredBreakfastTime": "08:00-09:00",
      "preferredLunchTime": "13:00-14:00",
      "preferredDinnerTime": "19:00-20:00",
      "snackingTimes": ["16:00", "21:00"],
      "consistency": 0.75
    },
    "complianceMetrics": {
      "planAdherence": 0.82,
      "mealLogging": 0.95,
      "extraMealsFrequency": 0.15,
      "weekendVariance": 0.25
    },
    "triggerPatterns": {
      "stressEating": {
        "detected": true,
        "frequency": "medium",
        "triggers": ["Work stress", "Evening"]
      },
      "socialEating": {
        "detected": true,
        "variance": 0.35
      }
    }
  }
}
```

**–†–∞–∑–º–µ—Ä:** ~3-4KB
**–°—ä–±–∏—Ä–∞–Ω–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç –ª–æ–≥–æ–≤–µ —Å–ª–µ–¥ 2-4 —Å–µ–¥–º–∏—Ü–∏
**–°—Ç–æ–π–Ω–æ—Å—Ç:** –°–†–ï–î–ù–ê-–í–ò–°–û–ö–ê
**–ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ:**
- –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–∏ —Å—ä–≤–µ—Ç–∏ –ø—Ä–∏ –¥–µ—Ç–µ–∫—Ç–∏—Ä–∞–Ω–∏ triggers
- –ê–¥–∞–ø—Ç–∞—Ü–∏—è –Ω–∞ –ø–ª–∞–Ω —Å–ø—Ä—è–º–æ —Ä–µ–∞–ª–Ω–∏ –Ω–∞–≤–∏—Ü–∏
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç—è–≤–∞–Ω–µ –Ω–∞ —Ä–∏—Å–∫ —Å–∏—Ç—É–∞—Ü–∏–∏

#### 4.2.3 –ö–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª–Ω–∏ –¥–∞–Ω–Ω–∏ (–ù–û–í)

**–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–∞ —Å–µ —Å—ä–±–∏—Ä–∞:**
```json
{
  "userId_context": {
    "lifestyle": {
      "workType": "sedentary/active/mixed",
      "shiftWork": false,
      "travelFrequency": "low/medium/high",
      "cookingSkill": "beginner/intermediate/advanced",
      "mealPrepTime": "limited/moderate/flexible"
    },
    "social": {
      "householdSize": 2,
      "cookingForOthers": true,
      "eatingOutFrequency": "1-2x/week",
      "socialEventsFrequency": "medium"
    },
    "preferences": {
      "mealComplexity": "simple",
      "recipeVariety": "high",
      "portionPreference": "standard",
      "snackingPreference": "minimal"
    }
  }
}
```

**–†–∞–∑–º–µ—Ä:** ~2KB
**–°—ä–±–∏—Ä–∞–Ω–µ:** –ï–¥–Ω–æ –∫—Ä–∞—Ç–∫–æ –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–æ questionnaire (5-10 –≤—ä–ø—Ä–æ—Å–∞)
**–°—Ç–æ–π–Ω–æ—Å—Ç:** –°–†–ï–î–ù–ê
**–ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ:**
- –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∏ –ø–ª–∞–Ω–æ–≤–µ —Å–ø—Ä—è–º–æ lifestyle
- –ê–¥–∞–ø—Ç–∞—Ü–∏—è –Ω–∞ —Ä–µ—Ü–µ–ø—Ç–∏ —Å–ø–æ—Ä–µ–¥ cooking skill
- Flexible options –∑–∞ social events

### 4.3 –û–±–æ–±—â–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ - –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç –Ω–∞ –¥–∞–Ω–Ω–∏

| –î–∞–Ω–Ω–∏ | –¢–µ–∫—É—â —Å—Ç–∞—Ç—É—Å | –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç | –†–∞–∑–º–µ—Ä | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|-------|--------------|--------------|---------|-----------|
| Credentials | ‚úÖ –ò–º–∞ | –ö–†–ò–¢–ò–ß–ù–û | 500B | - |
| Basic Profile | ‚úÖ –ò–º–∞ | –ö–†–ò–¢–ò–ß–ù–û | 2KB | - |
| Health Conditions | ‚úÖ –ò–º–∞ | –í–ò–°–û–ö–û | –≤–∫–ª. –≤ profile | - |
| Initial Answers | ‚úÖ –ò–º–∞ | –°–†–ï–î–ù–û | 10KB ‚Üí 5KB | –û–ü–¢–ò–ú–ò–ó–ò–†–ê–ô |
| Analysis | ‚úÖ –ò–º–∞ | –í–ò–°–û–ö–û | 15KB ‚Üí 8KB | –û–ü–¢–ò–ú–ò–ó–ò–†–ê–ô |
| Final Plan | ‚úÖ –ò–º–∞ | –ö–†–ò–¢–ò–ß–ù–û | 50KB | - |
| Daily Logs | ‚úÖ –ò–º–∞ | –ö–†–ò–¢–ò–ß–ù–û | 3KB ‚Üí 1.8KB/–¥–µ–Ω | –û–ü–¢–ò–ú–ò–ó–ò–†–ê–ô |
| **Psych Tests** | ‚ùå –õ–∏–ø—Å–≤–∞ | **–í–ò–°–û–ö–û** | **~8KB** | **–î–û–ë–ê–í–ò** |
| **Behavior Patterns** | ‚ùå –õ–∏–ø—Å–≤–∞ | **–°–†–ï–î–ù–û** | **~4KB** | **–î–û–ë–ê–í–ò** |
| **Context Data** | ‚ùå –õ–∏–ø—Å–≤–∞ | **–°–†–ï–î–ù–û** | **~2KB** | **–î–û–ë–ê–í–ò** |
| analysis_macros | ‚úÖ –ò–º–∞ | –ù–ò–°–ö–û | 2KB | –ü–†–ï–ú–ê–•–ù–ò |
| plan_log | ‚úÖ –ò–º–∞ | –ù–ò–°–ö–û | 5KB | –ü–†–ï–ú–ê–•–ù–ò |
| _logs (aggregated) | ‚úÖ –ò–º–∞ | –ù–ò–°–ö–û | 50KB | –ü–†–ï–ú–ê–•–ù–ò |

**–û–±—â –µ—Ñ–µ–∫—Ç:**
- **–ü—Ä–µ–º–∞—Ö–≤–∞–Ω–µ:** ~57KB –∏–∑–ª–∏—à–Ω–∏ –¥–∞–Ω–Ω–∏
- **–î–æ–±–∞–≤—è–Ω–µ:** ~14KB —Ü–µ–Ω–Ω–∏ –¥–∞–Ω–Ω–∏
- **–ù–µ—Ç–Ω–æ —Å–ø–µ—Å—Ç—è–≤–∞–Ω–µ:** ~43KB –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª (~40%)
- **–ü–æ–¥–æ–±—Ä–µ–Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è:** –ó–ù–ê–ß–ò–¢–ï–õ–ù–û

---

## –ü–ª–∞–Ω –∑–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è

### 5.1 –§–∞–∑–∞ 1: Quick Wins (1-2 –¥–Ω–∏)

#### –ó–∞–¥–∞—á–∞ 1.1: –ü—Ä–µ–º–∞—Ö–≤–∞–Ω–µ –Ω–∞ –¥—É–±–ª–∏—Ä–∞–Ω–∏ –¥–∞–Ω–Ω–∏
```
‚úÖ action_macros –¥—É–±–ª–∏—Ä–∞ final_plan.caloriesMacros
   - UPDATE worker.js - –ø—Ä–µ–º–∞—Ö–Ω–∏ –∑–∞–ø–∏—Å–≤–∞–Ω–∏—è—Ç–∞
   - UPDATE app.js - –∏–∑–ø–æ–ª–∑–≤–∞–π —Å–∞–º–æ final_plan
   
‚úÖ _logs –¥—É–±–ª–∏—Ä–∞ individual _log_{date}
   - UPDATE worker.js - –ø—Ä–µ–º–∞—Ö–Ω–∏ aggregated logs
   - UPDATE analytics - –≥–µ–Ω–µ—Ä–∏—Ä–∞–π –¥–∏–Ω–∞–º–∏—á–Ω–æ

‚úÖ plan_log history - —Ä—è–¥–∫–æ –∏–∑–ø–æ–ª–∑–≤–∞–Ω
   - LIMIT –¥–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ç–µ 5 –∑–∞–ø–∏—Å–∞
   - –∏–ª–∏ –ü–†–ï–ú–ê–•–ù–ò –Ω–∞–ø—ä–ª–Ω–æ
```

**–°–ø–µ—Å—Ç—è–≤–∞–Ω–µ:** ~57KB/user
**–ï—Ñ–µ–∫—Ç:** –ù–µ–∑–∞–±–∞–≤–µ–Ω
**–†–∏—Å–∫:** –ù–∏—Å—ä–∫

#### –ó–∞–¥–∞—á–∞ 1.2: –ö–µ—à–∏—Ä–∞–Ω–µ –Ω–∞ Profile –∏ Prerequisites
```javascript
// js/requestCache.js - –¥–æ–±–∞–≤–∏ –Ω–æ–≤ cache
export function getProfileCache() {
  return new PersistentCache('profile_cache', 5 * 60 * 1000); // 5 min
}

// js/app.js
const profileCache = getProfileCache();
const cached = profileCache.get(`profile:${userId}`);
if (cached) {
  return cached;
}
const profile = await fetch('/api/getProfile');
profileCache.set(`profile:${userId}`, profile, 300000);
```

**–°–ø–µ—Å—Ç—è–≤–∞–Ω–µ:** ~90% –æ—Ç getProfile calls
**–ï—Ñ–µ–∫—Ç:** –ù–µ–∑–∞–±–∞–≤–µ–Ω
**–†–∏—Å–∫:** –ù–∏—Å—ä–∫

### 5.2 –§–∞–∑–∞ 2: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (3-5 –¥–Ω–∏)

#### –ó–∞–¥–∞—á–∞ 2.1: –ö–æ–º–ø–∞–∫—Ç–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ –ª–æ–≥–æ–≤–µ
```
1. –°—ä–∑–¥–∞–π migration —Ñ—É–Ω–∫—Ü–∏—è –∑–∞ v1 ‚Üí v2 —Ñ–æ—Ä–º–∞—Ç
2. UPDATE worker.js - API –∑–∞ –∑–∞–ø–∏—Å –≤ v2
3. UPDATE js/app.js - —á–µ—Ç–µ–Ω–µ –Ω–∞ v1 –∏ v2
4. Background migration –Ω–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏ –ª–æ–≥–æ–≤–µ
```

**–°–ø–µ—Å—Ç—è–≤–∞–Ω–µ:** ~40% –æ—Ç log —Ä–∞–∑–º–µ—Ä
**–ï—Ñ–µ–∫—Ç:** –°—Ä–µ–¥–Ω–æ—Å—Ä–æ—á–µ–Ω (—Å–ª–µ–¥ migration)
**–†–∏—Å–∫:** –°—Ä–µ–¥–µ–Ω

#### –ó–∞–¥–∞—á–∞ 2.2: Combined Dashboard API
```
–ù–æ–≤ endpoint: POST /api/getDashboardData
- –ö–æ–º–±–∏–Ω–∏—Ä–∞ prerequisites + plan + analytics + dailyLog
- 1 –∑–∞—è–≤–∫–∞ –≤–º–µ—Å—Ç–æ 4

UPDATE js/app.js - –∏–∑–ø–æ–ª–∑–≤–∞–π –Ω–æ–≤–∏—è endpoint
```

**–°–ø–µ—Å—Ç—è–≤–∞–Ω–µ:** 3 API calls –ø—Ä–∏ –≤—Å—è–∫–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ
**–ï—Ñ–µ–∫—Ç:** –ù–µ–∑–∞–±–∞–≤–µ–Ω —Å–ª–µ–¥ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è
**–†–∏—Å–∫:** –ù–∏—Å—ä–∫

### 5.3 –§–∞–∑–∞ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞ –ø—Å–∏—Ö–æ–º–µ—Ç—Ä–∏—á–Ω–∏ –¥–∞–Ω–Ω–∏ (5-7 –¥–Ω–∏)

#### –ó–∞–¥–∞—á–∞ 3.1: Backend sync –∑–∞ psych tests
```
1. –ù–æ–≤ endpoint: POST /api/savePsychTests
2. UPDATE psy/*.html - sync –ø—Ä–∏ –∑–∞–≤—ä—Ä—à–≤–∞–Ω–µ
3. UPDATE worker.js - –∑–∞–ø–∞–∑–≤–∞–Ω–µ –≤ KV
4. UPDATE analyzeQuestionnaire - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```

**–î–æ–±–∞–≤–∫–∞:** ~8KB/user –¥–∞–Ω–Ω–∏
**–°—Ç–æ–π–Ω–æ—Å—Ç:** –í–ò–°–û–ö–ê –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è
**–†–∏—Å–∫:** –ù–∏—Å—ä–∫

#### –ó–∞–¥–∞—á–∞ 3.2: AI prompt –∞–¥–∞–ø—Ç–∞—Ü–∏—è
```
1. UPDATE prompts - –¥–æ–±–∞–≤–∏ psych —Å–µ–∫—Ü–∏—è
2. UPDATE plan generation - –≤–∫–ª—é—á–∏ psych –¥–∞–Ω–Ω–∏
3. UPDATE chat assistant - –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω —Å—Ç–∏–ª
```

**–ï—Ñ–µ–∫—Ç:** –ü–æ-–¥–æ–±—Ä–∞ AI –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª–∏–∑–∞—Ü–∏—è
**–†–∏—Å–∫:** –°—Ä–µ–¥–µ–Ω (—Ç—Ä—è–±–≤–∞ —Ç–µ—Å—Ç–≤–∞–Ω–µ)

### 5.4 –§–∞–∑–∞ 4: Advanced –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ, 5-10 –¥–Ω–∏)

#### –ó–∞–¥–∞—á–∞ 4.1: LZ-String –∫–æ–º–ø—Ä–µ—Å–∏—è
```
1. –î–æ–±–∞–≤–∏ lz-string library
2. –ö–æ–º–ø—Ä–µ—Å–∏—Ä–∞–π –ª–æ–≥–æ–≤–µ > 7 –¥–Ω–∏
3. Background migration
```

**–°–ø–µ—Å—Ç—è–≤–∞–Ω–µ:** –î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ ~50% –æ—Ç log —Ä–∞–∑–º–µ—Ä
**–ï—Ñ–µ–∫—Ç:** –î—ä–ª–≥–æ—Å—Ä–æ—á–µ–Ω
**–†–∏—Å–∫:** –ù–∏—Å—ä–∫

#### –ó–∞–¥–∞—á–∞ 4.2: Weekly aggregates
```
1. Cron job –∑–∞ weekly aggregation
2. UPDATE analytics - –∏–∑–ø–æ–ª–∑–≤–∞–π aggregates
3. Fallback –∫—ä–º individual logs
```

**–°–ø–µ—Å—Ç—è–≤–∞–Ω–µ:** ~85% –æ—Ç analytics KV reads
**–ï—Ñ–µ–∫—Ç:** –°—Ä–µ–¥–Ω–æ—Å—Ä–æ—á–µ–Ω
**–†–∏—Å–∫:** –°—Ä–µ–¥–µ–Ω

### 5.5 –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–Ω–æ—Å—Ç

**–ü—Ä–µ–ø–æ—Ä—ä—á–∏—Ç–µ–ª–µ–Ω —Ä–µ–¥ –Ω–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ:**

```
–°–ü–†–ò–ù–¢ 1 (–°–µ–¥–º–∏—Ü–∞ 1):
‚îú‚îÄ‚îÄ –ü—Ä–µ–º–∞—Ö–≤–∞–Ω–µ –Ω–∞ –¥—É–±–ª–∏—Ä–∞–Ω–∏ –¥–∞–Ω–Ω–∏      [–ó–∞–¥–∞—á–∞ 1.1]  ‚úÖ –í–∏—Å–æ–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
‚îú‚îÄ‚îÄ –ö–µ—à–∏—Ä–∞–Ω–µ –Ω–∞ Profile                [–ó–∞–¥–∞—á–∞ 1.2]  ‚úÖ –í–∏—Å–æ–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
‚îî‚îÄ‚îÄ Combined Dashboard API             [–ó–∞–¥–∞—á–∞ 2.2]  ‚úÖ –í–∏—Å–æ–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

–°–ü–†–ò–ù–¢ 2 (–°–µ–¥–º–∏—Ü–∞ 2):
‚îú‚îÄ‚îÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞ psych tests          [–ó–∞–¥–∞—á–∞ 3.1]  üéØ –ö–ª—é—á–æ–≤ feature
‚îú‚îÄ‚îÄ AI prompt –∞–¥–∞–ø—Ç–∞—Ü–∏—è                [–ó–∞–¥–∞—á–∞ 3.2]  üéØ –ö–ª—é—á–æ–≤ feature
‚îî‚îÄ‚îÄ –ö–æ–º–ø–∞–∫—Ç–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤–µ         [–ó–∞–¥–∞—á–∞ 2.1]  üîß –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞

–°–ü–†–ò–ù–¢ 3 (–û–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ):
‚îú‚îÄ‚îÄ LZ-String –∫–æ–º–ø—Ä–µ—Å–∏—è                [–ó–∞–¥–∞—á–∞ 4.1]  ‚ö° Performance
‚îî‚îÄ‚îÄ Weekly aggregates                  [–ó–∞–¥–∞—á–∞ 4.2]  ‚ö° Performance
```

---

## –†–µ–∑—é–º–µ –∏ –∫–ª—é—á–æ–≤–∏ –º–µ—Ç—Ä–∏–∫–∏

### üìä –û—á–∞–∫–≤–∞–Ω–∏ –ø–æ–¥–æ–±—Ä–µ–Ω–∏—è

| –ú–µ—Ç—Ä–∏–∫–∞ | –ü—Ä–µ–¥–∏ | –°–ª–µ–¥ | –ü–æ–¥–æ–±—Ä–µ–Ω–∏–µ |
|---------|-------|------|------------|
| **Storage/user** | ~140KB | ~97KB | **-31%** |
| **API calls/session** | ~71 | ~8 | **-89%** |
| **Log size** | 3KB/–¥–µ–Ω | 1.8KB/–¥–µ–Ω | **-40%** |
| **Dashboard load time** | 2.5s | 0.8s | **-68%** |
| **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è** | –ë–∞–∑–æ–≤–∞ | –ù–∞–ø—Ä–µ–¥–Ω–∞–ª–∞ | **++++** |

### ‚úÖ –ö–ª—é—á–æ–≤–∏ –ø—Ä–µ–ø–æ—Ä—ä–∫–∏

1. **–ö–†–ò–¢–ò–ß–ù–û - –ü—Ä–µ–º–∞—Ö–Ω–∏ –¥—É–±–ª–∏—Ä–∞–Ω–∏ –¥–∞–Ω–Ω–∏**
   - analysis_macros
   - _logs aggregated
   - –ó–∞—Å—Ç–∞—Ä—è–ª–∞ plan_log history
   
2. **–í–ò–°–û–ö–û - –î–æ–±–∞–≤–∏ –ø—Å–∏—Ö–æ–º–µ—Ç—Ä–∏—á–Ω–∏ –¥–∞–Ω–Ω–∏**
   - Sync –Ω–∞ psych tests –∫—ä–º backend
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ plan generation
   - –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ AI
   
3. **–í–ò–°–û–ö–û - –û–ø—Ç–∏–º–∏–∑–∏—Ä–∞–π API calls**
   - Combined dashboard endpoint
   - Aggressive caching
   - Smart invalidation
   
4. **–°–†–ï–î–ù–û - –ö–æ–º–ø–∞–∫—Ç–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ –ª–æ–≥–æ–≤–µ**
   - v2 —Ñ–æ—Ä–º–∞—Ç —Å –∫—ä—Å–∏ –∫–ª—é—á–æ–≤–µ
   - Enum values –≤–º–µ—Å—Ç–æ strings
   - –û–ø—Ü–∏–æ–Ω–∞–ª–Ω–∞ –∫–æ–º–ø—Ä–µ—Å–∏—è

### üéØ –ë–∏–∑–Ω–µ—Å —Å—Ç–æ–π–Ω–æ—Å—Ç

**–ù–∞–º–∞–ª–µ–Ω–∏ —Ä–∞–∑—Ö–æ–¥–∏:**
- KV storage: -31% ‚Üí ~$X/month —Å–ø–µ—Å—Ç—è–≤–∞–Ω–∏—è
- KV operations: -89% ‚Üí ~$Y/month —Å–ø–µ—Å—Ç—è–≤–∞–Ω–∏—è
- Bandwidth: -40% ‚Üí –ø–æ-–±—ä—Ä–∑–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ

**–ü–æ–¥–æ–±—Ä–µ–Ω UX:**
- –ü–æ-–±—ä—Ä–∑–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ (0.8s –≤–º–µ—Å—Ç–æ 2.5s)
- Offline —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç –±–µ–∑ –∫–æ–º–ø—Ä–æ–º–∏—Å–∏
- –ü–æ-–ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ –ø—Ä–µ–ø–æ—Ä—ä–∫–∏

**–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ –ø—Ä–µ–¥–∏–º—Å—Ç–≤–æ:**
- –ù–∞–π-–Ω–∞–ø—Ä–µ–¥–Ω–∞–ª–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ç–∞
- –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–∞–Ω–µ
- Predictive insights

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç—ä—Ç **BodyBest** –∏–º–∞ —Å–æ–ª–∏–¥–Ω–∞ offline-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –Ω–æ –∏–º–∞ –∑–Ω–∞—á–∏—Ç–µ–ª–Ω–∏ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤ —Ç—Ä–∏ –∫–ª—é—á–æ–≤–∏ –æ–±–ª–∞—Å—Ç–∏:

1. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ –¥–∞–Ω–Ω–∏—Ç–µ** - –ü—Ä–µ–º–∞—Ö–≤–∞–Ω–µ –Ω–∞ 30% –∏–∑–ª–∏—à–Ω–∏ –¥–∞–Ω–Ω–∏
2. **API efficiency** - –ù–∞–º–∞–ª—è–≤–∞–Ω–µ –Ω–∞ calls —Å 89%
3. **–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª–∏–∑–∞—Ü–∏—è** - –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –ø—Å–∏—Ö–æ–º–µ—Ç—Ä–∏—á–Ω–∏ –¥–∞–Ω–Ω–∏ –∑–∞ –Ω–∞–ø—Ä–µ–¥–Ω–∞–ª–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è

–ü—Ä–µ–ø–æ—Ä—ä—á–≤–∞–Ω–∏—è—Ç –ø–ª–∞–Ω –∑–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –µ —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ 3 —Å–ø—Ä–∏–Ω—Ç–∞, –∫–∞—Ç–æ –ø—ä—Ä–≤–∏—Ç–µ –¥–≤–µ —Å–µ–¥–º–∏—Ü–∏ –¥–∞–≤–∞—Ç –Ω–∞–π-–≥–æ–ª—è–º–∞—Ç–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç —Å –Ω–∞–π-–Ω–∏—Å—ä–∫ —Ä–∏—Å–∫.

**–û–±—â –µ—Ñ–µ–∫—Ç:** –ó–Ω–∞—á–∏—Ç–µ–ª–Ω–æ –ø–æ–¥–æ–±—Ä—è–≤–∞–Ω–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–Ω–æ—Å—Ç, —Ä–∞–∑—Ö–æ–¥–∏ –∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–æ –∏–∑–∂–∏–≤—è–≤–∞–Ω–µ.

---

**–°—ä–∑–¥–∞–¥–µ–Ω–æ:** 2024-12-17  
**–ê–≤—Ç–æ—Ä:** GitHub Copilot Coding Agent  
**–°—Ç–∞—Ç—É—Å:** Draft –∑–∞ review –∏ –æ–¥–æ–±—Ä–µ–Ω–∏–µ
