# Журнал на последните промени

> Файлът се генерира автоматично от `docs/change-log-data.json` чрез `npm run log:generate`. Не редактирайте ръчно.

## 18.09.2025 г., 17:51:18 UTC · Въведена е автоматична система за генерация на журнал и начални данни.

- **Commit:** `5dbf589e`
- **Заявка / Request:** Активирай автоматичния журнал и запиши първия му запис за проследяване на задачите.
- **Причина:** Нуждаем се от устойчив процес за документиране на комитите и анализ на засегнатите файлове.

- **Засегнати файлове:** 4
- **Добавени редове:** 195
- **Изтрити редове:** 1

| Файл | Добавени | Изтрити | Бележка |
| --- | --- | --- | --- |
| `docs/change-log-data.json` | +15 | -0 | JSON източник с първия запис в журнала (пример: commit 65fe4750). |
| `docs/change-log.md` | +21 | -0 | Генериран Markdown изглед на журнала за преглед на екипа. |
| `package.json` | +2 | -1 | Добавена npm команда `log:generate` за лесно обновяване. |
| `scripts/generateChangeLog.js` | +157 | -0 | Нов скрипт, който вика `git show --numstat` и създава таблица с промените. |

## 18.09.2025 г., 17:04:42 UTC · Позволена е смяна на callModel през setCallModelImplementation и обновени тестове.

- **Commit:** `de4a2b89`
- **Заявка / Request:** Направи AI извикванията за генериране на план mockable, за да стабилизираме тестовете.
- **Причина:** Трябва да контролираме отговорите на модела в unit тестовете и да избегнем реални заявки.

- **Засегнати файлове:** 2
- **Добавени редове:** 74
- **Изтрити редове:** 71

| Файл | Добавени | Изтрити | Бележка |
| --- | --- | --- | --- |
| `tests/processSingleUserPlan.spec.js` | +56 | -60 | Споделен `callModelMock` и предварително дефинирани отговори за различни сценарии. |
| `worker.js` | +18 | -11 | Въведен `callModelRef.current` и нов `setCallModelImplementation` за инжектиране при тест (пример: callModelRef.current(...)). |

## 18.09.2025 г., 16:41:42 UTC · Оптимизирано е записването на дневници с проверка за промени и нов флаг updated.

- **Commit:** `eeaa3591`
- **Заявка / Request:** Оптимизирай handleLogRequest, така че да пропуска неизменени дневници и да маркира обновяванията.
- **Причина:** Нужно е да ограничим излишните KV операции и да пазим по-точен статус за клиента.

- **Засегнати файлове:** 2
- **Добавени редове:** 119
- **Изтрити редове:** 27

| Файл | Добавени | Изтрити | Бележка |
| --- | --- | --- | --- |
| `tests/handleLogRequest.spec.js` | +58 | -0 | Нов тест, който доказва, че второ идентично искане не записва повторно (пример: expect(...updated).toBe(false)). |
| `worker.js` | +61 | -27 | Добавена проверка `payloadChanged` и условни `put` операции за дневник и current_status. |

## 17.09.2025 г., 23:46:43 UTC · Въведен е буферен механизъм за плановите логове и нови тестови сценарии.

- **Commit:** `14f503ab`
- **Заявка / Request:** Буферирай логовете за обработка на план и регистрирай грешките при запис.
- **Причина:** Трябва да предотвратим загубата на логове при KV грешки и да намалим броя записи.

- **Засегнати файлове:** 2
- **Добавени редове:** 234
- **Изтрити редове:** 152

| Файл | Добавени | Изтрити | Бележка |
| --- | --- | --- | --- |
| `tests/processSingleUserPlan.spec.js` | +198 | -137 | Рефакторирани помощни функции и добавени сценарии за буфериране (пример: flushLog('start')). |
| `worker.js` | +36 | -15 | Добавено `logBuffer` с условно `flushLog` и записване на грешки при KV откази. |

## 17.09.2025 г., 23:32:47 UTC · Добавен е базов unit тест за processSingleUserPlan с пълна проверка на логовете.

- **Commit:** `d63b9c87`
- **Заявка / Request:** Покрий процеса за генериране на план с тест за успешния сценарий и логовете.
- **Причина:** Искаме регресионна защита, че ключовите стъпки на плановия процес се проследяват коректно.

- **Засегнати файлове:** 1
- **Добавени редове:** 191
- **Изтрити редове:** 0

| Файл | Добавени | Изтрити | Бележка |
| --- | --- | --- | --- |
| `tests/processSingleUserPlan.spec.js` | +191 | -0 | Нов тест, който моква fetch и проверява, че логът съдържа стъпки като 'Старт на генериране'. |

