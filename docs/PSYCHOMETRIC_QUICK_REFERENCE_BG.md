# –ë—ä—Ä–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫: –ü—Å–∏—Ö–æ–º–µ—Ç—Ä–∏—á–Ω–∞ –∞–¥–∞–ø—Ç–∞—Ü–∏—è –Ω–∞ –ø–ª–∞–Ω–∞

> **v2.0 REVISED** - –ê–¥—Ä–µ—Å–∏—Ä–∞–Ω–∏ —Ä–∏—Å–∫–æ–≤–µ, –æ–ø—Ä–æ—Å—Ç–µ–Ω–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç  
> **–ö—Ä–∞—Ç–∫–æ —Ä—ä–∫–æ–≤–æ–¥—Å—Ç–≤–æ** –∑–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏—Ü–∏, —Ä–∞–±–æ—Ç–µ—â–∏ —Å –ø—Å–∏—Ö–æ–º–µ—Ç—Ä–∏—á–Ω–∞—Ç–∞ –∞–¥–∞–ø—Ç–∞—Ü–∏—è –Ω–∞ `final_plan`

---

## ‚ö†Ô∏è –í–∞–∂–Ω–∏ –ø—Ä–æ–º–µ–Ω–∏ –≤ v2.0

1. **16 —Ç–∏–ø–∞ ‚Üí 8 —Ä–µ–∂–∏–º–∞**: –û–ø—Ä–æ—Å—Ç–µ–Ω–∞ –ø–æ–¥–¥—Ä—ä–∂–∫–∞
2. **Concordance-–±–∞–∑–∏—Ä–∞–Ω–∞ –ª–æ–≥–∏–∫–∞**: high/medium/low ‚Üí —Ä–∞–∑–ª–∏—á–Ω–∏ –¥–µ–π—Å—Ç–≤–∏—è
3. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∏**: –¢–µ—Å—Ç–æ–≤–µ –≤–ª–∏—è—è—Ç –Ω–∞ –ö–ê–ö, –ù–ï –Ω–∞ –ö–ê–ö–í–û (–∫–∞–ª–æ—Ä–∏–∏/–º–∞–∫—Ä–æ—Å–∏)
4. **–ú–∏–Ω–∏–º–∞–ª–µ–Ω –≤—Ö–æ–¥**: –°–∞–º–æ –∫–ª—é—á–æ–≤–µ –∫—ä–º AI, –Ω–µ –¥—ä–ª–≥–∏ —Ç–µ–∫—Å—Ç–æ–≤–µ
5. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ä–∏—Å–∫–æ–≤–µ**: Concrete –º–∏—Ç–∏–≥–∞—Ü–∏–∏

---

## üìã –û—Å–Ω–æ–≤–Ω–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∏ (1 ‚Üí 2 ‚Üí 3)

```
1Ô∏è‚É£ –ë–ê–ó–ê (–ö–ê–ö–í–û) ‚Üê initial_answers
   ‚îî‚îÄ –ö–∞–ª–æ—Ä–∏–∏, –º–∞–∫—Ä–æ—Å–∏, —Ü–µ–ª, –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
   
2Ô∏è‚É£ –°–¢–ò–õ (–ö–ê–ö) ‚Üê –ü—Å–∏—Ö–æ-—Ç–µ—Å—Ç–æ–≤–µ
   ‚îî‚îÄ –ö–æ–º—É–Ω–∏–∫–∞—Ü–∏—è, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –≥—ä–≤–∫–∞–≤–æ—Å—Ç
   
3Ô∏è‚É£ –ü–†–ï–î–ü–ê–ó–ò–¢–ï–õ–ò ‚Üê Correlation
   ‚îî‚îÄ Risk areas, coping strategies
```

### Concordance Levels

```
‚â• 0.75  ‚Üí  "high"     ‚Üí FULL adaptation ‚úÖ
‚â• 0.55  ‚Üí  "medium"   ‚Üí COMMUNICATION only ‚ö†Ô∏è
< 0.55  ‚Üí  "low"      ‚Üí NO adaptation + 7-day observation ‚ùå
```

### –¢–µ–≥–ª–∞ (–°–ê–ú–û –ø—Ä–∏ high concordance)

```
High (‚â•0.75):    70% personality + 30% visual
Medium (0.55-0.74): 100% personality, 0% visual
Low (<0.55):      NO psycho-tests
```

---

## üéØ 8 –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω–∏ —Ä–µ–∂–∏–º–∞ (–Ω–µ 16 —Ç–∏–ø–∞)

### –ì—Ä—É–ø–∏—Ä–∞–Ω–µ

```
4 Communication Styles √ó 2 Structure Needs = 8 Modes
```

| –†–µ–∂–∏–º | –í–∫–ª—é—á–≤–∞ —Ç–∏–ø–æ–≤–µ | –¢–æ–Ω | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ |
|-------|----------------|-----|-----------|
| **DIRECT_STRUCTURED** | X-S-D-J, E-S-D-J | Directive | High |
| **DIRECT_FLEXIBLE** | X-S-D-P, E-S-D-P | Directive | Low |
| **SUPPORTIVE_STRUCTURED** | X-S-M-J, E-S-M-J | Gentle | High |
| **SUPPORTIVE_FLEXIBLE** | X-S-M-P, E-S-M-P | Gentle | Low |
| **STRATEGIC_STRUCTURED** | X-V-D-J, E-V-D-J | Analytical | High |
| **STRATEGIC_FLEXIBLE** | X-V-D-P | Analytical | Low |
| **EMPATHETIC_STRUCTURED** | X-V-M-J, E-V-M-J | Understanding | High |
| **EMPATHETIC_FLEXIBLE** | X-V-M-P, E-V-M-P | Understanding | Low |

### –ë—ä—Ä–∑–∞ reference —Ç–∞–±–ª–∏—Ü–∞

| –†–µ–∂–∏–º | –î—ä–ª–∂–∏–Ω–∞ | –ß–µ—Å—Ç–æ—Ç–∞ | Risk Areas | Coping |
|-------|---------|---------|------------|--------|
| DIRECT_STRUCTURED | Short | Moderate | over_control | planned_flexibility |
| DIRECT_FLEXIBLE | Short | Low | meal_skipping | anchor_meals |
| SUPPORTIVE_STRUCTURED | Medium | High | fear_of_change | gradual_changes |
| SUPPORTIVE_FLEXIBLE | Medium | High | external_eating | saying_no |
| STRATEGIC_STRUCTURED | Long | Low | over_optimization | pleasure_integration |
| STRATEGIC_FLEXIBLE | Medium | Low | diet_hopping | time_boxed_trials |
| EMPATHETIC_STRUCTURED | Medium | Moderate | overthinking | simplification |
| EMPATHETIC_FLEXIBLE | Medium | High | emotional_eating | emotion_work |

---

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ adaptedGuidance - –û–ü–†–û–°–¢–ï–ù–ê

### –ü—Ä–∏ high concordance (‚â•0.75)

```json
{
  "adaptedGuidance": {
    "concordanceLevel": "high",
    "adaptationLevel": "full",
    "communicationMode": "DIRECT_STRUCTURED",
    "keys": {
      "tone": "directive",
      "length": "short",
      "frequency": "moderate",
      "structure": "high",
      "flexibility": "low"
    },
    "riskAreas": ["over_control"],
    "coping": ["planned_flexibility"]
  }
}
```

### –ü—Ä–∏ medium concordance (0.55-0.74)

```json
{
  "adaptedGuidance": {
    "concordanceLevel": "medium",
    "adaptationLevel": "communication_only",
    "communicationMode": "SUPPORTIVE_STRUCTURED",
    "keys": {
      "tone": "gentle",
      "length": "medium"
      // –ù–ï —Å–µ –ø–æ–¥–∞–≤–∞—Ç structure, flexibility
    }
  }
}
```

### –ü—Ä–∏ low concordance (<0.55)

```json
{
  "adaptedGuidance": {
    "concordanceLevel": "low",
    "adaptationLevel": "none",
    "observationMode": true,
    "observationDays": 7
  }
}
```

---

## üí¨ –ö–æ–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω–∏ –ø—Ä–∏–º–µ—Ä–∏

### High concordance - –ø—ä–ª–Ω–∞ –∞–¥–∞–ø—Ç–∞—Ü–∏—è

**DIRECT_STRUCTURED**:
> "–õ–æ–≥–Ω–∞—Ö –¥–Ω–µ–≤–Ω–∏—Ç–µ —Ç–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è. –î–Ω–µ—Å –ø—Ä–æ–ø—É—Å–Ω–∞ –æ–±—è–¥–∞ - –Ω–µ–∫–∞ –≥–æ –¥–æ–±–∞–≤–∏–º —Å–µ–≥–∞."

**EMPATHETIC_FLEXIBLE**:
> "–í–∏–∂–¥–∞–º, —á–µ –¥–Ω–µ—Å –µ –±–∏–ª —Ç—Ä—É–¥–µ–Ω. –ö–∞–∫ —Å–µ —á—É–≤—Å—Ç–≤–∞—à? –ò—Å–∫–∞—à –ª–∏ –¥–∞ –≥–æ–≤–æ—Ä–∏–º –∑–∞ –ø–ª–∞–Ω–∞?"

### Medium concordance - —Å–∞–º–æ –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è

**SUPPORTIVE —Ä–µ–∂–∏–º** (–ë–ï–ó —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∏ –ø—Ä–æ–º–µ–Ω–∏):
> "–ó–¥—Ä–∞–≤–µ–π üëã –í–∏–∂–¥–∞–º, —á–µ —Ö—Ä–∞–Ω–µ–Ω–∏—è—Ç–∞ —Å–∞ —Ä–∞–∑–ª–∏—á–Ω–∏ –æ—Ç –æ–±–∏—á–∞–π–Ω–æ—Ç–æ - —Ç–æ–≤–∞ –µ OK."

### Low concordance - generic

> "–î–æ–±—ä—Ä –¥–µ–Ω! –ò–º–∞—à –ª–∏ –≤—ä–ø—Ä–æ—Å–∏ –∑–∞ –ø–ª–∞–Ω–∞ –¥–Ω–µ—Å?"

---

## üîß API Endpoints

### –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ composite profile
```javascript
POST /api/generateCompositeProfile
Body: { userId: "user123" }

Response: {
  success: true,
  data: {
    compositeProfile: {...},
    concordanceLevel: "high|medium|low",
    shouldRegeneratePlan: true
  }
}
```

### KV –∫–ª—é—á–æ–≤–µ
```
{userId}_composite_profile     // –û–±–µ–¥–∏–Ω–µ–Ω –ø—Ä–æ—Ñ–∏–ª
{userId}_correlation_history   // –ò—Å—Ç–æ—Ä–∏—è –Ω–∞ –∫–æ—Ä–µ–ª–∞—Ü–∏–∏
{userId}_psycho_regeneration_pending  // –§–ª–∞–≥ –∑–∞ —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ
```

---

## üìà Decision Tree

```
calculateCorrelationScore()
   ‚Üì
   ‚îú‚îÄ score >= 0.75? ‚Üí HIGH
   ‚îÇ   ‚îî‚îÄ‚Üí Apply full adaptation (8 modes + structure)
   ‚îÇ
   ‚îú‚îÄ score >= 0.55? ‚Üí MEDIUM
   ‚îÇ   ‚îî‚îÄ‚Üí Apply communication only (8 modes, NO structure)
   ‚îÇ
   ‚îî‚îÄ score < 0.55? ‚Üí LOW
       ‚îî‚îÄ‚Üí NO adaptation (generic + 7-day observation)
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω–∏ –ø—Ä–∞–≤–∏–ª–∞

### –ü—Ä–∞–≤–∏–ª–æ 1: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∏
```
initial_answers (–±–∞–∑–∞) > –ø—Å–∏—Ö–æ-—Ç–µ—Å—Ç–æ–≤–µ (—Å—Ç–∏–ª)
```

### –ü—Ä–∞–≤–∏–ª–æ 2: –ü—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç
```
–ù–ï —Å–º–µ–Ω—è–π —Ü–µ–ª—Ç–∞, —Å–º–µ–Ω–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –Ω–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ
```

### –ü—Ä–∞–≤–∏–ª–æ 3: Immutable –ø–æ–ª–µ—Ç–∞
```
caloriesMacros   ‚Üê –ù–ï –°–ï –ü–†–û–ú–ï–ù–Ø
goal             ‚Üê –ù–ï –°–ï –ü–†–û–ú–ï–ù–Ø
medicalConditions ‚Üê –ù–ï –°–ï –ü–†–û–ú–ï–ù–Ø
```

### –ü—Ä–∞–≤–∏–ª–æ 4: AI –≤—Ö–æ–¥
```
‚úÖ –ü–æ–¥–∞–≤–∞–π: –∫–ª—é—á–æ–≤–µ (tone, structure, flexibility)
‚ùå –ù–ï –ø–æ–¥–∞–≤–∞–π: –¥—ä–ª–≥–∏ —Ç–µ–∫—Å—Ç–æ–≤–µ, –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∏
```

---

## üöÄ Quick Start –∑–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏—Ü–∏

### 1. –ò–∑–≤–ª–∏—á–∞–Ω–µ –Ω–∞ –¥–∞–Ω–Ω–∏
```javascript
const initialAnswers = await env.USER_METADATA_KV.get(`${userId}_initial_answers`, 'json');
const psychTests = await env.USER_METADATA_KV.get(`${userId}_psych_tests`, 'json');
```

### 2. –ò–∑—á–∏—Å–ª—è–≤–∞–Ω–µ –Ω–∞ –∫–æ—Ä–µ–ª–∞—Ü–∏—è
```javascript
const correlationScore = calculateCorrelationScore(
  initialAnswers, 
  psychTests.personalityTest
);

const concordanceLevel = 
  correlationScore >= 0.75 ? 'high' :
  correlationScore >= 0.55 ? 'medium' : 'low';
```

### 3. Decision point
```javascript
if (concordanceLevel === 'low') {
  // NO adaptation, 7-day observation
  return { adaptationLevel: 'none', observationMode: true };
}

if (concordanceLevel === 'medium') {
  // ONLY communication
  return {
    adaptationLevel: 'communication_only',
    communicationMode: mapToMode(psychTests.personalityTest.typeCode),
    keys: { tone: '...', length: '...' }
  };
}

// HIGH - full adaptation
return {
  adaptationLevel: 'full',
  communicationMode: mapToMode(psychTests.personalityTest.typeCode),
  keys: { tone: '...', length: '...', structure: '...', flexibility: '...' },
  riskAreas: [...],
  coping: [...]
};
```

### 4. Mapping 16 —Ç–∏–ø–∞ ‚Üí 8 —Ä–µ–∂–∏–º–∞
```javascript
function mapToMode(typeCode) {
  // Extract last 2 letters: communication + structure
  const communication = typeCode[2]; // D or M
  const structure = typeCode[3];     // J or P
  
  // Extract first 2 for additional context
  const energy = typeCode[0];        // X or E
  const innovation = typeCode[1];    // S or V
  
  // Determine communication style
  let style;
  if ((communication === 'D') && (innovation === 'S')) style = 'DIRECT';
  else if ((communication === 'M') && (innovation === 'S')) style = 'SUPPORTIVE';
  else if ((communication === 'D') && (innovation === 'V')) style = 'STRATEGIC';
  else if ((communication === 'M') && (innovation === 'V')) style = 'EMPATHETIC';
  
  // Determine structure need
  const structureNeed = (structure === 'J') ? 'STRUCTURED' : 'FLEXIBLE';
  
  return `${style}_${structureNeed}`;
}
```

---

## üìö –î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ —Ä–µ—Å—É—Ä—Å–∏

- **–ü—ä–ª–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [`PSYCHOMETRIC_PLAN_ADAPTATION_PROPOSAL_BG.md`](./PSYCHOMETRIC_PLAN_ADAPTATION_PROPOSAL_BG.md)
- **–ü—Å–∏—Ö–æ —Ç–µ—Å—Ç–æ–≤–µ**: [`psycho_tests_to_final_plan.md`](./psycho_tests_to_final_plan.md)
- **–ö–æ—Ä–µ–ª–∞—Ü–∏–æ–Ω–µ–Ω –∞–Ω–∞–ª–∏–∑**: [`QUESTIONNAIRE_ANALYSIS_CORRELATION.md`](./QUESTIONNAIRE_ANALYSIS_CORRELATION.md)
- **–ü–æ–¥–æ–±—Ä–µ–Ω–∏—è**: [`PSYCHO_TEST_IMPROVEMENTS.md`](./PSYCHO_TEST_IMPROVEMENTS.md)

---

**–í–µ—Ä—Å–∏—è**: 1.0.0  
**–î–∞—Ç–∞**: 2024-12-16  
**–ê–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è**: –ü—Ä–∏ –ø—Ä–æ–º–µ–Ω–∏ –≤ –æ—Å–Ω–æ–≤–Ω–∞—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
