# –ü–æ–ø—Ä–∞–≤–∫–∞ –Ω–∞ planModificationBtn - –†–µ–∑—é–º–µ (–ë–ì)

## –ü—Ä–æ–±–ª–µ–º
–ë—É—Ç–æ–Ω—ä—Ç "–ü—Ä–æ–º–µ–Ω–∏ –ø–ª–∞–Ω" (`planModificationBtn`) –ø–æ–∫–∞–∑–≤–∞—à–µ —Å—ä–æ–±—â–µ–Ω–∏—è –∑–∞ —É—Å–ø–µ—Ö, –Ω–æ **–Ω–µ –ø—Ä–æ–º–µ–Ω—è—à–µ —Ä–µ–∞–ª–Ω–æ –ø–ª–∞–Ω–∞**. –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏—Ç–µ –æ–ø–∏—Å–≤–∞—Ö–∞ –∂–µ–ª–∞–Ω–∏—Ç–µ –ø—Ä–æ–º–µ–Ω–∏, –ø–æ–ª—É—á–∞–≤–∞—Ö–∞ –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ, –Ω–æ –ø–ª–∞–Ω—ä—Ç –æ—Å—Ç–∞–≤–∞—à–µ –Ω–µ–ø—Ä–æ–º–µ–Ω–µ–Ω.

## –û—Å–Ω–æ–≤–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞
AI –ø—Ä–æ–º–ø—Ç—ä—Ç –ø–∏—Ç–∞—à–µ "–∏–∑–≤–ª–µ—á–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–∞–Ω–∏ –¥–∞–Ω–Ω–∏" –≤–º–µ—Å—Ç–æ "–≥–µ–Ω–µ—Ä–∏—Ä–∞–π –ø—Ä–æ–º–µ–Ω–µ–Ω–æ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ". –¢–æ–≤–∞ –≤–æ–¥–µ—à–µ –¥–æ –ø—Ä–∞–∑–Ω–∏ –∏–ª–∏ –Ω–µ–ø—ä–ª–Ω–∏ –ø—Ä–æ–º–µ–Ω–∏.

## –†–µ—à–µ–Ω–∏–µ

### 1. –ü—Ä–µ—Ä–∞–±–æ—Ç–µ–Ω AI –ü—Ä–æ–º–ø—Ç ‚úÖ
- **–ü—Ä–µ–¥–∏**: "–ê–Ω–∞–ª–∏–∑–∏—Ä–∞–π –∏ –∏–∑–≤–ª–µ—á–∏ –ø—Ä–æ–º–µ–Ω–∏"
- **–°–µ–≥–∞**: "–ì–µ–Ω–µ—Ä–∏—Ä–∞–π –ö–û–ù–ö–†–ï–¢–ù–ò –ø—Ä–æ–º–µ–Ω–∏ —Å —Ä–µ–∞–ª–Ω–∏ —è—Å—Ç–∏—è"
- –î–æ–±–∞–≤–µ–Ω–∏ 3 –¥–µ—Ç–∞–π–ª–Ω–∏ –ø—Ä–∏–º–µ—Ä–∞
- –Ø—Å–Ω–∏ –∏–∑–∏—Å–∫–≤–∞–Ω–∏—è –∑–∞ —Ñ–æ—Ä–º–∞—Ç –Ω–∞ –æ—Ç–≥–æ–≤–æ—Ä–∞

### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è ‚úÖ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ AI –≥–µ–Ω–µ—Ä–∏—Ä–∞ —Ä–µ–∞–ª–Ω–∏ –ø—Ä–æ–º–µ–Ω–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ –ø–ª–∞–Ω—ä—Ç –µ —Ä–∞–∑–ª–∏—á–µ–Ω —Å–ª–µ–¥ –ø—Ä–æ–º—è–Ω–∞—Ç–∞
- –ü–æ-–¥–æ–±—Ä–∏ —Å—ä–æ–±—â–µ–Ω–∏—è –∑–∞ –≥—Ä–µ—à–∫–∞

### 3. –ü–æ–¥–æ–±—Ä–µ–Ω–∏ –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ ‚úÖ
- **–¢–æ–∫–µ–Ω–∏**: 2000 ‚Üí 4000 (–ø–æ–∑–≤–æ–ª—è–≤–∞ –ø–æ-–ø—ä–ª–Ω–∏ –ø–ª–∞–Ω–æ–≤–µ)
- **Temperature**: 0.3 ‚Üí 0.7 (–ø–æ-–∫—Ä–µ–∞—Ç–∏–≤–Ω–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)

### 4. –õ–æ–≥–≤–∞–Ω–µ ‚úÖ
–î–µ—Ç–∞–π–ª–Ω–∏ –ª–æ–≥–æ–≤–µ –Ω–∞ –≤—Å—è–∫–∞ —Å—Ç—ä–ø–∫–∞:
```
PLAN_MOD_REQUEST ‚Üí PLAN_MOD_PARSE ‚Üí PLAN_MOD_APPLY ‚Üí 
PLAN_MOD_VALIDATE ‚Üí PLAN_MOD_SAVE ‚Üí PLAN_MOD_SUCCESS
```

### 5. –û–±—Ä–∞—Ç–Ω–∞ –í—Ä—ä–∑–∫–∞ –∫—ä–º –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è ‚úÖ
–ü–æ–∫–∞–∑–≤–∞ –∫–æ–∏ —Å–µ–∫—Ü–∏–∏ —Å–∞ –ø—Ä–æ–º–µ–Ω–µ–Ω–∏:
```
‚úÖ –ü—Ä–æ–º–µ–Ω–µ–Ω–∏ —Å–µ–∫—Ü–∏–∏: –∫–∞–ª–æ—Ä–∏–∏ –∏ –º–∞–∫—Ä–æ—Å–∏, —Å–µ–¥–º–∏—á–Ω–æ –º–µ–Ω—é
```

## –ü—Ä–æ–º–µ–Ω–∏ –≤ –ö–æ–¥–∞

### worker.js
- `parsePlanModificationRequest` - –Ω–∞–ø—ä–ª–Ω–æ –ø—Ä–µ—Ä–∞–±–æ—Ç–µ–Ω –ø—Ä–æ–º–ø—Ç
- `handleSubmitPlanChangeRequest` - –¥–æ–±–∞–≤–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ª–æ–≥–æ–≤–µ
- –ù–æ–≤–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –∑–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### js/planModChat.js  
- `submitPlanChangeRequest` - –ø–æ–∫–∞–∑–≤–∞ –ø—Ä–æ–º–µ–Ω–µ–Ω–∏—Ç–µ —Å–µ–∫—Ü–∏–∏

## –¢–µ—Å—Ç–æ–≤–µ –ü—Ä–µ–º–∏–Ω–∞—Ç–∏ ‚úÖ
- ‚úÖ 3/3 —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏ —Ç–µ—Å—Ç–∞
- ‚úÖ CodeQL —Å–∏–≥—É—Ä–Ω–æ—Å—Ç
- ‚úÖ ESLint (—Å–∞–º–æ —Å—Ç–∞—Ä–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è)
- ‚úÖ Code review (–≤—Å–∏—á–∫–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏ –∞–¥—Ä–µ—Å–∏—Ä–∞–Ω–∏)

## –ö–∞–∫ –¥–∞ –¢–µ—Å—Ç–≤–∞—Ç–µ –†—ä—á–Ω–æ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–≤–µ—á–µ –ü—Ä–æ—Ç–µ–∏–Ω
```
–í—Ö–æ–¥: "–ò—Å–∫–∞–º –ø–æ–≤–µ—á–µ –ø—Ä–æ—Ç–µ–∏–Ω –≤ –ø–ª–∞–Ω–∞"
–û—á–∞–∫–≤–∞–Ω–æ: 
  - –£—Å–ø–µ—à–Ω–æ —Å—ä–æ–±—â–µ–Ω–∏–µ
  - –ü—Ä–æ–º–µ–Ω–µ–Ω–∏: –∫–∞–ª–æ—Ä–∏–∏ –∏ –º–∞–∫—Ä–æ—Å–∏, —Å–µ–¥–º–∏—á–Ω–æ –º–µ–Ω—é
  - –ü—Ä–æ—Ç–µ–∏–Ω —É–≤–µ–ª–∏—á–µ–Ω —Å ~20%
  - –Ø—Å—Ç–∏—è —Å –≤–∏—Å–æ–∫–æ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ –Ω–∞ –ø—Ä–æ—Ç–µ–∏–Ω
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ë–µ–∑ –ú–ª—è–∫–æ
```
–í—Ö–æ–¥: "–ü—Ä–µ–º–∞—Ö–Ω–∏ –º–ª–µ—á–Ω–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç–∏"
–û—á–∞–∫–≤–∞–Ω–æ:
  - –£—Å–ø–µ—à–Ω–æ —Å—ä–æ–±—â–µ–Ω–∏–µ
  - –ü—Ä–æ–º–µ–Ω–µ–Ω–∏: –ø–æ–∑–≤–æ–ª–µ–Ω–∏/–∑–∞–±—Ä–∞–Ω–µ–Ω–∏ —Ö—Ä–∞–Ω–∏, —Å–µ–¥–º–∏—á–Ω–æ –º–µ–Ω—é
  - –ú–ª–µ—á–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–∏ –≤ –∑–∞–±—Ä–∞–Ω–µ–Ω–∏
  - –Ø—Å—Ç–∏—è –±–µ–∑ –º–ª—è–∫–æ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–æ–≤–µ—á–µ –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ
```
–í—Ö–æ–¥: "–ò—Å–∫–∞–º –ø–æ–≤–µ—á–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ"
–û—á–∞–∫–≤–∞–Ω–æ:
  - –£—Å–ø–µ—à–Ω–æ —Å—ä–æ–±—â–µ–Ω–∏–µ
  - –ü—Ä–æ–º–µ–Ω–µ–Ω–∏: —Å–µ–¥–º–∏—á–Ω–æ –º–µ–Ω—é
  - –†–∞–∑–ª–∏—á–Ω–∏ —è—Å—Ç–∏—è –≤—Å–µ–∫–∏ –¥–µ–Ω
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ù–µ—è—Å–Ω–∞ –ó–∞—è–≤–∫–∞ (–¢—Ä—è–±–≤–∞ –¥–∞ –û—Ç–∫–∞–∂–µ)
```
–í—Ö–æ–¥: "–ü—Ä–æ–º–µ–Ω–∏ –Ω–µ—â–æ"
–û—á–∞–∫–≤–∞–Ω–æ:
  - –ì—Ä–µ—à–∫–∞: "AI-—ä—Ç –Ω–µ –º–æ–∂–∞ –¥–∞ —Ä–∞–∑–±–µ—Ä–µ..."
  - –ü–ª–∞–Ω—ä—Ç –ù–ï —Å–µ –ø—Ä–æ–º–µ–Ω—è
```

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –î–µ—Ç–∞–π–ª–∏
üìñ **PLAN_MODIFICATION_FIX.md** (–ê–Ω–≥–ª–∏–π—Å–∫–∏)
- –ü—ä–ª–µ–Ω —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑
- –ö–æ—Äe–Ω–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞
- –î–µ—Ç–∞–π–ª–Ω–æ —Ä–µ—à–µ–Ω–∏–µ
- –ü—Ä–∏–º–µ—Ä–∏ –∑–∞ –∫–æ–¥

### –†—ä–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∑–∞ –¢–µ—Å—Ç–≤–∞–Ω–µ
üìñ **MANUAL_TESTING_GUIDE.md** (–ê–Ω–≥–ª–∏–π—Å–∫–∏)
- 7 —Ç–µ—Å—Ç–æ–≤–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è
- –û—á–∞–∫–≤–∞–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏
- –°—ä–≤–µ—Ç–∏ –∑–∞ debug
- –ú–µ—Ç—Ä–∏–∫–∏ –∑–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

## –ö–∞–∫–≤–æ –µ –ü–æ–¥–æ–±—Ä–µ–Ω–æ

### –ü—Ä–µ–¥–∏ ‚ùå
1. –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª –æ–ø–∏—Å–≤–∞ –ø—Ä–æ–º—è–Ω–∞
2. –í–∏–∂–¥–∞ "–£—Å–ø–µ—à–Ω–æ"
3. –ü–ª–∞–Ω—ä—Ç –Ω–µ —Å–µ –ø—Ä–æ–º–µ–Ω—è
4. –û–±—ä—Ä–∫–∞–Ω–æ—Å—Ç üòï

### –°–ª–µ–¥ ‚úÖ
1. –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª –æ–ø–∏—Å–≤–∞ –ø—Ä–æ–º—è–Ω–∞
2. AI –≥–µ–Ω–µ—Ä–∏—Ä–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏ —è—Å—Ç–∏—è
3. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä—è–≤–∞ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ
4. –ü–æ–∫–∞–∑–≤–∞ –∫–æ–∏ —Å–µ–∫—Ü–∏–∏ —Å–∞ –ø—Ä–æ–º–µ–Ω–µ–Ω–∏
5. –ü–ª–∞–Ω—ä—Ç –Ω–∞–∏—Å—Ç–∏–Ω–∞ —Å–µ –ø—Ä–æ–º–µ–Ω—è
6. –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –≤–∏–∂–¥–∞ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ üòä

## –ö–ª—é—á–æ–≤–∏ –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏

```javascript
// –í worker.js
PLAN_MOD_REQUEST_MAX_LENGTH = 500
PLAN_MOD_PROTEIN_MULTIPLIER = 1.2
PLAN_MOD_DEFAULT_PROTEIN_GRAMS = 100
PLAN_MOD_AI_TEMPERATURE = 0.7
PLAN_MOD_AI_MAX_TOKENS = 4000
```

## –í–∞–∂–Ω–æ –∑–∞ Deployment

### Cloudflare KV –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `model_plan_generation` - —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω
- RESOURCES_KV - —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –Ω–∞–ª–∏—á–µ–Ω
- USER_METADATA_KV - —Ç—Ä—è–±–≤–∞ –¥–∞ —Ä–∞–±–æ—Ç–∏

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
–°–ª–µ–¥–µ—Ç–µ –∑–∞ —Ç–µ–∑–∏ –ª–æ–≥–æ–≤–µ –≤ production:
```
PLAN_MOD_SUCCESS - —É—Å–ø–µ—à–Ω–∏ –ø—Ä–æ–º–µ–Ω–∏
PLAN_MOD_REJECT - –æ—Ç–∫–∞–∑–∞–Ω–∏ –∑–∞—è–≤–∫–∏
PLAN_MOD_WARN - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
PLAN_MOD_ERROR - –≥—Ä–µ—à–∫–∏
```

### –û—á–∞–∫–≤–∞–Ω–∏ –í—Ä–µ–º–µ–Ω–∞
- AI –ø–∞—Ä—Å–∏–Ω–≥: 5-15 —Å–µ–∫—É–Ω–¥–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è: < 500ms
- KV –∑–∞–ø–∏—Å: < 200ms
- **–û–±—â–æ: 6-16 —Å–µ–∫—É–Ω–¥–∏**

## Rollback –ü–ª–∞–Ω

–ê–∫–æ –∏–º–∞ –ø—Ä–æ–±–ª–µ–º–∏:
1. –î–µ–∞–∫—Ç–∏–≤–∏—Ä–∞–π—Ç–µ –±—É—Ç–æ–Ω–∞ –∑–∞ –ø—Ä–æ–º—è–Ω–∞ –Ω–∞ –ø–ª–∞–Ω
2. –í—ä—Ä–Ω–µ—Ç–µ –∫—ä–º –ø—Ä–µ–¥–∏—à–Ω–∞ –≤–µ—Ä—Å–∏—è –Ω–∞ worker.js
3. –ê–Ω–∞–ª–∏–∑–∏—Ä–∞–π—Ç–µ –ª–æ–≥–æ–≤–µ—Ç–µ
4. –ü–æ–ø—Ä–∞–≤–µ—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º–∏

## –°–ª–µ–¥–≤–∞—â–∏ –°—Ç—ä–ø–∫–∏

### –ó–∞ Production
- [ ] –ü—Ä–µ–≥–ª–µ–¥–∞–π—Ç–µ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ
- [ ] –¢–µ—Å—Ç–≤–∞–π—Ç–µ –≤—Å–∏—á–∫–∏ 7 —Å—Ü–µ–Ω–∞—Ä–∏—è
- [ ] –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ AI –º–æ–¥–µ–ª–∞ –≤ RESOURCES_KV
- [ ] Deploy –Ω–∞ worker.js
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞ –ª–æ–≥–æ–≤–µ –ø—ä—Ä–≤–∏—Ç–µ 24 —á–∞—Å–∞

### –ë—ä–¥–µ—â–∏ –ü–æ–¥–æ–±—Ä–µ–Ω–∏—è (–û–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ)
- Real-time preview –Ω–∞ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ
- –ò—Å—Ç–æ—Ä–∏—è –Ω–∞ –ø—Ä–æ–º–µ–Ω–∏ —Å rollback
- AI –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –±–∞–∑–∏—Ä–∞–Ω–∏ –Ω–∞ —Ü–µ–ª–∏
- Multi-turn —á–∞—Ç –∑–∞ —É—Ç–æ—á–Ω–µ–Ω–∏—è

## –ö–æ–Ω—Ç–∞–∫—Ç

–ó–∞ –≤—ä–ø—Ä–æ—Å–∏ –æ—Ç–Ω–æ—Å–Ω–æ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è—Ç–∞:
- –í–∏–∂—Ç–µ PLAN_MODIFICATION_FIX.md –∑–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –¥–µ—Ç–∞–π–ª–∏
- –í–∏–∂—Ç–µ MANUAL_TESTING_GUIDE.md –∑–∞ test cases
- –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ Cloudflare logs –∑–∞ runtime issues

---

**–°—ä–∑–¥–∞–¥–µ–Ω–æ**: 17.12.2024  
**–°—Ç–∞—Ç—É—Å**: –ì–æ—Ç–æ–≤–æ –∑–∞ Production ‚úÖ  
**–¢–µ—Å—Ç–æ–≤–µ**: –í—Å–∏—á–∫–∏ –ø—Ä–µ–º–∏–Ω–∞—Ç–∏ ‚úÖ  
**–°–∏–≥—É—Ä–Ω–æ—Å—Ç**: CodeQL –ø—Ä–µ–º–∏–Ω–∞—Ç ‚úÖ
